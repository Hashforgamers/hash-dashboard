(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7104],{57104:function(e,t,a){Promise.resolve().then(a.bind(a,42357)),Promise.resolve().then(a.bind(a,5955))},5955:function(e,t,a){"use strict";a.d(t,{default:function(){return ek}});var s=a(57437),r=a(2265),l=a(14368),n=a(48614),o=a(14474),i=a(94508),d=a(62869),c=a(66070),m=a(41671),g=a(32489),x=a(95805),u=a(89345),h=a(92369),p=a(13041),b=a(66337),f=a(49322),y=a(88226),j=a(91804),N=a(95080),k=a(51817),v=a(82023),w=a(99397),D=a(71533),_=a(99897),S=a(55901),C=a(32151),Z=a(33674),E=a(91723),T=a(88501),B=a(97143),P=a(38303),A=a(85317),M=a(44794),I=a(32795),z=a(21047),F=a(16275);let R=new Map,L=e=>new Promise((t,a)=>{if(R.has(e)){t(R.get(e));return}let s=new Image;s.onload=()=>{R.set(e,s),t(s)},s.onerror=a,s.src=e}),O=e=>{let{src:t,alt:a,className:l}=e,[n,o]=(0,r.useState)(!1),[i,d]=(0,r.useState)(!1);return((0,r.useEffect)(()=>{L(t).then(()=>o(!0)).catch(()=>d(!0))},[t]),i)?(0,s.jsx)("div",{className:"flex items-center justify-center bg-gradient-to-br from-green-50 to-green-100 dark:from-green-900/20 dark:to-green-800/20 ".concat(l),children:(0,s.jsx)(A.Z,{className:"text-green-500",size:32})}):(0,s.jsxs)("div",{className:"relative ".concat(l),children:[!n&&(0,s.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-gradient-to-br from-green-50 to-green-100 dark:from-green-900/20 dark:to-green-800/20",children:(0,s.jsx)(k.Z,{className:"animate-spin text-green-500",size:24})}),(0,s.jsx)("img",{className:"h-full w-full object-cover transition-opacity duration-300 ".concat(n?"opacity-100":"opacity-0"),src:t,alt:a,loading:"lazy"})]})};var U=e=>{var t,a;let{vendorId:n,isOpen:o,onClose:i,onConfirm:d,initialSelectedMeals:c=[]}=e,[m,x]=(0,r.useState)([]),[u,h]=(0,r.useState)(c),[p,b]=(0,r.useState)(!1),[f,y]=(0,r.useState)(""),[j,N]=(0,r.useState)(null);async function v(){b(!0),y("");try{let e=await fetch("".concat(P.m7,"/api/vendor/").concat(n,"/extra-services")),t=await e.json();console.log(t),t.success?(x(t.categories||[]),t.categories&&t.categories.length>0&&N(t.categories[0].id)):(y("failed to load meals"),console.log(f))}catch(e){console.error(e),y("Error loading meals")}b(!1)}(0,r.useEffect)(()=>{o&&n&&v()},[o,n]),(0,r.useEffect)(()=>{h(c)},[c]);let D=(e,t,a)=>{t<=0?h(t=>t.filter(t=>t.menu_item_id!==e.id)):h(s=>{let r=s.findIndex(t=>t.menu_item_id===e.id),l={menu_item_id:e.id,name:e.name,price:e.price,quantity:t,total:e.price*t,category:a};if(r>=0){let e=[...s];return e[r]=l,e}return[...s,l]})},_=e=>{var t;return(null===(t=u.find(t=>t.menu_item_id===e))||void 0===t?void 0:t.quantity)||0},S=()=>{d(u),i()},C=()=>u.reduce((e,t)=>e+t.quantity,0);return o?(0,s.jsx)(l.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-60 backdrop-blur-sm p-4",onClick:e=>e.target===e.currentTarget&&i(),children:(0,s.jsxs)(l.E.div,{initial:{opacity:0,scale:.95,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:20},className:"relative w-full max-w-4xl h-[85vh] overflow-hidden rounded-xl bg-white shadow-2xl dark:bg-gray-900",onClick:e=>e.stopPropagation(),children:[(0,s.jsxs)("div",{className:"flex items-center justify-between border-b border-gray-300 p-4 dark:border-gray-700",children:[" ",(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[" ",(0,s.jsxs)("div",{className:"rounded-lg bg-green-700 p-2 text-white",children:[" ",(0,s.jsx)(A.Z,{size:20})," "]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("h2",{className:"text-lg font-bold text-gray-900 dark:text-white",children:[" ","Add Meals & Extras"]}),(0,s.jsxs)("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:[" ",m.length," categories •"," ",m.reduce((e,t)=>e+t.menu_count,0)," items"]})]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("button",{className:"rounded-lg bg-green-600 px-4 py-2 text-sm text-white hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-600",onClick:S,children:"Add to Order"}),(0,s.jsxs)("button",{className:"rounded-lg p-2 text-gray-500 hover:bg-gray-100 dark:hover:bg-gray-700",onClick:i,"aria-label":"Close",children:[(0,s.jsx)(g.Z,{size:20})," "]})]})]}),(0,s.jsxs)("div",{className:"flex h-[calc(85vh-120px)] overflow-hidden",children:[" ",(0,s.jsxs)("aside",{className:"w-56 overflow-auto border-r border-gray-200 bg-gray-50 p-3 dark:border-gray-700 dark:bg-gray-800",children:[" ",(0,s.jsxs)("h3",{className:"mb-3 text-xs font-semibold text-gray-700 dark:text-gray-300 uppercase",children:[" ","Categories"]}),0===m.length&&(0,s.jsx)("p",{className:"text-gray-500 dark:text-gray-400 text-xs",children:"No categories"}),(0,s.jsx)("ul",{children:m.map(e=>(0,s.jsxs)("li",{className:"mb-1.5",children:[" ",(0,s.jsxs)("button",{className:"block w-full rounded-lg p-2 text-left transition-colors duration-200 ".concat(j===e.id?"bg-green-200 text-green-800 dark:bg-green-900 dark:text-green-300":"hover:bg-green-100 dark:hover:bg-green-900/30"),onClick:()=>N(e.id),children:[(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{className:"font-medium text-sm",children:e.name})," ",(0,s.jsxs)("span",{className:"rounded-full bg-gray-300 px-1.5 py-0.5 text-xs font-semibold text-gray-700 dark:bg-gray-600 dark:text-gray-300",children:[" ",e.menu_count]})]}),e.description&&(0,s.jsx)("p",{className:"mt-1 text-xs text-gray-600 line-clamp-2 dark:text-gray-400",children:e.description})]})]},e.id))})]}),(0,s.jsxs)("section",{className:"flex-1 overflow-auto p-4",children:[" ",p&&(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center space-y-3 h-64",children:[" ",(0,s.jsx)(k.Z,{size:36,className:"animate-spin text-green-600"})," ",(0,s.jsx)("p",{className:"text-green-800 dark:text-green-400 text-sm",children:"Loading meals…"})," "]}),f&&!p&&(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center gap-4 text-red-600 h-64",children:[(0,s.jsx)(M.Z,{size:48})," ",(0,s.jsx)("p",{className:"text-sm",children:f})," ",(0,s.jsx)("button",{onClick:v,className:"rounded bg-green-700 px-4 py-2 text-white hover:bg-green-800 text-sm",children:"Retry"})]}),!p&&!f&&0===m.length&&(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center gap-4 text-gray-400 h-64",children:[(0,s.jsx)(A.Z,{size:48})," ",(0,s.jsx)("p",{className:"text-sm",children:"No meals available"})," "]}),!p&&!f&&m.length>0&&j&&(0,s.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:[" ",null===(a=m.find(e=>e.id===j))||void 0===a?void 0:null===(t=a.menus)||void 0===t?void 0:t.map(e=>{let t=_(e.id);return(0,s.jsxs)(l.E.div,{layout:!0,className:"rounded-lg border-2 bg-white shadow-sm dark:bg-gray-700 ".concat(t>0?"border-green-500 shadow-green-200":"border-gray-200 dark:border-gray-600"),whileHover:{y:-2},children:[(0,s.jsxs)("div",{className:"relative h-32 w-full overflow-hidden rounded-t-lg",children:[" ",e.images.length>0?(0,s.jsx)(O,{src:e.images[0].image_url,alt:e.name,className:"h-full w-full"}):(0,s.jsxs)("div",{className:"flex h-full w-full items-center justify-center bg-gradient-to-br from-green-50 to-green-100 dark:from-green-900/20 dark:to-green-800/20",children:[(0,s.jsx)(A.Z,{className:"text-green-500",size:32})," "]}),t>0&&(0,s.jsxs)("div",{className:"absolute right-2 top-2 rounded-lg bg-green-600 px-2 py-1 text-xs font-semibold text-white",children:[" ",t]})]}),(0,s.jsxs)("div",{className:"p-3",children:[" ",(0,s.jsxs)("h3",{className:"mb-1 font-semibold text-sm text-gray-900 dark:text-gray-200 line-clamp-1",children:[" ",e.name]}),e.description&&(0,s.jsxs)("p",{className:"mb-3 text-xs text-gray-600 dark:text-gray-400 line-clamp-2",children:[" ",e.description]}),(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-1 text-green-600",children:[(0,s.jsx)(I.Z,{size:16})," ",(0,s.jsx)("span",{className:"text-lg font-bold",children:e.price})," "]}),(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[" ",(0,s.jsxs)("button",{onClick:()=>{var a;return D(e,t-1,(null===(a=m.find(e=>e.id===j))||void 0===a?void 0:a.name)||"")},disabled:0===t,className:"flex h-7 w-7 items-center justify-center rounded-full bg-red-600 text-white disabled:opacity-50 disabled:cursor-not-allowed hover:bg-red-700 transition-colors",children:[(0,s.jsx)(z.Z,{size:12})," "]}),(0,s.jsxs)("span",{className:"min-w-[20px] text-center font-semibold text-sm text-gray-900 dark:text-gray-100",children:[" ",t]}),(0,s.jsxs)("button",{onClick:()=>{var a;return D(e,t+1,(null===(a=m.find(e=>e.id===j))||void 0===a?void 0:a.name)||"")},className:"flex h-7 w-7 items-center justify-center rounded-full bg-green-600 text-white hover:bg-green-700 transition-colors",children:[(0,s.jsx)(w.Z,{size:12})," "]})]})]}),t>0&&(0,s.jsxs)(l.E.p,{layout:!0,className:"mt-2 text-right font-semibold text-green-700 text-sm",children:["Subtotal: ₹",(t*e.price).toFixed(2)]})]})]},e.id)})]})]})]}),(0,s.jsxs)("div",{className:"border-t border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800 p-3 my-[-2vh]",children:[" ",(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:[" ",C()," item",1!==C()?"s":""," selected"]}),(0,s.jsxs)("div",{className:"flex items-center gap-1",children:[(0,s.jsx)(I.Z,{className:"w-4 h-4 text-green-600"})," ",(0,s.jsxs)("span",{className:"text-xl font-bold text-green-600",children:[" ",u.reduce((e,t)=>e+t.total,0)]})]})]}),u.length>0&&(0,s.jsx)("button",{onClick:()=>h([]),className:"text-xs text-red-600 hover:text-red-700 underline",children:"Clear All"})]}),(0,s.jsxs)("div",{className:"flex gap-2",children:[" ",(0,s.jsx)("button",{onClick:i,className:"px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors font-medium text-sm",children:"Cancel"}),(0,s.jsxs)("button",{onClick:S,className:"px-6 py-2 bg-gradient-to-r from-green-600 to-green-700 text-white rounded-lg hover:from-green-700 hover:to-green-800 transition-all font-bold shadow-lg flex items-center gap-2 text-sm",children:[(0,s.jsx)(F.Z,{className:"w-4 h-4"})," ","Add to Order"]})]})]})]})]},"modal")},"overlay"):null},X=a(53647),V=a(73578),q=a(65613),H=a(3032),J=a(10407),G=a(30401),Y=a(40519);let K=H.fC,W=H.xz;H.ZA,H.Uv,H.Tr,H.Ee,r.forwardRef((e,t)=>{let{className:a,inset:r,children:l,...n}=e;return(0,s.jsxs)(H.fF,{ref:t,className:(0,i.cn)("flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",r&&"pl-8",a),...n,children:[l,(0,s.jsx)(J.Z,{className:"ml-auto"})]})}).displayName=H.fF.displayName,r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(H.tu,{ref:t,className:(0,i.cn)("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...r})}).displayName=H.tu.displayName;let Q=r.forwardRef((e,t)=>{let{className:a,sideOffset:r=4,...l}=e;return(0,s.jsx)(H.Uv,{children:(0,s.jsx)(H.VY,{ref:t,sideOffset:r,className:(0,i.cn)("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...l})})});Q.displayName=H.VY.displayName;let $=r.forwardRef((e,t)=>{let{className:a,inset:r,...l}=e;return(0,s.jsx)(H.ck,{ref:t,className:(0,i.cn)("relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",r&&"pl-8",a),...l})});$.displayName=H.ck.displayName,r.forwardRef((e,t)=>{let{className:a,children:r,checked:l,...n}=e;return(0,s.jsxs)(H.oC,{ref:t,className:(0,i.cn)("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a),checked:l,...n,children:[(0,s.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,s.jsx)(H.wU,{children:(0,s.jsx)(G.Z,{className:"h-4 w-4"})})}),r]})}).displayName=H.oC.displayName,r.forwardRef((e,t)=>{let{className:a,children:r,...l}=e;return(0,s.jsxs)(H.Rk,{ref:t,className:(0,i.cn)("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a),...l,children:[(0,s.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,s.jsx)(H.wU,{children:(0,s.jsx)(Y.Z,{className:"h-2 w-2 fill-current"})})}),r]})}).displayName=H.Rk.displayName,r.forwardRef((e,t)=>{let{className:a,inset:r,...l}=e;return(0,s.jsx)(H.__,{ref:t,className:(0,i.cn)("px-2 py-1.5 text-sm font-semibold",r&&"pl-8",a),...l})}).displayName=H.__.displayName,r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(H.Z0,{ref:t,className:(0,i.cn)("-mx-1 my-1 h-px bg-muted",a),...r})}).displayName=H.Z0.displayName;var ee=a(12527),et=a(99388),ea=a(9343),es=a(73247),er=a(83464);let el=new Map;function en(e){let t=el.get(e);return t&&Date.now()-t.timestamp<3e5?t.data:null}function eo(e,t){el.set(e,{data:t,timestamp:Date.now()})}let ei=new Map;async function ed(e){let t=en(e);if(t)return console.log("✅ Cache hit: ".concat(e)),t;if(ei.has(e))return console.log("⏳ Deduped request: ".concat(e)),ei.get(e);let a=fetch(e).then(e=>e.json()).then(t=>(eo(e,t),ei.delete(e),t)).catch(t=>{throw ei.delete(e),t});return ei.set(e,a),a}async function ec(e,t,a){let s="".concat(P.o8,"/api/getSlotsBatch/vendor/").concat(e),r="batch:".concat(e,":").concat(t.join(","),":").concat(a.join(",")),l=en(r);if(l)return console.log("✅ Batch cache hit"),l;try{let e=await fetch(s,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({game_ids:t,dates:a})});if(!e.ok){let t=await e.text();throw console.error("❌ Batch API error:",t),Error("Batch fetch failed: ".concat(e.status))}let l=await e.json();return console.log("✅ Batch fetch successful:",l),eo(r,l),l}catch(e){throw console.error("❌ Batch fetch error:",e),e}}let em=["Cash","UPI","Pass"];function eg(e){let{isOpen:t,onClose:a,selectedSlots:D,onBookingComplete:_,availableConsoles:S}=e;console.log("\uD83C\uDFAF SlotBookingForm rendered with:",{isOpen:t,selectedSlotsCount:D.length,selectedSlots:D});let[C,Z]=(0,r.useState)(""),[E,T]=(0,r.useState)(""),[B,A]=(0,r.useState)(""),[M,I]=(0,r.useState)("Cash"),[z,F]=(0,r.useState)(""),[R,L]=(0,r.useState)(null),[O,X]=(0,r.useState)(!1),[V,q]=(0,r.useState)(""),[H,J]=(0,r.useState)(!1),[G,Y]=(0,r.useState)(0),[K,W]=(0,r.useState)(0),[Q,$]=(0,r.useState)(0),[ee,et]=(0,r.useState)([]),[ea,es]=(0,r.useState)(!1),[er,el]=(0,r.useState)(!1),[en,eo]=(0,r.useState)(!1),[ei,ed]=(0,r.useState)({}),[ec,eg]=(0,r.useState)({}),[ex,eu]=(0,r.useState)([]),[eh,ep]=(0,r.useState)([]),[eb,ef]=(0,r.useState)([]),[ey,ej]=(0,r.useState)([]),[eN,ek]=(0,r.useState)(""),ev=(0,r.useRef)(null),ew=()=>{console.log("\uD83D\uDD0D Getting vendor ID from token...");let e=localStorage.getItem("jwtToken");if(!e)return console.log("❌ No JWT token found"),null;try{let t=(0,o.o)(e);console.log("\uD83D\uDD13 Decoded token:",t);let a=t.sub.id;return console.log("\uD83C\uDFEA Extracted vendor ID:",a),a}catch(e){return console.error("❌ Error decoding token:",e),null}},eD=e=>{console.log("\uD83D\uDCB0 Calculating auto waive-off for slots:",e);let t=new Date(new Date().toLocaleString("en-US",{timeZone:"Asia/Kolkata"}));console.log("\uD83D\uDD50 Current IST time:",t.toLocaleTimeString("en-IN"));let a=0;e.forEach(e=>{let s=new Date("".concat(e.date,"T").concat(e.start_time,"+05:30")),r=new Date("".concat(e.date,"T").concat(e.end_time,"+05:30")),l=(r.getTime()-s.getTime())/6e4;if(console.log("\uD83D\uDD50 Slot Analysis for ".concat(e.start_time,"-").concat(e.end_time,":"),{slotId:e.slot_id,slotDurationMinutes:l,currentTime:t.toLocaleTimeString("en-IN"),slotStart:s.toLocaleTimeString("en-IN"),slotEnd:r.toLocaleTimeString("en-IN")}),t>=s&&t<r){let r=(t.getTime()-s.getTime())/6e4,n=r/l,o=e.console_price*n;console.log("\uD83D\uDCB0 Wave-off Calculation:",{elapsedMinutes:Math.round(10*r)/10,totalSlotMinutes:l,elapsedPercentage:Math.round(100*n)+"%",waveOffAmount:Math.round(o),consolePrice:e.console_price}),a+=o}else t<s?console.log("⏰ Booking made in advance for ".concat(e.start_time," - no wave-off needed")):t>=r&&(console.log("⚠️ Slot ".concat(e.start_time," already ended - full wave-off applied")),a+=e.console_price)});let s=Math.round(a);return console.log("\uD83D\uDCB0 Total auto waive-off calculated:",s),s},e_=async e=>{let t=ew();if(!t)return null;if(e.trim()&&t){X(!0),q("");try{let a=await fetch("".concat(P.o8,"/api/pass/validate"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({pass_uid:e.trim(),vendor_id:t})}),s=await a.json();if(a.ok&&s.valid){L(s.pass),q("");let e=.5*D.length;e>s.pass.remaining_hours&&q("Insufficient hours. Need ".concat(e," hrs, available ").concat(s.pass.remaining_hours," hrs"))}else q(s.error||"Invalid pass"),L(null)}catch(e){q("Failed to validate pass"),L(null)}finally{X(!1)}}};(0,r.useEffect)(()=>{D.length>0?$(eD(D)):$(0)},[D]),(0,r.useEffect)(()=>{if(!t)return;let e=ew();e&&(async()=>{try{let t=await fetch("".concat(P.m7,"/api/vendor/").concat(e,"/active-pricing")),a=await t.json();a.success&&(console.log("\uD83C\uDFF7️ Active pricing loaded:",a.pricing),eg(a.pricing))}catch(e){console.error("❌ Failed to fetch active pricing:",e)}})()},[t]),(0,r.useEffect)(()=>{if(!t)return;let e=ew();if(!e)return;console.log("\uD83D\uDC65 Fetching user list for vendor:",e);let a="userList",s=localStorage.getItem(a),r=async()=>{console.log("\uD83D\uDD04 Fetching fresh user data from API...");try{let t=await fetch("".concat(P.o8,"/api/vendor/").concat(e,"/users"));console.log("\uD83D\uDC65 User API response status:",t.status);let s=await t.json();console.log("\uD83D\uDC65 User data received:",s),Array.isArray(s)&&(eu(s),localStorage.setItem(a,JSON.stringify({data:s,timestamp:Date.now()})),console.log("✅ User list cached successfully"))}catch(e){console.error("❌ Error fetching users:",e)}};if(s)try{let{data:e,timestamp:t}=JSON.parse(s);Date.now()-t<6e5?(console.log("✅ Using cached user data"),eu(e)):(console.log("⏰ Cache expired, fetching fresh data"),r())}catch(e){console.log("❌ Cache parse error, fetching fresh data"),r()}else console.log("\uD83D\uDCED No cache found, fetching fresh data"),r()},[t]);let eS=(e,t)=>t.trim()?ex.filter(a=>a[e].toLowerCase().includes(t.toLowerCase())):ex,eC=e=>{T(e),ep(eS("email",e)),ek("email")},eZ=e=>{A(e),ef(eS("phone",e)),ek("phone")},eE=e=>{Z(e),ej(eS("name",e)),ek("name")},eT=()=>{ev.current=window.setTimeout(()=>{ek(""),ep([]),ef([]),ej([]),ev.current=null},150)},eB=e=>{console.log("\uD83D\uDC64 User suggestion clicked:",e),ev.current&&(clearTimeout(ev.current),ev.current=null),T(e.email),A(e.phone),Z(e.name),ep([]),ef([]),ej([]),ek("")},eP=e=>{let t=ec[e.console_name.toLowerCase()]||Object.values(ec).find(t=>t.console_type.toLowerCase()===e.console_name.toLowerCase());return t?t.price:e.console_price},eA=ee.reduce((e,t)=>e+t.total,0),eM=D.reduce((e,t)=>e+eP(t),0),eI=Math.max(0,eM-G-Q+K+eA);console.log("\uD83D\uDCB0 Pricing calculation:",{consoleTotal:eM,mealsTotal:eA,waiveOffAmount:G,autoWaiveOffAmount:Q,extraControllerFare:K,totalAmount:eI});let ez=()=>{console.log("✅ Validating form...");let e={};return C.trim()||(e.name="Name is required"),E.trim()?/\S+@\S+\.\S+/.test(E)||(e.email="Email is invalid"):e.email="Email is required",B.trim()||(e.phone="Phone number is required"),0===D.length&&(e.slots="Please select at least one time slot"),M||(e.payment="Please select a payment method"),"Pass"===M&&(z.trim()?R?V&&(e.pass=V):e.pass="Please validate the pass first":e.pass="Please enter pass UID"),ed(e),console.log("✅ Form validation result:",{isValid:0===Object.keys(e).length,errors:e}),0===Object.keys(e).length},eF=async e=>{if(e.preventDefault(),console.log("\uD83D\uDE80 Form submission started"),!ez()){console.log("❌ Form validation failed");return}let t=ew();if(!t){console.log("❌ No vendor ID, cannot submit"),alert("Please login again");return}el(!0),console.log("\uD83D\uDCDD Preparing booking data...");try{var a,s,r,l,n;if("Pass"===M&&R){let e=.5*D.length,a=await fetch("".concat(P.o8,"/api/pass/redeem/dashboard"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({pass_uid:z.trim(),vendor_id:t,hours_to_deduct:e,session_start:null===(r=D[0])||void 0===r?void 0:r.start_time.slice(0,5),session_end:null===(l=D[D.length-1])||void 0===l?void 0:l.end_time.slice(0,5),notes:"Booking for ".concat(null===(n=D[0])||void 0===n?void 0:n.console_name," - ").concat(D.length," slots")})}),s=await a.json();if(!a.ok||!s.success){alert("Pass redemption failed: ".concat(s.error)),el(!1);return}}let e={consoleType:(null===(a=D[0])||void 0===a?void 0:a.console_name)||"",name:C,email:E,phone:B,bookedDate:(null===(s=D[0])||void 0===s?void 0:s.date)||"",slotId:D.map(e=>e.slot_id),paymentType:M,waiveOffAmount:G+Q,extraControllerFare:K,selectedMeals:ee.map(e=>({menu_item_id:e.menu_item_id,quantity:e.quantity})),bookingMode:H?"private":"regular"};console.log("\uD83D\uDCE4 Submitting booking data:",e);let o=await fetch("".concat(P.o8,"/api/newBooking/vendor/").concat(t),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(console.log("\uD83D\uDCE5 API response status:",o.status),!o.ok){let e=await o.json().catch(()=>({}));throw Error(e.message||"Failed to submit booking")}let i=await o.json();if(console.log("\uD83D\uDCE5 API response data:",i),o.ok||!0===i.success||"true"===i.success){console.log("✅ Booking created successfully!"),eo(!0),console.log("\uD83D\uDCE1 Dispatching refresh-dashboard event"),window.dispatchEvent(new CustomEvent("refresh-dashboard"));let e="userList",a=localStorage.getItem(e);if(a)try{let{data:s,timestamp:r}=JSON.parse(a);if(!s.some(e=>e.email===E||e.phone===B)){console.log("\uD83D\uDC64 New user detected, refreshing user cache...");let a=await fetch("".concat(P.o8,"/api/vendor/").concat(t,"/users")),s=await a.json();Array.isArray(s)&&(localStorage.setItem(e,JSON.stringify({data:s,timestamp:Date.now()})),console.log("✅ User cache updated with new user"))}}catch(e){console.error("❌ Error checking or updating user cache:",e)}}else console.log("❌ Unexpected response format:",i),alert("Error: ".concat(i.message||"Unexpected response from server"))}catch(e){console.error("❌ Error submitting booking:",e),alert("Failed to create booking")}finally{el(!1),console.log("\uD83C\uDFC1 Form submission completed")}};if(en){var eR;return(0,s.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm p-4",children:(0,s.jsxs)(l.E.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"max-w-md w-full bg-white dark:bg-gray-800 rounded-2xl shadow-2xl p-8 text-center",children:[(0,s.jsx)(l.E.div,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",stiffness:200,damping:20},className:"w-16 h-16 mx-auto mb-6 rounded-full bg-gradient-to-r from-emerald-500 to-green-500 flex items-center justify-center shadow-lg",children:(0,s.jsx)(m.Z,{className:"w-8 h-8 text-white"})}),(0,s.jsx)("h2",{className:"text-2xl font-bold text-gray-800 dark:text-white mb-3",children:"Booking Confirmed!"}),(0,s.jsx)("p",{className:"text-gray-600 dark:text-gray-300 mb-6",children:"Your slot booking has been successfully created."}),(0,s.jsxs)("div",{className:"bg-emerald-50 dark:bg-emerald-900/20 rounded-lg p-4 mb-6 text-left",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center py-2",children:[(0,s.jsx)("span",{className:"text-gray-600 dark:text-gray-400",children:"Console Type:"}),(0,s.jsx)("span",{className:"font-medium text-gray-800 dark:text-white",children:null===(eR=D[0])||void 0===eR?void 0:eR.console_name})]}),(0,s.jsxs)("div",{className:"flex justify-between items-center py-2",children:[(0,s.jsx)("span",{className:"text-gray-600 dark:text-gray-400",children:"Slots:"}),(0,s.jsx)("span",{className:"font-medium text-gray-800 dark:text-white",children:D.length})]}),(0,s.jsxs)("div",{className:"flex justify-between items-center py-2",children:[(0,s.jsx)("span",{className:"text-gray-600 dark:text-gray-400",children:"Meals & Extras:"}),(0,s.jsx)("span",{className:"font-medium text-gray-800 dark:text-white",children:0===ee.length?"None":ee.map(e=>"".concat(e.name," (").concat(e.quantity,")")).join(", ")})]}),(0,s.jsxs)("div",{className:"flex justify-between items-center py-2 border-t border-emerald-200 dark:border-emerald-700",children:[(0,s.jsx)("span",{className:"text-gray-600 dark:text-gray-400",children:"Total Amount:"}),(0,s.jsxs)("span",{className:"font-bold text-emerald-600 text-xl",children:["₹",eI]})]})]}),(0,s.jsx)(d.z,{onClick:()=>{_(),a(),eo(!1)},className:"w-full bg-gradient-to-r from-emerald-600 to-green-600 hover:from-emerald-700 hover:to-green-700",children:"Create Another Booking"})]})})}return t?(0,s.jsx)(n.M,{children:(0,s.jsx)(l.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm p-4",children:(0,s.jsxs)(l.E.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},className:"w-full max-w-6xl max-h-[95vh] overflow-y-auto bg-white dark:bg-gray-800 rounded-2xl border border-gray-200 dark:border-gray-700 shadow-2xl",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-gray-200 dark:border-gray-700",children:[(0,s.jsx)("h2",{className:"text-2xl font-bold text-gray-800 dark:text-white",children:"New Slot Booking"}),(0,s.jsx)("button",{onClick:a,className:"p-2 rounded-lg bg-gray-100 hover:bg-gray-200 dark:bg-gray-700 dark:hover:bg-gray-600 text-gray-600 dark:text-gray-300 hover:text-gray-800 dark:hover:text-white transition-colors",children:(0,s.jsx)(g.Z,{className:"w-5 h-5"})})]}),(0,s.jsx)("div",{className:"p-6",children:(0,s.jsxs)("form",{onSubmit:eF,className:"space-y-6",children:[(0,s.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,s.jsxs)("div",{className:"lg:col-span-2 space-y-6",children:[(0,s.jsxs)(c.Zb,{className:"p-4 bg-emerald-50 dark:bg-emerald-900/20 border-emerald-200 dark:border-emerald-700",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold text-emerald-800 dark:text-emerald-200 mb-3",children:"Selected Time Slots"}),(0,s.jsxs)("div",{className:"space-y-2",children:[D.map((e,t)=>(0,s.jsxs)("div",{className:"flex items-center justify-between text-sm bg-white dark:bg-gray-800 rounded-lg p-3",children:[(0,s.jsxs)("span",{className:"text-gray-700 dark:text-gray-300",children:[(0,s.jsx)("strong",{children:new Date(e.date).toLocaleDateString("en-GB")})," • ",e.start_time.slice(0,5),"-",e.end_time.slice(0,5)," • ",e.console_name]}),(0,s.jsx)("span",{className:"flex items-center gap-2 font-semibold",children:(()=>{let t=ec[e.console_name.toLowerCase()]||Object.values(ec).find(t=>t.console_type.toLowerCase()===e.console_name.toLowerCase()),a=null==t?void 0:t.is_offer;return(0,s.jsxs)(s.Fragment,{children:[a&&(0,s.jsxs)("span",{className:"line-through text-gray-400 text-xs",children:["₹",e.console_price]}),(0,s.jsxs)("span",{className:a?"text-orange-500":"text-emerald-600 dark:text-emerald-400",children:["₹",eP(e)]}),a&&(0,s.jsxs)("span",{className:"text-xs bg-orange-100 dark:bg-orange-900/30 text-orange-600 px-1.5 py-0.5 rounded-full",children:["\uD83C\uDFF7️ ",null==t?void 0:t.offer_name]})]})})()})]},t)),(0,s.jsx)("div",{className:"text-right pt-2 border-t border-emerald-200 dark:border-emerald-700",children:(0,s.jsxs)("span",{className:"text-emerald-700 dark:text-emerald-300 font-bold",children:["Slots Total: ₹",eM]})})]})]}),(0,s.jsxs)(c.Zb,{className:"p-6 bg-gray-50 dark:bg-gray-700/30",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-4",children:[(0,s.jsx)("div",{className:"p-1 bg-emerald-100 dark:bg-emerald-900/30 rounded",children:(0,s.jsx)(x.Z,{className:"w-4 h-4 text-emerald-600"})}),(0,s.jsx)("h3",{className:"text-lg font-semibold text-gray-800 dark:text-white",children:"Customer Information"})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)("input",{type:"email",value:E,onChange:e=>eC(e.target.value),onFocus:()=>{ev.current&&(clearTimeout(ev.current),ev.current=null),ek("email"),ep(eS("email",E))},onBlur:eT,autoComplete:"off",placeholder:"Email",className:(0,i.cn)("w-full pl-10 pr-4 py-3 bg-white dark:bg-gray-800 border rounded-lg transition-all duration-200",ei.email?"border-red-500 focus:border-red-500":"email"===eN?"border-emerald-500 focus:border-emerald-500":"border-gray-300 dark:border-gray-600 focus:border-emerald-500","focus:outline-none focus:ring-1 focus:ring-emerald-500/20")}),(0,s.jsx)(u.Z,{className:"w-4 h-4 text-gray-400 absolute left-3 top-3.5"}),(0,s.jsx)(n.M,{children:"email"===eN&&eh.length>0&&(0,s.jsx)(l.E.ul,{initial:{opacity:0,y:-5},animate:{opacity:1,y:0},exit:{opacity:0,y:-5},className:"absolute z-20 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-lg w-full mt-1 max-h-40 overflow-y-auto",children:eh.slice(0,5).map((e,t)=>(0,s.jsx)(l.E.li,{whileHover:{backgroundColor:"rgba(16, 185, 129, 0.1)"},className:"px-3 py-2 hover:bg-emerald-50 dark:hover:bg-emerald-900/30 cursor-pointer border-b border-gray-100 dark:border-gray-700 last:border-b-0",onMouseDown:()=>eB(e),children:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("div",{className:"p-1 bg-emerald-100 dark:bg-emerald-900/30 rounded-full",children:(0,s.jsx)(h.Z,{className:"w-3 h-3 text-emerald-600"})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"font-medium text-gray-800 dark:text-white text-sm",children:e.name}),(0,s.jsx)("p",{className:"text-gray-600 dark:text-gray-400 text-xs",children:e.email})]})]})},t))})}),ei.email&&(0,s.jsx)("p",{className:"text-red-500 text-xs mt-1",children:ei.email})]}),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)("input",{type:"tel",value:B,onChange:e=>eZ(e.target.value),onFocus:()=>{ev.current&&(clearTimeout(ev.current),ev.current=null),ek("phone"),ef(eS("phone",B))},onBlur:eT,autoComplete:"off",placeholder:"Phone",className:(0,i.cn)("w-full pl-10 pr-4 py-3 bg-white dark:bg-gray-800 border rounded-lg transition-all duration-200",ei.phone?"border-red-500 focus:border-red-500":"phone"===eN?"border-emerald-500 focus:border-emerald-500":"border-gray-300 dark:border-gray-600 focus:border-emerald-500","focus:outline-none focus:ring-1 focus:ring-emerald-500/20")}),(0,s.jsx)(p.Z,{className:"w-4 h-4 text-gray-400 absolute left-3 top-3.5"}),(0,s.jsx)(n.M,{children:"phone"===eN&&eb.length>0&&(0,s.jsx)(l.E.ul,{initial:{opacity:0,y:-5},animate:{opacity:1,y:0},exit:{opacity:0,y:-5},className:"absolute z-20 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-lg w-full mt-1 max-h-40 overflow-y-auto",children:eb.slice(0,5).map((e,t)=>(0,s.jsx)(l.E.li,{whileHover:{backgroundColor:"rgba(16, 185, 129, 0.1)"},className:"px-3 py-2 hover:bg-emerald-50 dark:hover:bg-emerald-900/30 cursor-pointer border-b border-gray-100 dark:border-gray-700 last:border-b-0",onMouseDown:()=>eB(e),children:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("div",{className:"p-1 bg-emerald-100 dark:bg-emerald-900/30 rounded-full",children:(0,s.jsx)(h.Z,{className:"w-3 h-3 text-emerald-600"})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"font-medium text-gray-800 dark:text-white text-sm",children:e.name}),(0,s.jsx)("p",{className:"text-gray-600 dark:text-gray-400 text-xs",children:e.phone})]})]})},t))})}),ei.phone&&(0,s.jsx)("p",{className:"text-red-500 text-xs mt-1",children:ei.phone})]}),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)("input",{type:"text",value:C,onChange:e=>eE(e.target.value),onFocus:()=>{ev.current&&(clearTimeout(ev.current),ev.current=null),ek("name"),ej(eS("name",C))},onBlur:eT,placeholder:"Full name",className:(0,i.cn)("w-full pl-10 pr-4 py-3 bg-white dark:bg-gray-800 border rounded-lg transition-all duration-200",ei.name?"border-red-500 focus:border-red-500":"name"===eN?"border-emerald-500 focus:border-emerald-500":"border-gray-300 dark:border-gray-600 focus:border-emerald-500","focus:outline-none focus:ring-1 focus:ring-emerald-500/20")}),(0,s.jsx)(h.Z,{className:"w-4 h-4 text-gray-400 absolute left-3 top-3.5"}),(0,s.jsx)(n.M,{children:"name"===eN&&ey.length>0&&(0,s.jsx)(l.E.ul,{initial:{opacity:0,y:-5},animate:{opacity:1,y:0},exit:{opacity:0,y:-5},className:"absolute z-20 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-lg w-full mt-1 max-h-40 overflow-y-auto",children:ey.slice(0,5).map((e,t)=>(0,s.jsx)(l.E.li,{whileHover:{backgroundColor:"rgba(16, 185, 129, 0.1)"},className:"px-3 py-2 hover:bg-emerald-50 dark:hover:bg-emerald-900/30 cursor-pointer border-b border-gray-100 dark:border-gray-700 last:border-b-0",onMouseDown:()=>eB(e),children:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("div",{className:"p-1 bg-emerald-100 dark:bg-emerald-900/30 rounded-full",children:(0,s.jsx)(h.Z,{className:"w-3 h-3 text-emerald-600"})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"font-medium text-gray-800 dark:text-white text-sm",children:e.name}),(0,s.jsx)("p",{className:"text-gray-600 dark:text-gray-400 text-xs",children:e.email})]})]})},t))})}),ei.name&&(0,s.jsx)("p",{className:"text-red-500 text-xs mt-1",children:ei.name})]})]})]}),(0,s.jsxs)(c.Zb,{className:"p-4 bg-gray-50 dark:bg-gray-700/30",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("div",{className:(0,i.cn)("p-2 rounded-lg transition-all duration-300",H?"bg-gradient-to-br from-purple-500 to-pink-500":"bg-gray-300 dark:bg-gray-600"),children:H?(0,s.jsx)(b.Z,{className:"w-5 h-5 text-white"}):(0,s.jsx)(x.Z,{className:"w-5 h-5 text-gray-600 dark:text-gray-300"})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"text-sm font-bold text-gray-800 dark:text-white flex items-center gap-2",children:H?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("span",{className:"text-purple-600 dark:text-purple-400",children:"Private Booking"}),(0,s.jsx)("span",{className:"text-xs bg-purple-100 dark:bg-purple-900/30 text-purple-700 dark:text-purple-300 px-2 py-0.5 rounded-full font-medium",children:"Manual Mode"})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("span",{className:"text-gray-700 dark:text-gray-300",children:"Regular Booking"}),(0,s.jsx)("span",{className:"text-xs bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300 px-2 py-0.5 rounded-full font-medium",children:"Standard Mode"})]})}),(0,s.jsx)("p",{className:"text-xs text-gray-600 dark:text-gray-400 mt-0.5",children:H?"Walk-in or manual booking for internal tracking":"Online booking with standard workflow"})]})]}),(0,s.jsxs)(l.E.button,{type:"button",onClick:()=>J(!H),whileTap:{scale:.95},className:(0,i.cn)("relative inline-flex h-8 w-14 items-center rounded-full transition-all duration-300","focus:outline-none focus:ring-2 focus:ring-offset-2",H?"bg-gradient-to-r from-purple-600 to-pink-600 focus:ring-purple-500":"bg-gray-300 dark:bg-gray-600 focus:ring-gray-400"),children:[(0,s.jsx)("span",{className:"sr-only",children:"Toggle private mode"}),(0,s.jsx)(l.E.span,{animate:{x:H?28:4},transition:{type:"spring",stiffness:500,damping:30},className:"inline-block h-6 w-6 transform rounded-full bg-white shadow-lg"})]})]}),(0,s.jsx)(n.M,{children:H&&(0,s.jsxs)(l.E.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"mt-3 flex items-start gap-2 bg-purple-100 dark:bg-purple-900/30 rounded-lg p-2.5 border border-purple-200 dark:border-purple-700",children:[(0,s.jsx)(f.Z,{className:"w-4 h-4 text-purple-600 dark:text-purple-400 flex-shrink-0 mt-0.5"}),(0,s.jsx)("div",{className:"flex-1",children:(0,s.jsxs)("p",{className:"text-xs text-purple-800 dark:text-purple-200",children:[(0,s.jsx)("strong",{children:"Private Mode Active:"})," This booking will be marked as a private/walk-in booking for internal tracking."]})})]})})]}),(0,s.jsxs)(c.Zb,{className:"p-6 bg-gray-50 dark:bg-gray-700/30",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-4",children:[(0,s.jsx)("div",{className:"p-1 bg-yellow-100 dark:bg-yellow-900/30 rounded",children:(0,s.jsx)(y.Z,{className:"w-4 h-4 text-yellow-600"})}),(0,s.jsx)("h3",{className:"text-lg font-semibold text-gray-800 dark:text-white",children:"Payment Method"})]}),(0,s.jsx)("div",{className:"grid grid-cols-3 gap-4",children:em.map(e=>(0,s.jsx)(l.E.button,{type:"button",whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>{I(e),"Pass"!==e&&(F(""),L(null),q("")),ei.payment&&ed(e=>({...e,payment:""}))},className:(0,i.cn)("p-4 rounded-lg border transition-all duration-200",M===e?"border-emerald-500 bg-emerald-50 dark:bg-emerald-900/30 text-emerald-700 dark:text-emerald-300":"border-gray-300 dark:border-gray-600 hover:border-emerald-300 hover:bg-emerald-50/50 dark:hover:bg-emerald-900/20"),children:(0,s.jsxs)("div",{className:"flex items-center justify-center gap-2",children:["Cash"===e&&(0,s.jsx)(j.Z,{className:"w-5 h-5"}),"UPI"===e&&(0,s.jsx)(y.Z,{className:"w-5 h-5"}),"Pass"===e&&(0,s.jsx)(N.Z,{className:"w-5 h-5"}),(0,s.jsx)("span",{className:"font-medium",children:e})]})},e))}),(0,s.jsx)(n.M,{children:"Pass"===M&&(0,s.jsxs)(l.E.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"mt-4 space-y-2",children:[(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)("input",{type:"text",value:z,onChange:e=>F(e.target.value.toUpperCase()),onBlur:()=>{z.trim()&&e_(z)},placeholder:"Enter Pass UID (HFG-XXXXXXXXXXXX)",className:"w-full px-3 py-2 bg-white dark:bg-gray-800 rounded border border-gray-300 dark:border-gray-600 focus:border-emerald-500 focus:outline-none focus:ring-1 focus:ring-emerald-500/20 transition-all duration-200 text-sm"}),O&&(0,s.jsx)(k.Z,{className:"w-4 h-4 animate-spin text-emerald-600 absolute right-3 top-2.5"})]}),R&&!V&&(0,s.jsx)(l.E.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"bg-emerald-50 dark:bg-emerald-900/20 rounded-lg p-2 border border-emerald-200 dark:border-emerald-700",children:(0,s.jsxs)("div",{className:"flex items-start gap-2",children:[(0,s.jsx)(m.Z,{className:"w-4 h-4 text-emerald-600 flex-shrink-0 mt-0.5"}),(0,s.jsxs)("div",{className:"flex-1 text-xs space-y-1",children:[(0,s.jsx)("p",{className:"font-semibold text-emerald-800 dark:text-emerald-200",children:R.pass_name}),(0,s.jsxs)("div",{className:"flex justify-between text-emerald-700 dark:text-emerald-300",children:[(0,s.jsx)("span",{children:"Hours Available"}),(0,s.jsxs)("span",{className:"font-bold",children:[R.remaining_hours,"/",R.total_hours]})]}),D.length>0&&(0,s.jsxs)("div",{className:"flex justify-between text-emerald-600 dark:text-emerald-400",children:[(0,s.jsx)("span",{children:"Hours Needed"}),(0,s.jsxs)("span",{className:"font-bold",children:[.5*D.length," hrs"]})]})]})]})}),V&&(0,s.jsxs)(l.E.p,{initial:{opacity:0,y:-5},animate:{opacity:1,y:0},className:"text-xs text-red-500 flex items-center gap-1",children:[(0,s.jsx)(g.Z,{className:"w-3 h-3"}),V]}),ei.pass&&(0,s.jsx)(l.E.p,{initial:{opacity:0,y:-5},animate:{opacity:1,y:0},className:"text-xs text-red-500",children:ei.pass})]})}),ei.payment&&(0,s.jsx)("p",{className:"text-red-500 text-sm mt-2",children:ei.payment})]})]}),(0,s.jsx)("div",{className:"space-y-6",children:(0,s.jsxs)(c.Zb,{className:"p-6 bg-gray-50 dark:bg-gray-700/30",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-4",children:[(0,s.jsx)("div",{className:"p-1 bg-indigo-100 dark:bg-indigo-900/30 rounded",children:(0,s.jsx)(v.Z,{className:"w-4 h-4 text-indigo-600"})}),(0,s.jsx)("h3",{className:"text-lg font-semibold text-gray-800 dark:text-white",children:"Pricing Summary"})]}),(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center py-2 border-b border-gray-200 dark:border-gray-600",children:[(0,s.jsx)("span",{className:"text-gray-600 dark:text-gray-400",children:"Console Total:"}),(0,s.jsxs)("span",{className:"font-medium text-gray-800 dark:text-white",children:["₹",eM]})]}),(0,s.jsxs)("div",{className:"flex justify-between items-center py-2 border-b border-gray-200 dark:border-gray-600",children:[(0,s.jsx)("span",{className:"text-gray-600 dark:text-gray-400",children:"Manual Waive Off:"}),(0,s.jsx)("input",{type:"number",value:G,onChange:e=>Y(Number(e.target.value)||0),placeholder:"₹0",className:"w-20 text-right px-2 py-1 rounded border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-800 dark:text-white focus:border-emerald-500 focus:outline-none transition-colors",min:0})]}),Q>0&&(0,s.jsxs)("div",{className:"flex justify-between items-center py-2 border-b border-gray-200 dark:border-gray-600 bg-orange-50 dark:bg-orange-900/20 rounded-lg px-3",children:[(0,s.jsx)("span",{className:"text-orange-600 dark:text-orange-400 font-medium",children:"⏰ Auto Waive Off:"}),(0,s.jsxs)("div",{className:"text-right",children:[(0,s.jsxs)("span",{className:"font-bold text-orange-600 dark:text-orange-400",children:["₹",Math.round(Q)]}),(0,s.jsx)("div",{className:"text-xs text-orange-500 dark:text-orange-300",children:"(Time-based discount)"})]})]}),(0,s.jsxs)("div",{className:"flex justify-between items-center py-2 border-b border-gray-200 dark:border-gray-600",children:[(0,s.jsx)("span",{className:"text-gray-600 dark:text-gray-400",children:"Extra Controller:"}),(0,s.jsx)("input",{type:"number",value:K,onChange:e=>W(Number(e.target.value)||0),placeholder:"₹0",className:"w-20 text-right px-2 py-1 rounded border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-800 dark:text-white focus:border-emerald-500 focus:outline-none transition-colors",min:0})]}),(0,s.jsxs)("div",{className:"flex justify-between items-center py-2 border-b border-gray-200 dark:border-gray-600",children:[(0,s.jsx)("span",{className:"text-gray-600 dark:text-gray-400",children:"Meals & Extras:"}),(0,s.jsxs)("button",{type:"button",onClick:()=>es(!0),className:"flex items-center gap-2 px-3 py-1.5 bg-gradient-to-r from-emerald-100 to-green-100 dark:from-emerald-900/30 dark:to-green-900/30 text-emerald-700 dark:text-emerald-300 rounded-lg text-sm hover:from-emerald-200 hover:to-green-200 dark:hover:from-emerald-900/50 dark:hover:to-green-900/50 transition-all duration-200 border border-emerald-200 dark:border-emerald-700",children:[(0,s.jsx)(w.Z,{className:"w-3 h-3"}),0===ee.length?"Add Meals":"".concat(ee.length," Selected")]})]}),ee.length>0&&(0,s.jsx)("div",{className:"py-2 border-b border-gray-200 dark:border-gray-600",children:(0,s.jsxs)("div",{className:"space-y-2",children:[ee.map(e=>(0,s.jsx)("div",{className:"bg-emerald-50 dark:bg-emerald-900/20 rounded-lg p-3",children:(0,s.jsxs)("div",{className:"flex justify-between items-start",children:[(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("span",{className:"font-medium text-emerald-800 dark:text-emerald-200 text-sm",children:e.name}),(0,s.jsxs)("div",{className:"text-xs text-emerald-600 dark:text-emerald-400 mt-1",children:[e.category," • ₹",e.price," \xd7 ",e.quantity]})]}),(0,s.jsxs)("span",{className:"font-bold text-emerald-700 dark:text-emerald-300 text-sm",children:["₹",e.total]})]})},e.menu_item_id)),(0,s.jsx)("div",{className:"text-right pt-2 border-t border-emerald-200 dark:border-emerald-700",children:(0,s.jsxs)("span",{className:"text-sm font-bold text-emerald-600 dark:text-emerald-400",children:["Meals Total: ₹",eA]})})]})}),(0,s.jsxs)("div",{className:"flex justify-between items-center py-3 bg-emerald-50 dark:bg-emerald-900/30 rounded-lg px-3",children:[(0,s.jsx)("span",{className:"font-bold text-gray-800 dark:text-white text-lg",children:"Final Total:"}),(0,s.jsxs)("span",{className:"font-bold text-2xl text-emerald-600",children:["₹",eI]})]})]})]})})]}),(0,s.jsxs)("div",{className:"flex gap-4 pt-6 border-t border-gray-200 dark:border-gray-700",children:[(0,s.jsx)(d.z,{type:"button",onClick:a,variant:"outline",className:"flex-1 bg-white hover:bg-gray-50 border-gray-300 text-gray-700 hover:text-gray-900 dark:bg-gray-700 dark:border-gray-600 dark:text-gray-300 dark:hover:bg-gray-600 dark:hover:text-white",children:"Cancel"}),(0,s.jsx)(d.z,{type:"submit",disabled:er,className:"flex-1 bg-gradient-to-r from-emerald-600 to-green-600 hover:from-emerald-700 hover:to-green-700 text-white disabled:opacity-50",children:er?(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(k.Z,{className:"w-4 h-4 animate-spin"}),"Creating Booking..."]}):(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(m.Z,{className:"w-4 h-4"}),"Complete Booking - ₹",eI]})})]})]})}),(0,s.jsx)(U,{vendorId:ew()||0,isOpen:ea,onClose:()=>{console.log("\uD83C\uDF7D️ Meal selector closed"),es(!1)},onConfirm:e=>{console.log("\uD83C\uDF7D️ Meals confirmed:",e),et(e),es(!1)},initialSelectedMeals:ee})]})})}):null}function ex(e){let{label:t,color:a,icon:r,onClick:l,selected:n=!1,disabled:o=!1}=e;return(0,s.jsxs)("button",{onClick:l,disabled:o,className:(0,i.cn)("w-full h-full min-h-[36px] flex items-center justify-center rounded-md text-[10px] font-bold uppercase tracking-wide","transition-all duration-200 cursor-pointer",o&&"cursor-not-allowed opacity-60",{green:n?"bg-emerald-600 text-white ring-2 ring-emerald-400 shadow-lg":"bg-emerald-600 text-white hover:bg-emerald-700",blue:n?"bg-emerald-600 text-white ring-2 ring-emerald-400 shadow-lg":"bg-blue-600 text-white hover:bg-blue-700",purple:n?"bg-emerald-600 text-white ring-2 ring-emerald-400 shadow-lg":"bg-purple-600 text-white hover:bg-purple-700",yellow:n?"bg-emerald-600 text-white ring-2 ring-emerald-400 shadow-lg":"bg-yellow-500 text-white hover:bg-yellow-600",red:"bg-red-600 text-white"}[a]),children:[r?(0,s.jsx)(r,{className:"h-3 w-3 mr-0.5"}):null,(0,s.jsx)("span",{className:"truncate",children:t})]})}function eu(e){let{children:t,active:a=!1,icon:r,onClick:l}=e;return(0,s.jsxs)("button",{type:"button",onClick:l,className:(0,i.cn)("inline-flex items-center gap-1.5 rounded-lg px-3 py-2 text-xs font-medium uppercase","transition-all duration-200",a?"bg-blue-600 text-white shadow-md":"bg-gray-700 text-gray-300 hover:bg-gray-600 border border-gray-600"),children:[r?(0,s.jsx)(r,{className:"h-3.5 w-3.5"}):null,t]})}function eh(e){let{selectedSlots:t,onNewBooking:a}=e,[l,n]=(0,r.useState)(!1),[o,m]=(0,r.useState)(null);return o?(0,s.jsx)("div",{className:"fixed inset-0 z-50 bg-black/50 backdrop-blur-sm p-4",children:(0,s.jsxs)("div",{className:"max-w-6xl mx-auto mt-8",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,s.jsxs)("h2",{className:"text-2xl font-bold text-white",children:["change"===o&&"Change Booking","reject"===o&&"Reject Booking","list"===o&&"List Bookings"]}),(0,s.jsxs)(d.z,{variant:"ghost",onClick:()=>m(null),className:"text-white hover:bg-white/10",children:[(0,s.jsx)(g.Z,{className:"w-5 h-5 mr-2"}),"Back"]})]}),(0,s.jsxs)(c.Zb,{className:"bg-white dark:bg-gray-800 shadow-2xl",children:["change"===o&&(0,s.jsx)(ey,{}),"reject"===o&&(0,s.jsx)(ej,{}),"list"===o&&(0,s.jsx)(eN,{})]})]})}):(0,s.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-3 mb-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-2xl font-bold tracking-tight text-white",children:"Slot Management"}),(0,s.jsx)("p",{className:"text-sm text-gray-400 mt-1",children:"Manage and monitor console bookings."})]}),(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsxs)(d.z,{onClick:a,disabled:0===t.length,className:(0,i.cn)("rounded-lg text-white shadow-lg transition-all duration-200","px-5 py-2 text-sm font-semibold",t.length>0?"bg-blue-600 hover:bg-blue-700":"bg-gray-500 cursor-not-allowed"),children:[(0,s.jsx)(w.Z,{className:"mr-2 h-4 w-4"}),"New Booking ",t.length>0&&"(".concat(t.length,")")]}),(0,s.jsxs)(K,{open:l,onOpenChange:n,children:[(0,s.jsx)(W,{asChild:!0,children:(0,s.jsx)(d.z,{variant:"outline",size:"icon",className:"rounded-lg border-gray-600 bg-gray-700 hover:bg-gray-600",children:(0,s.jsx)(D.Z,{className:"w-5 h-5"})})}),(0,s.jsxs)(Q,{align:"end",className:"w-56",children:[(0,s.jsxs)($,{onClick:()=>{m("change"),n(!1)},children:[(0,s.jsx)(ee.Z,{className:"w-4 h-4 mr-2"}),"Change Booking"]}),(0,s.jsxs)($,{onClick:()=>{m("reject"),n(!1)},children:[(0,s.jsx)(et.Z,{className:"w-4 h-4 mr-2"}),"Reject Booking"]}),(0,s.jsxs)($,{onClick:()=>{m("list"),n(!1)},children:[(0,s.jsx)(ea.Z,{className:"w-4 h-4 mr-2"}),"List Bookings"]})]})]})]})]})}function ep(e){let{selectedConsole:t,onConsoleChange:a}=e,r={PC:_.Z,PS5:S.Z,Xbox:C.Z,VR:Z.Z};return(0,s.jsx)(c.Zb,{className:"rounded-xl border border-gray-700 bg-gray-800/50 backdrop-blur-sm p-4 mb-6",children:(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("span",{className:"text-xs font-medium text-gray-400 uppercase",children:"Select Console"}),(0,s.jsx)("div",{className:"flex flex-wrap items-center gap-2",children:Object.entries(r).map(e=>{let[r,l]=e;return(0,s.jsx)(eu,{active:t===r,icon:l,onClick:()=>a(r),children:r},r)})})]})})}function eb(e){let{availableConsoles:t,selectedConsole:a,selectedSlots:l,onSlotSelect:n,allSlots:o,isLoading:i,fetchSlotBookings:d}=e,m=(()=>{let e=[];for(let t=0;t<3;t++){let a=new Date,s=new Date(a.getFullYear(),a.getMonth(),a.getDate()+t),r=s.getFullYear(),l=String(s.getMonth()+1).padStart(2,"0"),n=String(s.getDate()).padStart(2,"0"),o="".concat(r,"-").concat(l,"-").concat(n),i="".concat(n,"/").concat(l);e.push({date:i,fullDate:o})}return e})(),x=r.useMemo(()=>{let e=new Set;return Object.values(o).forEach(t=>{t.forEach(t=>{let a=t.start_time.slice(0,5);e.add(a)})}),Array.from(e).sort((e,t)=>{let[a,s]=e.split(":").map(Number),[r,l]=t.split(":").map(Number);return 60*a+s-(60*r+l)})},[o]),u=t.filter(e=>e.type===a),h=e=>{switch(e){case"PC":default:return _.Z;case"PS5":return S.Z;case"Xbox":return C.Z;case"VR":return Z.Z}},p=e=>{if(!e)return"green";let t=["green","blue","purple","yellow"];return t[e%t.length]},b=(e,t)=>l.some(a=>a.slot_id===e&&a.date===t),f=(e,t,a)=>{let s=(o[e.fullDate]||[]).find(e=>e.start_time.slice(0,5)===t&&e.console_id===a.id);if(!s)return;let r=new Date(new Date().toLocaleString("en-US",{timeZone:"Asia/Kolkata"})),l=new Date("".concat(e.fullDate,"T").concat(s.end_time,"+05:30")),i={slot_id:s.slot_id,date:e.fullDate,start_time:s.start_time,end_time:s.end_time,console_id:a.id,console_name:a.name,console_price:s.single_slot_price||a.price,available_count:s.available_slot||0};if(r>=l){console.log("\uD83D\uDD52 Past slot clicked, fetching past bookings..."),d([s.slot_id],e.fullDate);return}s.is_available&&n(i)};if(i)return(0,s.jsx)(c.Zb,{className:"rounded-2xl border border-gray-700 bg-gray-800/30 backdrop-blur-sm overflow-hidden",children:(0,s.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)(k.Z,{className:"w-8 h-8 animate-spin text-blue-500 mx-auto mb-3"}),(0,s.jsx)("p",{className:"text-gray-300",children:"Loading available slots..."})]})})});let y=m.map(e=>{let t=o[e.fullDate]||[];return{date:e.date,fullDate:e.fullDate,cells:x.map((a,r)=>{if(0===u.length)return(0,s.jsx)("span",{},r);let l=[];return u.forEach(r=>{let n=t.filter(e=>e.start_time.slice(0,5)===a&&e.console_id===r.id);if(0===n.length)return;let o=n[0],i=b(o.slot_id,e.fullDate),d=new Date(new Date().toLocaleString("en-US",{timeZone:"Asia/Kolkata"})),c=new Date("".concat(e.fullDate,"T").concat(o.end_time,"+05:30")),m=0===(o.available_slot||0);d>=c?l.push((0,s.jsxs)("div",{onClick:()=>f(e,a,r),className:"w-full h-full min-h-[40px] flex items-center justify-center bg-gray-500 dark:bg-gray-600 text-white rounded-md cursor-pointer hover:bg-gray-600 dark:hover:bg-gray-700 transition-colors",title:"Past slot - Click to view past bookings",children:[(0,s.jsx)(E.Z,{className:"h-4 w-4 mr-1"}),(0,s.jsx)("span",{className:"text-xs font-semibold",children:"PAST"})]},"past-".concat(e.fullDate,"-").concat(r.id))):m?l.push((0,s.jsx)("div",{className:"w-full h-full min-h-[40px] flex items-center justify-center bg-red-600 text-white rounded-md cursor-not-allowed",title:"Fully booked",children:(0,s.jsx)(g.Z,{className:"h-5 w-5 stroke-[3]"})},"unavailable-".concat(e.fullDate,"-").concat(r.id))):l.push((0,s.jsx)("div",{className:"w-full h-full min-h-[40px]",children:(0,s.jsx)(ex,{label:"".concat(r.name," - ").concat(o.available_slot),color:p(r.id),icon:h(r.type),onClick:()=>f(e,a,r),selected:i,disabled:!1})},"".concat(e.fullDate,"-").concat(o.slot_id)))}),(0,s.jsx)("div",{className:"flex flex-row flex-wrap gap-1 items-stretch h-full p-1",children:l},"".concat(e.fullDate,"-").concat(r))})}});return 0===x.length?(0,s.jsx)(c.Zb,{className:"rounded-2xl border border-gray-700 bg-gray-800/30 backdrop-blur-sm overflow-hidden",children:(0,s.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)(T.Z,{className:"w-12 h-12 text-gray-500 mx-auto mb-3"}),(0,s.jsx)("p",{className:"text-gray-300",children:"No slots available"})]})})}):(0,s.jsx)(c.Zb,{className:"rounded-2xl border border-gray-700 bg-gray-800/30 backdrop-blur-sm overflow-hidden",children:(0,s.jsx)("div",{className:"overflow-x-auto",children:(0,s.jsxs)("div",{className:"min-w-max",children:[(0,s.jsxs)("div",{className:"grid gap-2 p-4 pb-3 bg-gray-800/50",style:{gridTemplateColumns:"80px repeat(".concat(x.length,", minmax(110px, 1fr))")},children:[(0,s.jsx)("div",{className:"text-xs font-semibold text-gray-400 uppercase",children:"Date"}),x.map(e=>(0,s.jsx)("div",{className:"text-sm font-bold text-gray-200 text-center",children:e},e))]}),(0,s.jsx)("div",{className:"border-t border-gray-700",children:y.map(e=>(0,s.jsxs)("div",{className:"grid gap-2 p-4 py-3 border-b border-gray-700/50 last:border-b-0 hover:bg-gray-700/20 transition-colors",style:{gridTemplateColumns:"80px repeat(".concat(x.length,", minmax(110px, 1fr))")},children:[(0,s.jsx)("div",{className:"flex items-center text-sm font-bold text-white bg-gray-700/50 rounded-lg px-2 py-2 justify-center",children:e.date}),e.cells.map((t,a)=>(0,s.jsx)("div",{className:"min-h-[44px] rounded-lg border border-gray-700 bg-gray-800/50 backdrop-blur-sm",children:t},"".concat(e.fullDate,"-cell-").concat(a)))]},e.fullDate))})]})})})}function ef(e){let{bookings:t,isLoading:a}=e,r=t.some(e=>"completed"===e.status||"rejected"===e.status||"cancelled"===e.status),l=r?"Past":"Active";return a?(0,s.jsx)(c.Zb,{className:"p-6 mt-2 bg-gray-50 dark:bg-gray-700/30",children:(0,s.jsxs)("div",{className:"flex items-center justify-center py-8",children:[(0,s.jsx)(k.Z,{className:"w-6 h-6 animate-spin text-emerald-500"}),(0,s.jsx)("span",{className:"ml-2 text-gray-600 dark:text-gray-400",children:"Loading bookings..."})]})}):0===t.length?(0,s.jsx)(c.Zb,{className:"p-6 mt-2 bg-gray-50 dark:bg-gray-700/30",children:(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center py-8 text-center",children:[(0,s.jsx)("div",{className:"p-3 bg-gray-200 dark:bg-gray-600 rounded-full mb-3",children:(0,s.jsx)(f.Z,{className:"w-6 h-6 text-gray-500 dark:text-gray-400"})}),(0,s.jsxs)("p",{className:"text-gray-600 dark:text-gray-400 font-medium",children:["No ",r?"past":"active"," bookings for selected slot"]}),(0,s.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-500 mt-1",children:r?"This past slot has no booking history":"This slot is available for new bookings"})]})}):(0,s.jsxs)(c.Zb,{className:"p-4 mt-2 bg-gray-50 dark:bg-gray-700/30",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,s.jsxs)("h3",{className:"text-lg font-semibold text-gray-800 dark:text-white flex items-center gap-2",children:[r?(0,s.jsx)(E.Z,{className:"w-5 h-5 text-gray-600 dark:text-gray-400"}):(0,s.jsx)(T.Z,{className:"w-5 h-5 text-emerald-600"}),(0,s.jsxs)("span",{className:r?"text-gray-700 dark:text-gray-300":"",children:[l," Slot Bookings"]}),(0,s.jsxs)("span",{className:"text-sm font-normal text-gray-500",children:["(",t.length," ",l,")"]})]}),r&&(0,s.jsx)("span",{className:"px-3 py-1 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-full text-xs font-medium",children:"History"})]}),(0,s.jsx)("div",{className:"overflow-x-auto",children:(0,s.jsxs)(V.iA,{children:[(0,s.jsx)(V.xD,{children:(0,s.jsxs)(V.SC,{children:[(0,s.jsx)(V.ss,{className:"text-gray-700 dark:text-gray-300",children:"Booking ID"}),(0,s.jsx)(V.ss,{className:"text-gray-700 dark:text-gray-300",children:"Customer Details"}),(0,s.jsx)(V.ss,{className:"text-gray-700 dark:text-gray-300",children:"Time"}),(0,s.jsx)(V.ss,{className:"text-gray-700 dark:text-gray-300",children:"Status"}),(0,s.jsx)(V.ss,{className:"text-gray-700 dark:text-gray-300",children:"Meal Selection"}),(0,s.jsx)(V.ss,{className:"text-gray-700 dark:text-gray-300",children:"Actions"})]})}),(0,s.jsx)(V.RM,{children:t.map(e=>{var t,a;return(0,s.jsxs)(V.SC,{className:(0,i.cn)("hover:bg-gray-100 dark:hover:bg-gray-600/30",r&&"opacity-80"),children:[(0,s.jsx)(V.pj,{className:"font-medium text-emerald-600 dark:text-emerald-400",children:e.booking_fid}),(0,s.jsx)(V.pj,{children:(0,s.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,s.jsxs)("span",{className:"font-medium text-gray-800 dark:text-white flex items-center gap-1",children:[(0,s.jsx)(h.Z,{className:"w-3 h-3"}),e.customer_name]}),(0,s.jsxs)("span",{className:"text-xs text-gray-600 dark:text-gray-400 flex items-center gap-1",children:[(0,s.jsx)(u.Z,{className:"w-3 h-3"}),e.customer_email]}),(0,s.jsxs)("span",{className:"text-xs text-gray-600 dark:text-gray-400 flex items-center gap-1",children:[(0,s.jsx)(p.Z,{className:"w-3 h-3"}),e.customer_phone]})]})}),(0,s.jsx)(V.pj,{children:(0,s.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,s.jsxs)("span",{className:"text-xs text-gray-700 dark:text-gray-300 font-medium",children:[null===(t=e.slot_start_time)||void 0===t?void 0:t.slice(0,5)," - ",null===(a=e.slot_end_time)||void 0===a?void 0:a.slice(0,5)]}),(0,s.jsx)("span",{className:"text-xs text-gray-500",children:new Date(e.booking_date).toLocaleDateString("en-GB")})]})}),(0,s.jsx)(V.pj,{children:(0,s.jsx)("span",{className:(0,i.cn)("px-2 py-1 rounded-full text-xs font-medium","confirmed"===e.status&&"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400","checked_in"===e.status&&"bg-orange-100 text-orange-700 dark:bg-orange-900/30 dark:text-orange-400","pending_verified"===e.status&&"bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400","completed"===e.status&&"bg-gray-100 text-gray-700 dark:bg-gray-700 dark:text-gray-300","cancelled"===e.status&&"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400","rejected"===e.status&&"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400"),children:"checked_in"===e.status?"Checked-In":"pending_verified"===e.status?"Pending":e.status.charAt(0).toUpperCase()+e.status.slice(1)})}),(0,s.jsx)(V.pj,{children:(0,s.jsx)("div",{className:"flex items-center gap-1 text-sm text-gray-700 dark:text-gray-300",children:e.meals&&e.meals.length>0?(0,s.jsxs)("div",{className:"flex items-center gap-1",children:[(0,s.jsx)(v.Z,{className:"w-4 h-4 text-emerald-600"}),(0,s.jsx)("span",{className:"text-xs",children:e.meal_selection})]}):(0,s.jsx)("span",{className:"text-gray-500 italic text-xs",children:"No meal selected"})})}),(0,s.jsx)(V.pj,{children:(0,s.jsx)(d.z,{variant:"ghost",size:"sm",className:(0,i.cn)("text-xs",r?"text-gray-600 hover:text-gray-700 hover:bg-gray-100 dark:hover:bg-gray-700":"text-emerald-600 hover:text-emerald-700 hover:bg-emerald-50 dark:hover:bg-emerald-900/30"),children:r?"View History":"View Details"})})]},e.booking_id)})})]})}),(0,s.jsxs)("div",{className:"mt-4 pt-4 border-t border-gray-200 dark:border-gray-600 flex items-center justify-between",children:[(0,s.jsx)("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:r?(0,s.jsxs)("span",{className:"flex items-center gap-2",children:[(0,s.jsx)(E.Z,{className:"w-4 h-4"}),"Historical records for this time slot"]}):(0,s.jsxs)("span",{className:"flex items-center gap-2",children:[(0,s.jsx)(T.Z,{className:"w-4 h-4"}),"Currently active bookings"]})}),(0,s.jsx)("div",{className:"flex items-center gap-3 text-xs",children:["confirmed","checked_in","pending_verified","completed","cancelled"].map(e=>{let a=t.filter(t=>t.status===e).length;return 0===a?null:(0,s.jsxs)("span",{className:"flex items-center gap-1",children:[(0,s.jsx)("span",{className:(0,i.cn)("w-2 h-2 rounded-full","confirmed"===e&&"bg-green-500","checked_in"===e&&"bg-orange-500","pending_verified"===e&&"bg-blue-500","completed"===e&&"bg-gray-500","cancelled"===e&&"bg-red-500")}),(0,s.jsxs)("span",{className:"text-gray-600 dark:text-gray-400",children:["checked_in"===e?"Checked-In":"pending_verified"===e?"Pending":e.charAt(0).toUpperCase()+e.slice(1),": ",a]})]},e)})})]})]})}function ey(){var e,t,a;let[l,n]=(0,r.useState)(""),[i,c]=(0,r.useState)(!1),[g,x]=(0,r.useState)(!1),[u,h]=(0,r.useState)(null),[p,b]=(0,r.useState)([]),[f,y]=(0,r.useState)(!1),[j,N]=(0,r.useState)(!1),[v,w]=(0,r.useState)(null);(0,r.useEffect)(()=>{let e=localStorage.getItem("jwtToken");e&&w((0,o.o)(e).sub.id)},[]);let D=async()=>{if(l){c(!0);try{let e=await fetch("".concat(P.o8,"/api/bookings/").concat(l)),t=await e.json();if(e.ok&&t.success&&t.booking){N(!1);let{booking:e}=t;h({customer:e.customer||{name:"",email:"",phone:""},booking_date:e.date||"",selected_slots:["".concat(e.time_slot.start_time)],system:e.system||"",vendorId:v,consoleTypeId:e.game_id}),x(!0),await _(1,e.game_id,e.date)}else x(!1)}catch(e){console.error("Error fetching booking:",e),x(!1)}finally{c(!1)}}},_=async(e,t,a)=>{try{let s=await fetch("".concat(P.o8,"/api/getSlots/vendor/").concat(e,"/game/").concat(t,"/").concat(a.replaceAll("-",""))),r=await s.json();s.ok&&r.slots&&b(r.slots)}catch(e){console.error("Error fetching available slots:",e)}},S=async e=>{if(e.preventDefault(),y(!0),u)try{let e=await fetch("".concat(P.o8,"/api/update_booking/").concat(l),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(u)});await e.json(),e.ok?N(!0):alert("Failed to update booking.")}catch(e){console.error("Error updating booking:",e)}finally{y(!1)}};return(0,s.jsx)("div",{className:"p-6",children:(0,s.jsxs)("form",{className:"space-y-8",children:[(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold text-gray-800 dark:text-white",children:"Search Booking"}),(0,s.jsxs)("div",{className:"flex space-x-2",children:[(0,s.jsx)("input",{id:"bookingId",placeholder:"Enter Booking ID",value:l,onChange:e=>n(e.target.value),className:"flex-1 px-4 py-3 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-emerald-500 text-gray-800 dark:text-white"}),(0,s.jsx)(d.z,{type:"button",onClick:D,disabled:i,className:"min-w-[100px] bg-emerald-600 hover:bg-emerald-700",children:i?(0,s.jsx)(k.Z,{className:"w-4 h-4 animate-spin"}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(es.Z,{className:"w-4 h-4 mr-2"}),"Search"]})})]})]}),g&&u&&!j?(0,s.jsxs)("div",{className:"space-y-8",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold text-gray-800 dark:text-white",children:"Gamer's Information"}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Name"}),(0,s.jsx)("input",{value:(null===(e=u.customer)||void 0===e?void 0:e.name)||"",onChange:e=>h(t=>({...t,customer:{...t.customer,name:e.target.value}})),className:"w-full px-4 py-3 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-emerald-500 text-gray-800 dark:text-white"})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Email"}),(0,s.jsx)("input",{type:"email",value:(null===(t=u.customer)||void 0===t?void 0:t.email)||"",onChange:e=>h(t=>({...t,customer:{...t.customer,email:e.target.value}})),className:"w-full px-4 py-3 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-emerald-500 text-gray-800 dark:text-white"})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Phone Number"}),(0,s.jsx)("input",{type:"tel",value:(null===(a=u.customer)||void 0===a?void 0:a.phone)||"",onChange:e=>h(t=>({...t,customer:{...t.customer,phone:e.target.value}})),className:"w-full px-4 py-3 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-emerald-500 text-gray-800 dark:text-white"})]})]}),(0,s.jsx)("h3",{className:"text-lg font-semibold text-gray-800 dark:text-white",children:"Booking Details"}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Booking Date"}),(0,s.jsx)("input",{type:"date",value:u.booking_date||"",onChange:e=>h(t=>({...t,booking_date:e.target.value})),className:"w-full px-4 py-3 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-emerald-500 text-gray-800 dark:text-white"})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Slot Time"}),(0,s.jsx)("div",{className:"grid grid-cols-6 gap-2",children:p.map(e=>(0,s.jsx)(d.z,{type:"button",variant:"outline",disabled:!e.is_available,className:"rounded-full text-xs ".concat(u.selected_slots.includes(e.start_time)?"bg-emerald-600 text-white hover:bg-emerald-700":""),onClick:()=>h(t=>({...t,selected_slots:[e.start_time]})),children:e.start_time},e.slot_id))})]})]}),(0,s.jsx)(d.z,{onClick:S,disabled:f,className:"bg-emerald-600 hover:bg-emerald-700",children:f?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(k.Z,{className:"w-4 h-4 mr-2 animate-spin"}),"Updating..."]}):"Update Booking"})]}):null,j&&(0,s.jsxs)(q.bZ,{className:"bg-emerald-50 dark:bg-emerald-900/20 border-emerald-500",children:[(0,s.jsx)(m.Z,{className:"h-4 w-4 text-emerald-600"}),(0,s.jsx)(q.X,{className:"text-emerald-700 dark:text-emerald-300",children:"Booking has been successfully updated."})]})]})})}function ej(){var e,t,a;let[i,g]=(0,r.useState)(""),[x,u]=(0,r.useState)(!1),[h,p]=(0,r.useState)(""),[b,y]=(0,r.useState)(""),[j,N]=(0,r.useState)(""),[v,w]=(0,r.useState)(null),[D,_]=(0,r.useState)(!1),[S,C]=(0,r.useState)(!1),[Z,E]=(0,r.useState)(!1),[T,B]=(0,r.useState)(!1),[A,M]=(0,r.useState)(null);(0,r.useEffect)(()=>{let e=localStorage.getItem("jwtToken");e&&M((0,o.o)(e).sub.id)},[]);let I=async()=>{if(i){E(!0);try{let t=await fetch("".concat(P.o8,"/api/bookings/").concat(i)),a=await t.json();if(t.ok&&a.success&&a.booking){var e;B(!1);let{booking:t}=a;w({customer:t.customer||{name:"",email:"",phone:""},booking_date:t.date||"",booking_id:t.booking_id,selected_slots:["".concat(t.time_slot.start_time)],system:t.system||"",vendorId:A,consoleTypeId:t.game_id,start_time:t.time_slot.start_time,end_time:t.time_slot.end_time,amount_paid:t.amount_paid}),N((null===(e=t.customer)||void 0===e?void 0:e.email)||""),u(!0)}else u(!1)}catch(e){console.error("Error fetching booking:",e),u(!1)}finally{E(!1)}}},z=async e=>{if(e.preventDefault(),!D){_(!0);return}C(!0),E(!0);try{(await fetch("".concat(P.o8,"/api/bookings/reject"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({booking_id:i,rejection_reason:h,repayment_type:b,user_email:j})})).ok?B(!0):console.error("Error rejecting booking")}catch(e){console.error("Error:",e)}finally{C(!1),E(!1)}};return(0,s.jsx)("div",{className:"p-6",children:(0,s.jsxs)("form",{className:"space-y-8",onSubmit:z,children:[(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold text-gray-800 dark:text-white",children:"Search Booking"}),(0,s.jsxs)("div",{className:"flex space-x-2",children:[(0,s.jsx)("input",{placeholder:"Enter Booking ID",value:i,onChange:e=>g(e.target.value),className:"flex-1 px-4 py-3 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-emerald-500 text-gray-800 dark:text-white"}),(0,s.jsx)(d.z,{type:"button",onClick:I,disabled:Z,className:"min-w-[100px] bg-emerald-600 hover:bg-emerald-700",children:Z?(0,s.jsx)(k.Z,{className:"w-4 h-4 animate-spin"}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(es.Z,{className:"w-4 h-4 mr-2"}),"Search"]})})]})]}),T?(0,s.jsxs)(q.bZ,{className:"bg-emerald-50 dark:bg-emerald-900/20 border-emerald-500",children:[(0,s.jsx)(m.Z,{className:"h-4 w-4 text-emerald-600"}),(0,s.jsx)(q.X,{className:"text-emerald-700 dark:text-emerald-300",children:"Booking has been successfully rejected."})]}):(0,s.jsx)(n.M,{children:x&&v&&(0,s.jsxs)(l.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"space-y-8",children:[(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold text-gray-800 dark:text-white",children:"Booking Information"}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,s.jsx)(c.Zb,{className:"bg-gray-50 dark:bg-gray-700/30 p-6",children:(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{className:"text-gray-600 dark:text-gray-400",children:"Booking ID"}),(0,s.jsx)("span",{className:"font-medium text-gray-800 dark:text-white",children:v.booking_id||""})]}),(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{className:"text-gray-600 dark:text-gray-400",children:"Date"}),(0,s.jsx)("span",{className:"font-medium text-gray-800 dark:text-white",children:v.booking_date||""})]}),(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{className:"text-gray-600 dark:text-gray-400",children:"Time Slot"}),(0,s.jsxs)("span",{className:"font-medium text-gray-800 dark:text-white",children:[v.start_time||""," - ",v.end_time||""]})]}),(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{className:"text-gray-600 dark:text-gray-400",children:"System"}),(0,s.jsx)("span",{className:"font-medium text-gray-800 dark:text-white",children:v.system||""})]})]})}),(0,s.jsx)(c.Zb,{className:"bg-gray-50 dark:bg-gray-700/30 p-6",children:(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{className:"text-gray-600 dark:text-gray-400",children:"Customer"}),(0,s.jsx)("span",{className:"font-medium text-gray-800 dark:text-white",children:(null===(e=v.customer)||void 0===e?void 0:e.name)||""})]}),(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{className:"text-gray-600 dark:text-gray-400",children:"Email"}),(0,s.jsx)("span",{className:"font-medium text-gray-800 dark:text-white",children:(null===(t=v.customer)||void 0===t?void 0:t.email)||""})]}),(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{className:"text-gray-600 dark:text-gray-400",children:"Phone"}),(0,s.jsx)("span",{className:"font-medium text-gray-800 dark:text-white",children:(null===(a=v.customer)||void 0===a?void 0:a.phone)||""})]}),(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{className:"text-gray-600 dark:text-gray-400",children:"Amount Paid"}),(0,s.jsxs)("span",{className:"font-medium text-gray-800 dark:text-white",children:["₹",v.amount_paid||""]})]})]})})]})]}),(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold text-gray-800 dark:text-white",children:"Rejection Details"}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Reason for Rejection"}),(0,s.jsx)("textarea",{value:h,onChange:e=>p(e.target.value),placeholder:"Please provide a detailed reason for rejecting this booking...",className:"w-full min-h-[100px] px-4 py-3 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-emerald-500 text-gray-800 dark:text-white resize-none"})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Repayment Method"}),(0,s.jsxs)(X.Ph,{value:b,onValueChange:y,children:[(0,s.jsx)(X.i4,{className:"bg-white dark:bg-gray-700 border-gray-300 dark:border-gray-600",children:(0,s.jsx)(X.ki,{placeholder:"Select repayment method"})}),(0,s.jsxs)(X.Bw,{children:[(0,s.jsx)(X.Ql,{value:"refund",children:"Full Refund to Original Payment Method"}),(0,s.jsx)(X.Ql,{value:"credit",children:"Store Credit"}),(0,s.jsx)(X.Ql,{value:"reschedule",children:"Reschedule to Another Date"})]})]})]})]})]}),D?(0,s.jsxs)(q.bZ,{variant:"destructive",className:"mt-6",children:[(0,s.jsx)(f.Z,{className:"h-4 w-4"}),(0,s.jsxs)(q.X,{className:"flex items-center justify-between",children:[(0,s.jsx)("span",{children:"Are you sure you want to reject this booking? This action cannot be undone."}),(0,s.jsxs)("div",{className:"flex space-x-2 mt-2",children:[(0,s.jsx)(d.z,{type:"button",variant:"outline",onClick:()=>_(!1),children:"Cancel"}),(0,s.jsx)(d.z,{type:"submit",variant:"destructive",disabled:S||Z,children:S||Z?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(k.Z,{className:"w-4 h-4 mr-2 animate-spin"}),"Confirming..."]}):"Confirm Rejection"})]})]})]}):(0,s.jsxs)(d.z,{type:"submit",variant:"destructive",className:"w-full",disabled:!h||!b,children:[(0,s.jsx)(et.Z,{className:"w-4 h-4 mr-2"}),"Reject Booking"]})]})})]})})}function eN(){let[e,t]=(0,r.useState)(null),[a,n]=(0,r.useState)([]),[i,c]=(0,r.useState)([]),[m,g]=(0,r.useState)(""),[x,u]=(0,r.useState)(null),[h,p]=(0,r.useState)({}),b=e=>{p(t=>({...t,[e]:!t[e]}))},f=(0,r.useMemo)(()=>{let e={};return i.forEach(t=>{let a=t.bookedDate;e[a]||(e[a]=[]),e[a].push(t)}),e},[i]);(0,r.useEffect)(()=>{let e=localStorage.getItem("jwtToken");e&&t((0,o.o)(e).sub.id)},[]);let y=async()=>{try{let t=new Date,a=new Date(t.getFullYear(),t.getMonth(),1).toISOString().slice(0,10).replace(/-/g,""),s=(await er.Z.get("".concat(P.o8,"/api/getAllBooking/vendor/").concat(e,"/").concat(a,"/"),{headers:{"Content-Type":"application/json"}})).data.map(e=>({id:e.bookingId.toString(),bookingDate:e.bookingDate,bookingTime:e.bookingTime,username:e.userName,consoleType:e.consoleType,bookedDate:e.bookedDate,startTime:e.startTime||null,endTime:e.endTime||null,status:e.status,type:e.type}));n(s),c(s)}catch(e){console.error("Error fetching data:",e.response?e.response.data:e.message)}};(0,r.useEffect)(()=>{e&&y()},[e]),(0,r.useEffect)(()=>{x&&c([...i].sort((e,t)=>{if("bookingDate"===x.key){let a=new Date(e.bookingDate),s=new Date(t.bookingDate);return"asc"===x.direction?a.getTime()-s.getTime():s.getTime()-a.getTime()}{var a,s;let r=(null===(a=e[x.key])||void 0===a?void 0:a.toString().toLowerCase())||"",l=(null===(s=t[x.key])||void 0===s?void 0:s.toString().toLowerCase())||"";return r<l?"asc"===x.direction?-1:1:r>l?"asc"===x.direction?1:-1:0}}))},[x]);let j=e=>{u(t=>({key:e,direction:(null==t?void 0:t.key)===e&&"asc"===t.direction?"desc":"asc"}))},N=()=>{if(m.trim()){let e=m.toLowerCase();c(a.filter(t=>Object.values(t).some(t=>t.toString().toLowerCase().includes(e))))}else c(a)};(0,r.useEffect)(()=>{N()},[m]);let k=e=>(0,s.jsx)("span",{className:"px-3 py-1 rounded-full text-xs font-medium ".concat({rejected:"bg-red-100 dark:bg-red-950 text-red-700 dark:text-red-300",confirmed:"bg-emerald-100 dark:bg-emerald-950 text-emerald-700 dark:text-emerald-300"}[e]||"bg-gray-300 text-gray-700 dark:bg-gray-700 dark:text-gray-300"),children:e}),v=e=>{if("number"==typeof e){let t=new Date(e);return"".concat(t.getHours().toString().padStart(2,"0"),":").concat(t.getMinutes().toString().padStart(2,"0"))}let[t,a]=e.split(":");return"".concat(t,":").concat(a)};return(0,s.jsxs)("div",{className:"p-6 space-y-6",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,s.jsx)("input",{placeholder:"Search bookings...",value:m,onChange:e=>g(e.target.value),className:"flex-1 px-4 py-3 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-emerald-500 text-gray-800 dark:text-white"}),(0,s.jsxs)(d.z,{onClick:N,className:"bg-emerald-600 hover:bg-emerald-700",children:[(0,s.jsx)(es.Z,{className:"w-4 h-4 mr-2"}),"Search"]})]}),(0,s.jsx)("div",{className:"rounded-lg border border-gray-200 dark:border-gray-700 overflow-hidden",children:(0,s.jsxs)(V.iA,{children:[(0,s.jsx)(V.xD,{children:(0,s.jsx)(V.SC,{className:"bg-gray-50 dark:bg-gray-700/50",children:[{label:"Booked Date",key:"bookedDate"},{label:"Username",key:"username"},{label:"Status",key:"status"},{label:"Booking ID",key:"id"},{label:"Booking Date",key:"bookingDate"},{label:"Booking Time",key:"bookingTime"},{label:"Console Type",key:"consoleType"},{label:"Start Time",key:"startTime"},{label:"End Time",key:"endTime"},{label:"Type",key:"type"}].map(e=>{let{label:t,key:a}=e;return(0,s.jsxs)(V.ss,{className:"font-semibold cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",onClick:()=>j(a),children:[t," ",(null==x?void 0:x.key)===a&&("asc"===x.direction?"↑":"↓")]},a)})})}),(0,s.jsx)(V.RM,{children:Object.entries(f).map(e=>{let[t,a]=e;return(0,s.jsxs)(r.Fragment,{children:[(0,s.jsx)(V.SC,{className:"bg-gray-100 dark:bg-gray-700/30 cursor-pointer hover:bg-gray-200 dark:hover:bg-gray-700/50",onClick:()=>b(t),children:(0,s.jsxs)(V.pj,{colSpan:10,className:"font-bold text-gray-800 dark:text-white",children:[h[t]?"▼":"▶"," ",new Date(t).toDateString()," (",a.length,")"]})}),h[t]&&a.map((e,t)=>(0,s.jsxs)(l.E.tr,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{delay:.05*t},className:"hover:bg-gray-50 dark:hover:bg-gray-700/20",children:[(0,s.jsx)(V.pj,{children:e.bookedDate}),(0,s.jsx)(V.pj,{children:e.username}),(0,s.jsx)(V.pj,{children:k(e.status)}),(0,s.jsx)(V.pj,{children:e.id}),(0,s.jsx)(V.pj,{children:e.bookingDate}),(0,s.jsx)(V.pj,{children:e.bookingTime}),(0,s.jsx)(V.pj,{children:e.consoleType}),(0,s.jsx)(V.pj,{children:e.startTime?v(e.startTime):"Not started"}),(0,s.jsx)(V.pj,{children:e.endTime?v(e.endTime):"Not ended"}),(0,s.jsx)(V.pj,{children:e.type})]},e.id))]},t)})})]})})]})}function ek(){let[e,t]=(0,r.useState)("PC"),[a,l]=(0,r.useState)([]),[n,i]=(0,r.useState)(!1),[d,c]=(0,r.useState)([]),[m,g]=(0,r.useState)({}),[x,u]=(0,r.useState)([]),[h,p]=(0,r.useState)(!0),[b,f]=(0,r.useState)([]),[y,j]=(0,r.useState)(!1),N=(0,r.useRef)(!1),v=(0,r.useRef)(null),w=()=>{let e=localStorage.getItem("jwtToken");if(!e)return null;try{return(0,o.o)(e).sub.id}catch(e){return console.error("❌ Error decoding token:",e),null}},D=async(e,t)=>{let a=w();if(!a||0===e.length){f([]);return}j(!0),console.log("\uD83D\uDD0D Fetching bookings for slots:",e,"date:",t);let s=new Date(new Date().toLocaleString("en-US",{timeZone:"Asia/Kolkata"})),r=new Date(t)<new Date(s.toISOString().split("T")[0]);try{let s=e.join(","),l=await fetch("".concat(P.o8,"/api/vendor/").concat(a,"/slot-bookings?slot_ids=").concat(s,"&date=").concat(t).concat(r?"&include_completed=true":"")),n=await l.json();console.log("\uD83D\uDCE5 Slot bookings response:",n),n.success&&n.bookings?(f(n.bookings),console.log("✅ Loaded ".concat(n.bookings.length," ").concat(r?"past":"active"," bookings"))):(f([]),console.log("\uD83D\uDCED No bookings found"))}catch(e){console.error("❌ Error fetching slot bookings:",e),f([])}finally{j(!1)}};return((0,r.useEffect)(()=>{if(N.current){console.log("⚠️ Skipping duplicate fetch");return}return(async()=>{let e=w();if(!e){p(!1);return}N.current=!0,v.current=new AbortController,v.current.signal,p(!0);try{console.time("⏱️ Total fetch time"),console.log("\uD83D\uDCE1 Fetching consoles...");let t=await ed("".concat(P.o8,"/api/getAllConsole/vendor/").concat(e)),a=[{type:"PC",name:"PC Gaming",icon:_.Z,iconColor:"#7c3aed"},{type:"PS5",name:"PlayStation 5",icon:B.Z,iconColor:"#2563eb"},{type:"Xbox",name:"Xbox Series",icon:C.Z,iconColor:"#059669"},{type:"VR",name:"VR Gaming",icon:Z.Z,iconColor:"#ea580c"}].map(e=>{var a;let s=null===(a=t.games)||void 0===a?void 0:a.find(t=>{let a=(t.console_name||"").toLowerCase(),s=e.type.toLowerCase();return a.includes(s)||"pc"===s&&(a.includes("gaming")||a.includes("computer"))||"ps5"===s&&(a.includes("playstation")||a.includes("sony"))||"xbox"===s&&(a.includes("series")||a.includes("microsoft"))||"vr"===s&&(a.includes("virtual")||a.includes("reality"))});return s?{type:e.type,name:s.console_name,id:s.id,price:s.console_price,icon:e.icon,iconColor:e.iconColor,color:"grey",description:"".concat(e.type," Gaming Console")}:null}).filter(Boolean);if(c(a),console.log("✅ Available consoles:",a),0===a.length){console.log("⚠️ No consoles available"),g({}),p(!1);return}let s=[];for(let e=0;e<3;e++){let t=new Date,a=new Date(t.getFullYear(),t.getMonth(),t.getDate()+e),r=a.getFullYear(),l=String(a.getMonth()+1).padStart(2,"0"),n=String(a.getDate()).padStart(2,"0");s.push("".concat(r,"-").concat(l,"-").concat(n))}console.log("\uD83D\uDCC5 Dates to fetch:",s),console.log("\uD83D\uDCE1 Fetching slots with BATCH API...");let r=new Date(new Date().toLocaleString("en-US",{timeZone:"Asia/Kolkata"}));try{let t=a.map(e=>e.id).filter(Boolean),l=s.map(e=>e.replace(/-/g,""));console.log("\uD83D\uDE80 Batch request:",{vendorId:e,gameIds:t,dates:l});let n=await ec(e,t,l);console.log("✅ Batch data received:",n);let o={};for(let[e,t]of(s.forEach(e=>{o[e]=[]}),Object.entries(n))){let l="".concat(e.slice(0,4),"-").concat(e.slice(4,6),"-").concat(e.slice(6,8));if(Array.isArray(t)){let e=t.map(e=>{let t=a.find(t=>t.id===e.console_id),n={...e,console_id:e.console_id,console_name:(null==t?void 0:t.name)||"Unknown Console",date:l,is_available:(e.available_slot||0)>0,available_slot:e.available_slot||0};if(l===s[0]){let t=new Date("".concat(l,"T").concat(e.end_time,"+05:30"));r>=t&&(n.is_available=!1)}return n});o[l]=e}}console.log("✅ Final slots data:",o),g(o)}catch(o){if("AbortError"===o.name)throw o;console.error("❌ Batch fetch failed, falling back to individual requests:",o),console.log("⚠️ Using parallel fetches as fallback...");let t=s.flatMap(t=>a.map(async a=>{if(!a.id)return null;try{let l=t.replace(/-/g,""),n="".concat(P.o8,"/api/getSlots/vendor/").concat(e,"/game/").concat(a.id,"/").concat(l),o=await ed(n);if(o.slots&&Array.isArray(o.slots)){let e=o.slots.map(e=>{let l={...e,console_id:a.id,console_name:a.name,date:t,is_available:e.is_available};if(t===s[0]){let a=new Date("".concat(t,"T").concat(e.end_time,"+05:30"));r>=a&&(l.is_available=!1)}return l});return{dateString:t,slots:e}}}catch(e){console.error("❌ Error fetching slots for ".concat(a.name," on ").concat(t,":"),e)}return null})),l=await Promise.all(t),n={};s.forEach(e=>{n[e]=[]}),l.forEach(e=>{e&&e.dateString&&e.slots&&n[e.dateString].push(...e.slots)}),g(n)}console.timeEnd("⏱️ Total fetch time"),u([])}catch(e){"AbortError"!==e.name&&console.error("❌ Error in fetchData:",e)}finally{p(!1),console.log("✅ Loading complete")}})(),()=>{v.current&&v.current.abort()}},[]),(0,r.useEffect)(()=>{a.length>0?D(a.map(e=>e.slot_id),a[0].date):f([])},[a]),(0,r.useEffect)(()=>{let e=()=>{N.current=!1,el.clear(),ei.clear(),window.location.reload()};return window.addEventListener("refresh-dashboard",e),()=>window.removeEventListener("refresh-dashboard",e)},[]),h)?(0,s.jsx)("main",{className:"min-h-screen bg-background flex items-center justify-center",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)(k.Z,{className:"w-12 h-12 animate-spin text-blue-500 mx-auto mb-4"}),(0,s.jsx)("p",{className:"text-slate-300",children:"Loading slot data..."})]})}):(0,s.jsxs)("main",{className:"min-h-screen bg-background",children:[(0,s.jsxs)("div",{className:"mx-auto w-full max-w-full p-6 md:p-8",children:[(0,s.jsx)(eh,{selectedSlots:a,onNewBooking:()=>{a.length>0&&i(!0)}}),(0,s.jsx)(ep,{selectedConsole:e,onConsoleChange:t}),(0,s.jsx)(eb,{availableConsoles:d,selectedConsole:e,selectedSlots:a,onSlotSelect:e=>{a.some(t=>t.slot_id===e.slot_id&&t.date===e.date)?l(a.filter(t=>!(t.slot_id===e.slot_id&&t.date===e.date))):l([...a,e])},allSlots:m,isLoading:h,fetchSlotBookings:D}),(0,s.jsx)(ef,{bookings:b,isLoading:y})]}),(0,s.jsx)(eg,{isOpen:n,onClose:()=>i(!1),selectedSlots:a,onBookingComplete:()=>{l([]),N.current=!1,el.clear(),ei.clear(),window.location.reload()},availableConsoles:d})]})}},65613:function(e,t,a){"use strict";a.d(t,{Cd:function(){return d},X:function(){return c},bZ:function(){return i}});var s=a(57437),r=a(2265),l=a(90535),n=a(94508);let o=(0,l.j)("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),i=r.forwardRef((e,t)=>{let{className:a,variant:r,...l}=e;return(0,s.jsx)("div",{ref:t,role:"alert",className:(0,n.cn)(o({variant:r}),a),...l})});i.displayName="Alert";let d=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("h5",{ref:t,className:(0,n.cn)("mb-1 font-medium leading-none tracking-tight",a),...r})});d.displayName="AlertTitle";let c=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("div",{ref:t,className:(0,n.cn)("text-sm [&_p]:leading-relaxed",a),...r})});c.displayName="AlertDescription"},53647:function(e,t,a){"use strict";a.d(t,{Bw:function(){return h},Ph:function(){return c},Ql:function(){return p},i4:function(){return g},ki:function(){return m}});var s=a(57437),r=a(2265),l=a(33911),n=a(40875),o=a(22135),i=a(30401),d=a(94508);let c=l.fC;l.ZA;let m=l.B4,g=r.forwardRef((e,t)=>{let{className:a,children:r,...o}=e;return(0,s.jsxs)(l.xz,{ref:t,className:(0,d.cn)("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",a),...o,children:[r,(0,s.jsx)(l.JO,{asChild:!0,children:(0,s.jsx)(n.Z,{className:"h-4 w-4 opacity-50"})})]})});g.displayName=l.xz.displayName;let x=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(l.u_,{ref:t,className:(0,d.cn)("flex cursor-default items-center justify-center py-1",a),...r,children:(0,s.jsx)(o.Z,{className:"h-4 w-4"})})});x.displayName=l.u_.displayName;let u=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(l.$G,{ref:t,className:(0,d.cn)("flex cursor-default items-center justify-center py-1",a),...r,children:(0,s.jsx)(n.Z,{className:"h-4 w-4"})})});u.displayName=l.$G.displayName;let h=r.forwardRef((e,t)=>{let{className:a,children:r,position:n="popper",...o}=e;return(0,s.jsx)(l.h_,{children:(0,s.jsxs)(l.VY,{ref:t,className:(0,d.cn)("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===n&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",a),position:n,...o,children:[(0,s.jsx)(x,{}),(0,s.jsx)(l.l_,{className:(0,d.cn)("p-1","popper"===n&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:r}),(0,s.jsx)(u,{})]})})});h.displayName=l.VY.displayName,r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(l.__,{ref:t,className:(0,d.cn)("py-1.5 pl-8 pr-2 text-sm font-semibold",a),...r})}).displayName=l.__.displayName;let p=r.forwardRef((e,t)=>{let{className:a,children:r,...n}=e;return(0,s.jsxs)(l.ck,{ref:t,className:(0,d.cn)("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a),...n,children:[(0,s.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,s.jsx)(l.wU,{children:(0,s.jsx)(i.Z,{className:"h-4 w-4"})})}),(0,s.jsx)(l.eT,{children:r})]})});p.displayName=l.ck.displayName,r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(l.Z0,{ref:t,className:(0,d.cn)("-mx-1 my-1 h-px bg-muted",a),...r})}).displayName=l.Z0.displayName}}]);