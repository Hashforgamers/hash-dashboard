(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1132],{73906:function(e,t,s){Promise.resolve().then(s.bind(s,20785))},20785:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return O}});var a=s(57437),n=s(2265),r=s(73578),l=s(66070),o=s(14368),i=s(48614),d=s(35974),c=s(62869),m=s(32489),u=e=>{let{filters:t,setFilters:s,showFilter:r,setShowFilter:u}=e,[x,p]=(0,n.useState)(t),f=(e,t)=>{p(s=>({...s,[e]:s[e]===t?null:t}))};return(0,a.jsx)(i.M,{children:r&&(0,a.jsx)(o.E.div,{initial:{opacity:0,scale:1},animate:{opacity:1,scale:1},exit:{opacity:0,scale:1},className:"fixed w-full h-full z-50  ",children:(0,a.jsxs)(l.Zb,{className:"p-2 relative left-[80%] fixed ",children:[(0,a.jsxs)(l.Ol,{className:"top-0",children:[(0,a.jsx)("button",{className:"absolute right-2 p-2 transition-all rounded-md hover:bg-red-500 hover:scale-110",onClick:()=>u(!1),children:(0,a.jsx)(m.Z,{className:"w-5 h-5 text-gray-600 dark:text-gray-300"})}),(0,a.jsx)(l.ll,{className:"text-center text-lg font-semibold",children:"Filters"})]}),(0,a.jsxs)(l.aY,{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-sm font-medium",children:"Mode of Payment"}),(0,a.jsx)("div",{className:"flex flex-wrap gap-2 mt-2 ",children:["Cash","PayPal",null].map(e=>(0,a.jsx)(d.C,{variant:x.modeOfPayment===e?"default":"outline",className:"cursor-pointer text-sm px-3 py-1",onClick:()=>f("modeOfPayment",e),children:null!=e?e:"None"},null!=e?e:"None"))})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-sm font-medium",children:"Booking Type"}),(0,a.jsx)("div",{className:"flex flex-wrap gap-2 mt-2",children:["Hash","Direct",null].map(e=>(0,a.jsx)(d.C,{variant:x.bookingType===e?"default":"outline",className:"cursor-pointer text-sm px-3 py-1",onClick:()=>f("bookingType",e),children:null!=e?e:"None"},null!=e?e:"None"))})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-sm font-medium",children:"Settlement Status"}),(0,a.jsx)("div",{className:"flex flex-wrap gap-2 mt-2",children:["Pending","Done",null].map(e=>(0,a.jsx)(d.C,{variant:x.settlementStatus===e?"default":"outline",className:"cursor-pointer text-sm px-3 py-1",onClick:()=>f("settlementStatus",e),children:null!=e?e:"All"},null!=e?e:"All"))})]}),(0,a.jsxs)("div",{className:"flex justify-center mx-2 ",children:[(0,a.jsx)(c.z,{onClick:()=>{let e={modeOfPayment:null,bookingType:null,settlementStatus:null};p(e),s(e),u(!1)},variant:"outline",className:"px-4 py-2 text-sm hover:bg-red-500 mx-2 my-4",children:"Clear Filters"}),(0,a.jsx)(c.z,{onClick:()=>{s(x),u(!1)},variant:"outline",className:"px-4 py-2 text-sm hover:bg-green-500 mx-2 my-4",children:"Apply"})]})]})]})})})},x=s(95186),p=s(95252),f=s(92369),h=s(91723),b=s(88226),g=s(73247),y=s(90740),j=s(92735),v=s(12),N=s(14474),w=s(38303),S=s(75956);function k(){return localStorage.getItem("jwtToken")}function T(){let[e,t]=(0,n.useState)([]),[s,c]=(0,n.useState)(!1),[m,T]=(0,n.useState)(""),[C,O]=(0,n.useState)(null),[E,P]=(0,n.useState)(null),[F,I]=(0,n.useState)(null),[A,Z]=(0,n.useState)(null),[D,L]=(0,n.useState)({modeOfPayment:"",bookingType:"",settlementStatus:""}),[M,_]=(0,n.useState)(!1),R={hidden:{opacity:0,y:20},visible:{opacity:1,y:0}},U={hidden:{opacity:1,scale:.5},visible:{opacity:1,scale:1},hover:{scale:1.1}},z=(0,n.useMemo)(()=>Array.isArray(e)?e.filter(e=>{let t=!D.modeOfPayment||e.modeOfPayment&&e.modeOfPayment.toLowerCase().trim()===D.modeOfPayment.toLowerCase().trim(),s=!D.bookingType||e.bookingType&&e.bookingType.toLowerCase().trim()===D.bookingType.toLowerCase().trim(),a=!D.settlementStatus||e.settlementStatus&&e.settlementStatus.toLowerCase().trim()===D.settlementStatus.toLowerCase().trim(),n=[e.userName,e.modeOfPayment,e.bookingType].map(e=>e.toLowerCase()).some(e=>e.includes(m.toLowerCase()));return t&&s&&a&&n}):[],[m,D,e]);function B(e){if(!e)return"";let t=new Date(1e3*e),s=t.getFullYear(),a=String(t.getMonth()+1).padStart(2,"0"),n=String(t.getDate()).padStart(2,"0");return"".concat(s).concat(a).concat(n)}(0,n.useEffect)(()=>{let e=k();if(O(e),e)try{var t;let s=(0,N.o)(e);P((null==s?void 0:null===(t=s.sub)||void 0===t?void 0:t.id)||null),I((null==s?void 0:s.iat)||null),Z((null==s?void 0:s.exp)||null)}catch(e){console.error("Invalid JWT Token:",e)}},[]),(0,n.useEffect)(()=>{let e=k();if(O(e),e)try{var t;let s=(0,N.o)(e);P((null==s?void 0:null===(t=s.sub)||void 0===t?void 0:t.id)||null),I((null==s?void 0:s.iat)||null),Z((null==s?void 0:s.exp)||null)}catch(e){console.error("Invalid JWT Token:",e)}},[]),(0,n.useEffect)(()=>{let e;if(!E||!F||!A||!C)return;let s="transactions_".concat(E),a=B(F),n=B(A),r="".concat(w.m7,"/api/transactionReport/").concat(E,"/").concat(a,"/").concat(n),l=async e=>{c(!0);let a=Date.now();try{let n=localStorage.getItem(s);if(e&&n){let e=JSON.parse(n);if(e.timestamp&&a-e.timestamp<3e5){t(e.data),c(!1),console.log("Loaded transactions from cache");return}}let l=await fetch(r,{method:"GET",headers:{Authorization:"Bearer ".concat(C),"Content-Type":"application/json"}});if(!l.ok)throw Error("HTTP error! Status: ".concat(l.status));let o=await l.json();t(o||[]),localStorage.setItem(s,JSON.stringify({data:o,timestamp:a}))}catch(e){console.error("Error fetching transactions:",e)}finally{c(!1)}};return l(!0),e=setInterval(()=>{l(!1)},6e4),()=>clearInterval(e)},[E,F,A,C]);let Y=(0,n.useMemo)(()=>{if(!e.length)return{total:0,uniqueUsers:0,pendingSettlements:0,cashTransactions:0};let t=e.reduce((e,t)=>e+t.amount,0);return{total:t,uniqueUsers:new Set(e.map(e=>e.userName)).size,pendingSettlements:e.filter(e=>"pending"===e.settlementStatus).length,cashTransactions:e.filter(e=>{var t;return(null===(t=e.modeOfPayment)||void 0===t?void 0:t.toLowerCase())==="cash"}).length}},[e]),[q,H]=(0,n.useState)([]),[G,J]=(0,n.useState)({}),W=e=>{H(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])};(e=>{let t={};return e.forEach(e=>{t[e.userId]||(t[e.userId]={userName:e.userName,totalAmount:0,bookings:[]}),t[e.userId].totalAmount+=e.amount,t[e.userId].bookings.push(e)})})(z);let V=e.reduce((e,t)=>{let{slotDate:s,userId:a,userName:n}=t;return e[s]||(e[s]={}),e[s][a]||(e[s][a]={userName:n,bookings:[],totalAmount:0}),e[s][a].bookings.push(t),e[s][a].totalAmount+=t.amount,e},{});return s?(0,a.jsx)(S.Z,{className:"min-h-[500px]"}):(0,a.jsxs)("div",{className:"space-y-6 p-4 md:p-6",children:[(0,a.jsxs)("div",{className:"grid gap-4 grid-cols-1 sm:grid-cols-2 lg:grid-cols-4",children:[(0,a.jsx)(o.E.div,{variants:R,initial:"hidden",animate:"visible",transition:{duration:.3,delay:0},children:(0,a.jsxs)(l.Zb,{className:"rounded-lg bg-card border-border backdrop-blur-sm",children:[(0,a.jsxs)(l.Ol,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,a.jsx)(l.ll,{className:"text-sm font-medium text-muted-foreground",children:"Total Revenue"}),(0,a.jsx)(p.Z,{className:"h-4 w-4 text-emerald-400"})]}),(0,a.jsxs)(l.aY,{children:[(0,a.jsxs)("div",{className:"text-2xl font-bold text-foreground",children:["₹",Y.total]}),(0,a.jsx)("p",{className:"text-xs text-emerald-400",children:"+20.1% from last month"})]})]})}),(0,a.jsx)(o.E.div,{variants:R,initial:"hidden",animate:"visible",transition:{duration:.3,delay:.1},children:(0,a.jsxs)(l.Zb,{className:"rounded-lg bg-card border-border backdrop-blur-sm",children:[(0,a.jsxs)(l.Ol,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,a.jsx)(l.ll,{className:"text-sm font-medium text-muted-foreground",children:"Unique Users"}),(0,a.jsx)(f.Z,{className:"h-4 w-4 text-primary"})]}),(0,a.jsxs)(l.aY,{children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-foreground",children:Y.uniqueUsers}),(0,a.jsx)("p",{className:"text-xs text-emerald-400",children:"+12 since last week"})]})]})}),(0,a.jsx)(o.E.div,{variants:R,initial:"hidden",animate:"visible",transition:{duration:.3,delay:.2},children:(0,a.jsxs)(l.Zb,{className:"rounded-lg bg-card border-border backdrop-blur-sm",children:[(0,a.jsxs)(l.Ol,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,a.jsx)(l.ll,{className:"text-sm font-medium text-muted-foreground",children:"Pending Settlements"}),(0,a.jsx)(h.Z,{className:"h-4 w-4 text-yellow-400"})]}),(0,a.jsxs)(l.aY,{children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-foreground",children:Y.pendingSettlements}),(0,a.jsx)("p",{className:"text-xs text-yellow-400",children:"Requires attention"})]})]})}),(0,a.jsx)(o.E.div,{variants:R,initial:"hidden",animate:"visible",transition:{duration:.3,delay:.3},children:(0,a.jsxs)(l.Zb,{className:"rounded-lg bg-card border-border backdrop-blur-sm",children:[(0,a.jsxs)(l.Ol,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,a.jsx)(l.ll,{className:"text-sm font-medium text-muted-foreground",children:"Cash Transactions"}),(0,a.jsx)(b.Z,{className:"h-4 w-4 text-muted-foreground"})]}),(0,a.jsxs)(l.aY,{children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-foreground",children:Y.cashTransactions}),(0,a.jsxs)("p",{className:"text-xs text-muted-foreground",children:[(Y.cashTransactions/e.length*100).toFixed(1),"% of total"]})]})]})})]}),(0,a.jsxs)(o.E.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.3,delay:.4},className:"flex flex-col sm:flex-row items-stretch sm:items-center gap-3",children:[(0,a.jsxs)("div",{className:"relative flex-1",children:[(0,a.jsx)(g.Z,{className:"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground"}),(0,a.jsx)(x.I,{placeholder:"Search transactions...",className:"pl-8 rounded-lg bg-input border-border",value:m,onChange:e=>T(e.target.value)})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsxs)(o.E.button,{whileHover:{scale:1.02},initial:"hidden",animate:"visible",variants:U,transition:{duration:.1},className:"flex items-center px-3 py-2 border border-border rounded-lg text-sm text-muted-foreground hover:bg-muted transition-colors",onClick:()=>_(!M),children:[(0,a.jsx)(y.Z,{className:"h-4 w-4 mr-2"}),(0,a.jsx)("span",{children:"Filter"})]}),(0,a.jsxs)(o.E.button,{whileHover:{scale:1.02},initial:"hidden",animate:"visible",variants:U,transition:{duration:.2},className:"flex items-center px-3 py-2 border border-border rounded-lg text-sm text-muted-foreground hover:bg-muted transition-colors",onClick:function(){let e=new Date().toLocaleDateString(),t=z.map(e=>[e.slotDate,e.slotTime,e.userName,e.amount.toFixed(2),e.modeOfPayment,e.bookingType,e.settlementStatus]),s=z.reduce((e,t)=>e+t.amount,0),a=.18*s,n=[[],["Subtotal","","",s.toFixed(2)],["GST (18%)","","",a.toFixed(2)],["Total (INR)","","",(s+a).toFixed(2)]],r=new Blob([['"'.concat("Hash For Gamers Pvt. Ltd.",'"'),'"'.concat("GSTIN: 29ABCDE1234F1Z5",'"'),'"'.concat("Transaction Report"," - ").concat(e,'"'),"","Slot Date,Slot Time,User Name,Amount (INR),Mode of Payment,Booking Type,Settlement Status",...t.map(e=>e.join(",")),"",...n.map(e=>e.join(","))].join("\n")],{type:"text/csv;charset=utf-8"});(0,v.saveAs)(r,"transaction_report_".concat(e.replace(/\//g,"-"),".csv"))},children:[(0,a.jsx)(j.Z,{className:"h-4 w-4 mr-2"}),(0,a.jsx)("span",{children:"Download"})]})]})]}),(0,a.jsx)(u,{className:"z-2",filters:D,setFilters:L,showFilter:M,setShowFilter:_}),(0,a.jsx)(o.E.div,{variants:{hidden:{opacity:0},visible:{opacity:1}},initial:"hidden",animate:"visible",transition:{duration:.3,delay:.5},className:"rounded-lg border border-border bg-card overflow-hidden",children:(0,a.jsx)("div",{className:"max-h-[600px] overflow-x-auto overflow-y-auto",children:(0,a.jsxs)(r.iA,{className:"min-w-full",children:[(0,a.jsx)(r.xD,{className:"bg-muted/50 sticky top-0",children:(0,a.jsxs)(r.SC,{className:"border-border hover:bg-transparent",children:[(0,a.jsx)(r.ss,{className:"font-semibold text-foreground px-4 py-3",children:"Slot Date"}),(0,a.jsx)(r.ss,{className:"font-semibold text-foreground px-4 py-3",children:"Slot Time"}),(0,a.jsx)(r.ss,{className:"font-semibold text-foreground px-4 py-3",children:"User Name"}),(0,a.jsx)(r.ss,{className:"font-semibold text-foreground px-4 py-3",children:"Amount"}),(0,a.jsx)(r.ss,{className:"font-semibold text-foreground px-4 py-3",children:"Mode of Payment"}),(0,a.jsx)(r.ss,{className:"font-semibold text-foreground px-4 py-3",children:"Booking Type"}),(0,a.jsx)(r.ss,{className:"font-semibold text-foreground px-4 py-3",children:"Settlement Status"})]})}),(0,a.jsx)(r.RM,{children:Object.entries(V).map(e=>{let[t,s]=e,l=Object.values(s).reduce((e,t)=>e+t.totalAmount,0);return Object.keys(s).length,(0,a.jsxs)(n.Fragment,{children:[(0,a.jsxs)(o.E.tr,{initial:{opacity:0},animate:{opacity:1},onClick:()=>W(t),className:"cursor-pointer hover:bg-muted/30 transition-colors border-border",children:[(0,a.jsx)(r.pj,{colSpan:1,className:"text-primary font-medium px-4 py-3",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{children:t}),(0,a.jsx)("span",{className:"text-xs",children:q.includes(t)?"▲":"▼"})]})}),(0,a.jsx)(r.pj,{colSpan:2,className:"px-4 py-3"}),(0,a.jsxs)(r.pj,{colSpan:4,className:"text-primary font-medium px-4 py-3",children:["₹",l.toFixed(2)]})]}),(0,a.jsx)(i.M,{children:q.includes(t)&&Object.values(s).flatMap(e=>e.bookings.map(e=>(0,a.jsxs)(o.E.tr,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.2},className:"hover:bg-muted/20 transition-colors border-border",children:[(0,a.jsx)(r.pj,{className:"px-4 py-3 text-muted-foreground",children:e.slotDate}),(0,a.jsx)(r.pj,{className:"px-4 py-3 text-muted-foreground",children:e.slotTime}),(0,a.jsx)(r.pj,{className:"px-4 py-3 text-foreground",children:e.userName}),(0,a.jsxs)(r.pj,{className:"px-4 py-3 text-foreground font-medium",children:["₹",e.amount.toFixed(2)]}),(0,a.jsx)(r.pj,{className:"px-4 py-3",children:(0,a.jsx)(d.C,{variant:"secondary",className:"bg-muted text-muted-foreground",children:e.modeOfPayment})}),(0,a.jsx)(r.pj,{className:"px-4 py-3",children:(0,a.jsx)(d.C,{variant:"outline",className:"border-border text-muted-foreground",children:e.bookingType})}),(0,a.jsx)(r.pj,{className:"px-4 py-3",children:(0,a.jsx)(d.C,{variant:"done"===e.settlementStatus?"default":"pending"===e.settlementStatus?"secondary":"outline",className:"done"===e.settlementStatus?"bg-emerald-500/20 text-emerald-400 border-emerald-500/30":"pending"===e.settlementStatus?"bg-yellow-500/20 text-yellow-400 border-yellow-500/30":"border-border text-muted-foreground",children:e.settlementStatus})})]},e.id)))})]},t)})})]})})})]})}var C=s(42357);function O(){return(0,a.jsx)(C.DashboardLayout,{children:(0,a.jsx)("div",{className:"flex-1 space-y-4 p-4 md:p-8 pt-6",children:(0,a.jsx)(T,{})})})}},75956:function(e,t,s){"use strict";var a=s(57437);s(2265),t.Z=e=>{let{size:t=48,className:s=""}=e;return(0,a.jsx)("div",{className:"flex justify-center items-center w-full h-full ".concat(s),children:(0,a.jsx)("div",{className:"animate-spin rounded-full border-t-2 border-b-2 border-emerald-500",style:{width:t,height:t}})})}},35974:function(e,t,s){"use strict";s.d(t,{C:function(){return o}});var a=s(57437);s(2265);var n=s(90535),r=s(94508);let l=(0,n.j)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground",success:"border-transparent bg-green-500 text-white hover:bg-green-600",warning:"border-transparent bg-yellow-500 text-white hover:bg-yellow-600"}},defaultVariants:{variant:"default"}});function o(e){let{className:t,variant:s,...n}=e;return(0,a.jsx)("div",{className:(0,r.cn)(l({variant:s}),t),...n})}},95186:function(e,t,s){"use strict";s.d(t,{I:function(){return l}});var a=s(57437),n=s(2265),r=s(94508);let l=n.forwardRef((e,t)=>{let{className:s,type:n,...l}=e;return(0,a.jsx)("input",{type:n,className:(0,r.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",s),ref:t,...l})});l.displayName="Input"}},function(e){e.O(0,[7861,5585,4076,7591,2344,2971,2117,1744],function(){return e(e.s=73906)}),_N_E=e.O()}]);