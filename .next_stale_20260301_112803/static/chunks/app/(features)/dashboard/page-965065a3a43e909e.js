(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7772],{71318:function(e,t,s){Promise.resolve().then(s.bind(s,35526))},35526:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return eE}});var a=s(57437),o=s(42357),n=s(2265),i=s(66070),r=s(48614),l=s(14368),d=s(40284),c=s(99897),m=s(32489),u=s(49322),x=s(33276),g=s(31047),h=s(92369),p=s(91723),f=s(28870),b=s(99397),y=s(54887),v=s(83464),j=s(40531),N=s(85962),w=s(38303),k=s(73247),D=s(90740);function C(e){let{searchTerm:t,setSearchTerm:s,selectedDate:o,setSelectedDate:i,timeFilter:d,setTimeFilter:c}=e,[u,x]=(0,n.useState)(!1);return(0,a.jsxs)("div",{className:"w-full",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 sm:gap-3 flex-nowrap overflow-x-auto px-2",children:[(0,a.jsxs)("div",{className:"relative flex-1 min-w-0",children:[(0,a.jsx)(k.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),(0,a.jsx)("input",{type:"text",placeholder:"Search...",value:t,onChange:e=>s(e.target.value),className:"text-sm w-full pl-8 pr-2 py-1 rounded-lg border border-gray-200 dark:border-zinc-700 bg-white dark:bg-zinc-800 focus:ring-2 focus:ring-emerald-500 focus:border-transparent transition-colors"})]}),(0,a.jsx)("button",{onClick:()=>x(!0),className:"p-2 rounded-lg border border-gray-200 dark:border-zinc-700 bg-white dark:bg-zinc-800",children:(0,a.jsx)(D.Z,{className:"w-4 h-4"})})]}),(0,a.jsx)(r.M,{children:u&&(0,a.jsx)(l.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-50 bg-black bg-opacity-50 flex justify-end",onClick:()=>x(!1),children:(0,a.jsxs)(l.E.div,{initial:{x:"100%"},animate:{x:0},exit:{x:"100%"},transition:{type:"spring",bounce:.1,duration:.4},className:"bg-white dark:bg-zinc-900 w-[85vw] sm:w-[400px] h-full p-4 shadow-lg",onClick:e=>e.stopPropagation(),children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsx)("h3",{className:"text-base font-medium",children:"Filters"}),(0,a.jsx)("button",{onClick:()=>x(!1),children:(0,a.jsx)(m.Z,{className:"w-5 h-5 text-gray-500"})})]}),(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Select Date"}),(0,a.jsx)("input",{type:"date",value:o.split("T")[0],onChange:e=>i(new Date(e.target.value).toISOString()),className:"w-full px-3 py-2 text-sm rounded-lg border border-gray-200 dark:border-zinc-700 bg-white dark:bg-zinc-800 focus:ring-2 focus:ring-emerald-500 focus:border-transparent transition-colors"})]}),(0,a.jsxs)("div",{className:"mt-6",children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Select Time Slot"}),(0,a.jsx)("div",{className:"grid grid-cols-2 gap-2",children:["all","morning","afternoon","evening"].map(e=>(0,a.jsx)("button",{onClick:()=>{c(e),x(!1)},className:"px-3 py-2 text-sm rounded-lg border text-center transition-colors ".concat(d===e?"bg-emerald-100 dark:bg-emerald-900/20 text-emerald-700 border-emerald-300":"border-gray-200 dark:border-zinc-700 hover:bg-gray-50 dark:hover:bg-zinc-800"),children:e.charAt(0).toUpperCase()+e.slice(1)},e))})]})]})})})]})}var I=s(85317),E=s(51817),S=s(92934),T=s(42208),_=s(26937),A=s(44794),Z=s(32795),B=s(16275),M=s(76865),P=s(21047),F=s(83229);let z=new Map,O=e=>new Promise((t,s)=>{if(z.has(e)){t(z.get(e));return}let a=new Image;a.onload=()=>{z.set(e,a),t(a)},a.onerror=s,a.src=e}),L=e=>{let{src:t,alt:s,className:o}=e,[i,r]=(0,n.useState)(!1),[l,d]=(0,n.useState)(!1);return((0,n.useEffect)(()=>{O(t).then(()=>r(!0)).catch(()=>d(!0))},[t]),l)?(0,a.jsx)("div",{className:"flex items-center justify-center bg-gradient-to-br from-green-50 to-green-100 dark:from-green-900/20 dark:to-green-800/20 ".concat(o),children:(0,a.jsx)(I.Z,{className:"text-green-500 w-6 h-6 sm:w-8 sm:h-8"})}):(0,a.jsxs)("div",{className:"relative ".concat(o),children:[!i&&(0,a.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-gradient-to-br from-green-50 to-green-100 dark:from-green-900/20 dark:to-green-800/20",children:(0,a.jsx)(E.Z,{className:"animate-spin text-green-500 w-4 h-4 sm:w-6 sm:h-6"})}),(0,a.jsx)("img",{className:"h-full w-full object-cover transition-opacity duration-300 ".concat(i?"opacity-100":"opacity-0"),src:t,alt:s,loading:"lazy"})]})};var R=e=>{var t,s;let{isOpen:o,onClose:i,bookingId:d,customerName:c,initialMode:u="view",hasExistingMeals:x=!1,vendorId:g}=e,[h,p]=(0,n.useState)([]),[y,v]=(0,n.useState)(!1),[j,N]=(0,n.useState)(""),[k,D]=(0,n.useState)(u),[C,z]=(0,n.useState)([]),[O,R]=(0,n.useState)(null),[U,H]=(0,n.useState)([]),[q,V]=(0,n.useState)(!1),[J,G]=(0,n.useState)(!1),[W,Y]=(0,n.useState)(""),[K,X]=(0,n.useState)("");(0,n.useEffect)(()=>{o&&(D(u),H([]),N(""),Y(""),X(""),d&&$())},[o,d,u]),(0,n.useEffect)(()=>{o&&"add"===k&&g&&Q()},[o,k,g]),(0,n.useEffect)(()=>{if(K){let e=setTimeout(()=>X(""),3e3);return()=>clearTimeout(e)}},[K]);let $=async()=>{v(!0),N("");try{let e;console.log("\uD83D\uDD0D Fetching meal details for booking ".concat(d));try{e=await fetch("".concat(w.m7,"/api/booking/").concat(d,"/details"))}catch(t){e=await fetch("".concat(w.m7,"/api/booking/").concat(d,"/details"))}let t=e.headers.get("content-type");if(!t||!t.includes("application/json"))throw Error("Server returned HTML instead of JSON - endpoint may not exist");if(!e.ok){let t=await e.json().catch(()=>({}));throw Error(t.message||"HTTP ".concat(e.status,": ").concat(e.statusText))}let s=await e.json();console.log("\uD83D\uDCCB Booking details response:",s),s.success&&s.booking&&Array.isArray(s.booking.extra_services)?(p(s.booking.extra_services),console.log("✅ Found ".concat(s.booking.extra_services.length," existing meals"))):(console.log("ℹ️ No existing meals found for this booking"),p([]))}catch(e){console.error("❌ Error fetching meal details:",e),N(e instanceof Error?e.message:"Failed to load meal details")}finally{v(!1)}},Q=async()=>{if(!g){Y("Vendor ID not available");return}V(!0),Y("");try{console.log("\uD83C\uDF7D️ Fetching menu for vendor ".concat(g,"..."));let e=await fetch("".concat(w.m7,"/api/vendor/").concat(g,"/extra-services"));if(!e.ok)throw Error("Failed to fetch menu: HTTP ".concat(e.status));let t=await e.json();if(console.log("\uD83D\uDCCB Menu API Response:",t),t.success&&Array.isArray(t.categories)){let e=t.categories.filter(e=>{var t;return e.is_active&&(null===(t=e.menus)||void 0===t?void 0:t.length)>0});z(e),e.length>0&&R(e[0].id)}else console.warn("⚠️ Unexpected API response structure:",t),z([])}catch(e){console.error("❌ Error fetching menu items:",e),Y(e instanceof Error?e.message:"Failed to load menu items")}finally{V(!1)}},ee=(e,t,s)=>{t<=0?H(t=>t.filter(t=>t.menu_item_id!==e.id)):H(a=>{let o=a.findIndex(t=>t.menu_item_id===e.id),n={menu_item_id:e.id,name:e.name,price:e.price,quantity:t,total:e.price*t,category:s};if(o>=0){let e=[...a];return e[o]=n,e}return[...a,n]})},et=e=>{var t;return(null===(t=U.find(t=>t.menu_item_id===e))||void 0===t?void 0:t.quantity)||0},es=async()=>{if(0!==U.length){G(!0);try{console.log("\uD83C\uDF7D️ Adding meals to booking ".concat(d,":"),U);let s=await fetch("".concat(w.o8,"/api/booking/").concat(d,"/add-meals"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({meals:U.map(e=>({menu_item_id:e.menu_item_id,quantity:e.quantity}))})});if(!s.ok){let e=await s.json().catch(()=>({}));throw Error(e.message||"HTTP ".concat(s.status,": ").concat(s.statusText))}let a=await s.json();if(console.log("✅ Add meals response:",a),a.success){var e,t;await $(),H([]),D("view"),X("Successfully added ".concat((null===(e=a.added_meals)||void 0===e?void 0:e.length)||U.length," meals!")),window.dispatchEvent(new CustomEvent("refresh-dashboard")),console.log("✅ Successfully added ".concat((null===(t=a.added_meals)||void 0===t?void 0:t.length)||0," meals"))}else throw Error(a.message||"Failed to add meals")}catch(e){console.error("❌ Error adding meals:",e),Y(e instanceof Error?e.message:"Failed to add meals")}finally{G(!1)}}},ea=U.reduce((e,t)=>e+t.total,0),eo=U.reduce((e,t)=>e+t.quantity,0);return o?(0,a.jsx)(r.M,{children:(0,a.jsx)(l.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-[60] flex items-center justify-center bg-black bg-opacity-50 backdrop-blur-sm p-2 sm:p-4",onClick:e=>e.target===e.currentTarget&&i(),children:(0,a.jsxs)(l.E.div,{initial:{opacity:0,scale:.95,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:20},className:"relative w-full max-w-6xl bg-white dark:bg-gray-800 rounded-xl shadow-2xl overflow-hidden max-h-[95vh] flex flex-col",onClick:e=>e.stopPropagation(),children:[(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between p-3 sm:p-4 border-b border-gray-200 dark:border-gray-700 bg-gradient-to-r from-emerald-50 to-green-50 dark:from-emerald-900/20 dark:to-green-900/20 flex-shrink-0 gap-3 sm:gap-0",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 sm:gap-3",children:[(0,a.jsx)("div",{className:"p-1.5 sm:p-2 bg-emerald-600 rounded-lg",children:(0,a.jsx)(I.Z,{className:"w-4 h-4 sm:w-5 sm:h-5 text-white"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-base sm:text-lg font-bold text-gray-800 dark:text-white",children:"view"===k?"Meal Details":"Add More Meals"}),(0,a.jsx)("p",{className:"text-xs sm:text-sm text-gray-600 dark:text-gray-400",children:c})]})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between sm:justify-end gap-2",children:[K&&(0,a.jsxs)(l.E.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},className:"flex items-center gap-1 px-2 py-1 bg-green-100 text-green-700 rounded text-xs sm:text-sm",children:[(0,a.jsx)(S.Z,{className:"w-3 h-3 sm:w-4 sm:h-4"}),(0,a.jsx)("span",{className:"hidden sm:inline",children:K}),(0,a.jsx)("span",{className:"sm:hidden",children:"Added!"})]}),(x||h.length>0)&&(0,a.jsxs)("div",{className:"flex bg-gray-100 dark:bg-gray-700 rounded-lg p-0.5 sm:p-1",children:[(0,a.jsxs)(l.E.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>D("view"),className:"px-2 sm:px-3 py-1 sm:py-1.5 rounded text-xs sm:text-sm font-medium transition-all duration-200 flex items-center gap-1 ".concat("view"===k?"bg-white dark:bg-gray-600 text-emerald-600 shadow-sm":"text-gray-600 dark:text-gray-300 hover:text-emerald-600"),children:[(0,a.jsx)(T.Z,{className:"w-2.5 h-2.5 sm:w-3 sm:h-3"}),(0,a.jsx)("span",{className:"hidden sm:inline",children:"View"})]}),(0,a.jsxs)(l.E.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>D("add"),className:"px-2 sm:px-3 py-1 sm:py-1.5 rounded text-xs sm:text-sm font-medium transition-all duration-200 flex items-center gap-1 ".concat("add"===k?"bg-white dark:bg-gray-600 text-blue-600 shadow-sm":"text-gray-600 dark:text-gray-300 hover:text-blue-600"),children:[(0,a.jsx)(_.Z,{className:"w-2.5 h-2.5 sm:w-3 sm:h-3"}),(0,a.jsx)("span",{className:"hidden sm:inline",children:"Add"})]})]}),!x&&"view"===k&&0===h.length&&(0,a.jsxs)(l.E.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>D("add"),className:"px-3 py-1.5 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-xs sm:text-sm font-medium transition-colors flex items-center gap-1.5",children:[(0,a.jsx)(b.Z,{className:"w-3 h-3 sm:w-4 sm:h-4"}),(0,a.jsx)("span",{children:"Add Food"})]}),(0,a.jsx)("button",{onClick:i,className:"p-1 sm:p-1.5 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full transition-colors",children:(0,a.jsx)(m.Z,{className:"w-4 h-4 sm:w-5 sm:h-5 text-gray-500"})})]})]}),(0,a.jsx)("div",{className:"flex-1 overflow-hidden",children:"view"===k?(0,a.jsxs)("div",{className:"p-3 sm:p-4 h-full overflow-y-auto",children:[y&&(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center py-8",children:[(0,a.jsx)(E.Z,{className:"w-6 h-6 sm:w-8 sm:h-8 animate-spin text-emerald-600 mb-3"}),(0,a.jsx)("p",{className:"text-xs sm:text-sm text-gray-600 dark:text-gray-400",children:"Loading meal details..."})]}),j&&(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center py-8 text-red-600",children:[(0,a.jsx)(A.Z,{className:"w-6 h-6 sm:w-8 sm:h-8 mb-3"}),(0,a.jsx)("p",{className:"text-xs sm:text-sm text-center px-4",children:j}),(0,a.jsx)("button",{onClick:$,className:"mt-3 px-3 sm:px-4 py-1.5 sm:py-2 bg-emerald-600 text-white rounded-lg hover:bg-emerald-700 transition-colors text-xs sm:text-sm",children:"Retry"})]}),!y&&!j&&0===h.length&&(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center py-8 text-gray-500",children:[(0,a.jsx)(f.Z,{className:"w-10 h-10 sm:w-12 sm:h-12 mb-3 opacity-50"}),(0,a.jsx)("p",{className:"text-base sm:text-lg font-medium mb-2",children:"No meals ordered yet"}),(0,a.jsx)("p",{className:"text-xs sm:text-sm mb-4 text-center px-4",children:"This customer hasn't added any meals to their booking."}),(0,a.jsxs)(l.E.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>D("add"),className:"px-4 sm:px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors flex items-center gap-2 text-sm",children:[(0,a.jsx)(b.Z,{className:"w-4 h-4"}),"Add Meals Now"]})]}),!y&&!j&&h.length>0&&(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between text-xs sm:text-sm text-gray-600 dark:text-gray-400 mb-3 gap-2",children:(0,a.jsxs)("span",{children:[h.reduce((e,t)=>e+t.quantity,0)," items • Booking ID: ",d]})}),(0,a.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-2 sm:gap-3",children:h.map((e,t)=>(0,a.jsx)(l.E.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.1*t},className:"bg-emerald-50 dark:bg-emerald-900/20 rounded-lg p-3 border border-emerald-200 dark:border-emerald-800",children:(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex justify-between items-start",children:[(0,a.jsx)("h4",{className:"font-medium text-emerald-800 dark:text-emerald-200 text-sm sm:text-base line-clamp-2",children:e.menu_item_name}),(0,a.jsxs)("span",{className:"font-bold text-emerald-600 text-sm sm:text-base ml-2",children:["₹",e.total_price]})]}),(0,a.jsx)("p",{className:"text-xs text-emerald-600 dark:text-emerald-400",children:e.category_name}),(0,a.jsx)("div",{className:"flex items-center justify-between text-xs text-emerald-700 dark:text-emerald-300",children:(0,a.jsxs)("span",{children:["₹",e.unit_price," \xd7 ",e.quantity]})})]})},e.id||t))}),(0,a.jsx)("div",{className:"border-t border-emerald-200 dark:border-emerald-600 pt-3 mt-4",children:(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("span",{className:"font-bold text-gray-800 dark:text-white text-sm sm:text-base",children:"Total Meal Cost:"}),(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)(Z.Z,{className:"w-4 h-4 text-emerald-600"}),(0,a.jsx)("span",{className:"font-bold text-lg sm:text-xl text-emerald-600",children:h.reduce((e,t)=>e+t.total_price,0)})]})]})}),(0,a.jsxs)(l.E.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>D("add"),className:"w-full py-2.5 sm:py-3 bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white rounded-lg font-medium transition-all flex items-center justify-center gap-2 text-sm sm:text-base",children:[(0,a.jsx)(b.Z,{className:"w-4 h-4"}),"Add More Meals"]})]})]}):(0,a.jsxs)("div",{className:"flex h-full overflow-hidden",children:[(0,a.jsx)("div",{className:"hidden sm:block",children:(0,a.jsxs)("aside",{className:"w-48 lg:w-56 overflow-auto border-r border-gray-200 bg-gray-50 p-3 dark:border-gray-700 dark:bg-gray-800 h-full",children:[(0,a.jsx)("h3",{className:"mb-3 text-xs font-semibold text-gray-700 dark:text-gray-300 uppercase",children:"Categories"}),q&&(0,a.jsx)("div",{className:"flex items-center justify-center py-4",children:(0,a.jsx)(E.Z,{className:"w-4 h-4 animate-spin text-blue-600"})}),0===C.length&&!q&&(0,a.jsx)("p",{className:"text-gray-500 dark:text-gray-400 text-xs",children:"No categories"}),(0,a.jsx)("ul",{className:"space-y-1",children:C.map(e=>(0,a.jsx)("li",{children:(0,a.jsxs)("button",{className:"block w-full rounded-lg p-2 text-left transition-colors duration-200 ".concat(O===e.id?"bg-green-200 text-green-800 dark:bg-green-900 dark:text-green-300":"hover:bg-green-100 dark:hover:bg-green-900/30"),onClick:()=>R(e.id),children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("span",{className:"font-medium text-sm",children:e.name}),(0,a.jsx)("span",{className:"rounded-full bg-gray-300 px-1.5 py-0.5 text-xs font-semibold text-gray-700 dark:bg-gray-600 dark:text-gray-300",children:e.menu_count})]}),e.description&&(0,a.jsx)("p",{className:"mt-1 text-xs text-gray-600 line-clamp-2 dark:text-gray-400",children:e.description})]})},e.id))})]})}),(0,a.jsxs)("section",{className:"flex-1 overflow-auto p-3 sm:p-4",children:[(0,a.jsxs)("div",{className:"sm:hidden mb-4",children:[(0,a.jsx)("label",{className:"block text-xs font-semibold text-gray-700 dark:text-gray-300 mb-2 uppercase",children:"Select Category"}),(0,a.jsxs)("select",{value:O||"",onChange:e=>R(Number(e.target.value)),className:"w-full p-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-sm",children:[(0,a.jsx)("option",{value:"",children:"Choose a category..."}),C.map(e=>(0,a.jsxs)("option",{value:e.id,children:[e.name," (",e.menu_count," items)"]},e.id))]})]}),U.length>0&&(0,a.jsxs)(l.E.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-3 sm:p-4 border border-blue-200 dark:border-blue-800 mb-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-3",children:[(0,a.jsx)(B.Z,{className:"w-4 h-4 text-blue-600"}),(0,a.jsxs)("h4",{className:"font-medium text-blue-800 dark:text-blue-200 text-sm sm:text-base",children:["Adding to Order (",eo," items)"]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[U.map(e=>(0,a.jsxs)("div",{className:"flex justify-between items-center text-xs sm:text-sm",children:[(0,a.jsxs)("span",{className:"text-blue-700 dark:text-blue-300",children:[e.name," \xd7 ",e.quantity]}),(0,a.jsxs)("span",{className:"font-medium text-blue-800 dark:text-blue-200",children:["₹",e.total]})]},e.menu_item_id)),(0,a.jsxs)("div",{className:"pt-2 border-t border-blue-200 dark:border-blue-700 flex justify-between items-center",children:[(0,a.jsx)("span",{className:"font-semibold text-blue-800 dark:text-blue-200 text-sm",children:"Additional Total:"}),(0,a.jsxs)("span",{className:"font-bold text-blue-600",children:["₹",ea]})]})]})]}),q&&(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center py-8",children:[(0,a.jsx)(E.Z,{className:"w-6 h-6 sm:w-8 sm:h-8 animate-spin text-blue-600 mb-3"}),(0,a.jsx)("p",{className:"text-xs sm:text-sm text-gray-600 dark:text-gray-400",children:"Loading menu items..."})]}),W&&(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center py-8 text-red-600",children:[(0,a.jsx)(M.Z,{className:"w-6 h-6 sm:w-8 sm:h-8 mb-3"}),(0,a.jsx)("p",{className:"text-xs sm:text-sm text-center px-4",children:W}),(0,a.jsx)("button",{onClick:Q,className:"mt-3 px-3 sm:px-4 py-1.5 sm:py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-xs sm:text-sm",children:"Retry"})]}),!q&&!W&&0===C.length&&(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center py-8 text-gray-500",children:[(0,a.jsx)(f.Z,{className:"w-6 h-6 sm:w-8 sm:h-8 mb-3 opacity-50"}),(0,a.jsx)("p",{className:"text-xs sm:text-sm",children:"No menu items available"})]}),!q&&!W&&C.length>0&&O&&(0,a.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-3 sm:gap-4",children:null===(s=C.find(e=>e.id===O))||void 0===s?void 0:null===(t=s.menus)||void 0===t?void 0:t.map(e=>{var t;let s=et(e.id),o=(null===(t=C.find(e=>e.id===O))||void 0===t?void 0:t.name)||"";return(0,a.jsxs)(l.E.div,{layout:!0,className:"rounded-lg border-2 bg-white shadow-sm dark:bg-gray-700 ".concat(s>0?"border-green-500 shadow-green-200":"border-gray-200 dark:border-gray-600"),whileHover:{y:-2},children:[(0,a.jsxs)("div",{className:"relative h-24 sm:h-32 w-full overflow-hidden rounded-t-lg",children:[e.images.length>0?(0,a.jsx)(L,{src:e.images[0].image_url,alt:e.name,className:"h-full w-full"}):(0,a.jsx)("div",{className:"flex h-full w-full items-center justify-center bg-gradient-to-br from-green-50 to-green-100 dark:from-green-900/20 dark:to-green-800/20",children:(0,a.jsx)(I.Z,{className:"text-green-500 w-6 h-6 sm:w-8 sm:h-8"})}),s>0&&(0,a.jsx)("div",{className:"absolute right-1 sm:right-2 top-1 sm:top-2 rounded-lg bg-green-600 px-1.5 sm:px-2 py-0.5 sm:py-1 text-xs font-semibold text-white",children:s})]}),(0,a.jsxs)("div",{className:"p-2 sm:p-3",children:[(0,a.jsx)("h3",{className:"mb-1 font-semibold text-xs sm:text-sm text-gray-900 dark:text-gray-200 line-clamp-2",children:e.name}),e.description&&(0,a.jsx)("p",{className:"mb-2 sm:mb-3 text-xs text-gray-600 dark:text-gray-400 line-clamp-2",children:e.description}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-1 text-green-600",children:[(0,a.jsx)(Z.Z,{className:"w-3 h-3 sm:w-4 sm:h-4"}),(0,a.jsx)("span",{className:"text-sm sm:text-base font-bold",children:e.price})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-1 sm:space-x-2",children:[(0,a.jsx)("button",{onClick:()=>ee(e,s-1,o),disabled:0===s,className:"flex h-6 w-6 sm:h-7 sm:w-7 items-center justify-center rounded-full bg-red-600 text-white disabled:opacity-50 disabled:cursor-not-allowed hover:bg-red-700 transition-colors",children:(0,a.jsx)(P.Z,{className:"w-2.5 h-2.5 sm:w-3 sm:h-3"})}),(0,a.jsx)("span",{className:"min-w-[16px] sm:min-w-[20px] text-center font-semibold text-xs sm:text-sm text-gray-900 dark:text-gray-100",children:s}),(0,a.jsx)("button",{onClick:()=>ee(e,s+1,o),className:"flex h-6 w-6 sm:h-7 sm:w-7 items-center justify-center rounded-full bg-green-600 text-white hover:bg-green-700 transition-colors",children:(0,a.jsx)(b.Z,{className:"w-2.5 h-2.5 sm:w-3 sm:h-3"})})]})]}),s>0&&(0,a.jsxs)(l.E.p,{layout:!0,className:"mt-1.5 sm:mt-2 text-right font-semibold text-green-700 text-xs sm:text-sm",children:["Subtotal: ₹",(s*e.price).toFixed(2)]})]})]},e.id)})})]})]})}),"add"===k&&U.length>0&&(0,a.jsxs)("div",{className:"p-3 sm:p-4 border-t border-gray-200 dark:border-gray-600 bg-gray-50 dark:bg-gray-800/50 flex-shrink-0",children:[(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center mb-3 gap-2",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("p",{className:"text-xs sm:text-sm text-gray-600 dark:text-gray-400",children:["Adding ",eo," item",1!==eo?"s":""," to booking"]}),(0,a.jsxs)("p",{className:"font-semibold text-gray-800 dark:text-white text-sm sm:text-base",children:["Additional Cost: ₹",ea]})]}),(0,a.jsx)("button",{onClick:()=>H([]),className:"text-xs text-red-600 hover:text-red-700 underline self-start sm:self-center",children:"Clear All"})]}),(0,a.jsx)(l.E.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:es,disabled:J,className:"w-full py-2.5 sm:py-3 rounded-lg font-medium transition-all flex items-center justify-center gap-2 text-sm sm:text-base ".concat(J?"bg-gray-400 cursor-not-allowed":"bg-emerald-600 hover:bg-emerald-700 text-white"),children:J?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(E.Z,{className:"w-4 h-4 animate-spin"}),"Adding to Order..."]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(F.Z,{className:"w-4 h-4"}),"Add ₹",ea," to Order"]})})]})]})})}):null},U=s(23579);let H=e=>{if(!e)return"all";let t=parseInt(e.split(":")[0]);return t<12?"morning":t<17?"afternoon":"evening"},q=e=>{if(!e||!Array.isArray(e)||0===e.length)return[];let t=e.reduce((e,t)=>{let s=(null==t?void 0:t.date)||new Date().toISOString().split("T")[0];return e[s]||(e[s]=[]),e[s].push(t),e},{}),s=e=>{if(!e||"string"!=typeof e)return console.warn("parseTime expected a string but received:",e),new Date(1970,0,1,0,0);let[t,s]=e.trim().split(" "),[a,o]=t.split(":").map(Number);return"PM"===s&&a<12&&(a+=12),"AM"===s&&12===a&&(a=0),new Date(1970,0,1,a,o)},a=(e,t)=>{let s=e=>{let t=e.getHours(),s=e.getMinutes().toString().padStart(2,"0"),a=t>=12?"PM":"AM";return t=t%12||12,"".concat(t,":").concat(s," ").concat(a)};return"".concat(s(e)," - ").concat(s(t))},o=[];return Object.entries(t).forEach(e=>{let[t,n]=e;Object.values(n.reduce((e,t)=>{let s=(null==t?void 0:t.userId)||"unknown",a=(null==t?void 0:t.game_id)||"unknown",o="".concat(s,"_").concat(a);return e[o]||(e[o]=[]),e[o].push(t),e},{})).forEach(e=>{var t,n,i,r;let l=e.sort((e,t)=>{var a,o;let n=s((null===(a=e.time)||void 0===a?void 0:a.split(" - ")[0])||""),i=s((null===(o=t.time)||void 0===o?void 0:o.split(" - ")[0])||"");return n.getTime()-i.getTime()}),d={...l[0]},c=s((null===(t=d.time)||void 0===t?void 0:t.split(" - ")[0])||""),m=s((null===(n=d.time)||void 0===n?void 0:n.split(" - ")[1])||""),u=[d.bookingId],x=d.slot_price||0;for(let e=1;e<l.length;e++){let t=l[e],n=s((null===(i=t.time)||void 0===i?void 0:i.split(" - ")[0])||""),g=s((null===(r=t.time)||void 0===r?void 0:r.split(" - ")[1])||"");n.getTime()<=m.getTime()?(m=new Date(Math.max(m.getTime(),g.getTime())),u.push(t.bookingId),x+=t.slot_price||0):(d.time=a(c,m),d.merged_booking_ids=u,d.total_price=x,d.duration=u.length,o.push(d),d={...t},c=n,m=g,u=[t.bookingId],x=t.slot_price||0)}d.time=a(c,m),d.merged_booking_ids=u,d.total_price=x,d.duration=u.length,o.push(d)})}),o.sort((e,t)=>new Date(e.date).getTime()-new Date(t.date).getTime())};function V(e){let{upcomingBookings:t,vendorId:s,setRefreshSlots:o,refreshTrigger:k}=e,{socket:D,isConnected:I,joinVendor:E}=(0,U.s)(),[S,T]=(0,n.useState)(Array.isArray(t)?t:[]),[_,A]=(0,n.useState)(!1),[Z,B]=(0,n.useState)(""),[M,P]=(0,n.useState)([]),[F,z]=(0,n.useState)(null),[O,L]=(0,n.useState)(!1),[V,J]=(0,n.useState)(null),[G,W]=(0,n.useState)(null),[Y,K]=(0,n.useState)(""),[X,$]=(0,n.useState)((0,j.WU)((0,N.I)(),"yyyy-MM-dd")),[Q,ee]=(0,n.useState)("all"),[et,es]=(0,n.useState)(!1);(0,n.useEffect)(()=>(es(!0),()=>es(!1)),[]);let[ea,eo]=(0,n.useState)({isOpen:!1,bookingId:"",customerName:"",mode:"view",hasExistingMeals:!1});(0,n.useEffect)(()=>{Array.isArray(t)&&(console.log("\uD83D\uDCC5 UpcomingBookings: Updating from props with",t.length,"bookings"),T(t))},[t]),(0,n.useEffect)(()=>{let e=async()=>{if(s)try{console.log("\uD83D\uDD04 Refreshing upcoming bookings from API...");let e=await fetch("".concat(w.m7,"/api/getLandingPage/vendor/").concat(s)),t=await e.json();t.upcomingBookings&&(console.log("\uD83D\uDCC5 Refreshed upcoming bookings:",t.upcomingBookings.length),T(t.upcomingBookings))}catch(e){console.error("❌ Error refreshing upcoming bookings:",e)}};void 0!==k&&e()},[k,s]),(0,n.useEffect)(()=>{if(D&&s&&I)return console.log("\uD83D\uDCC5 UpcomingBookings: Setting up socket listeners..."),E(parseInt(s)),D.off("upcoming_booking"),D.off("booking"),D.off("booking_accepted"),D.on("upcoming_booking",e),D.on("booking",t),D.on("booking_accepted",a),()=>{console.log("\uD83E\uDDF9 Cleaning up UpcomingBookings listeners"),D.off("upcoming_booking",e),D.off("booking",t),D.off("booking_accepted",a)};function e(e){if(console.log("\uD83D\uDCC5 Real-time upcoming booking:",e),!e||!e.vendorId){console.warn("Invalid upcoming booking data:",e);return}e.vendorId===parseInt(s)&&("Confirmed"===e.status||"confirmed"===e.status)&&T(t=>(Array.isArray(t)||(t=[]),t.some(t=>(null==t?void 0:t.bookingId)===e.bookingId))?t:(console.log("➕ Adding new booking immediately"),[e,...t]))}function t(e){if(console.log("\uD83D\uDD04 Booking update:",e),!e||!e.vendorId){console.warn("Invalid booking update data:",e);return}e.vendorId===parseInt(s)&&T(t=>(Array.isArray(t)||(t=[]),"Confirmed"!==e.status&&"confirmed"!==e.status||t.some(t=>(null==t?void 0:t.bookingId)===e.bookingId))?t.map(t=>(null==t?void 0:t.bookingId)===e.bookingId?{...t,...e}:t).filter(e=>(null==e?void 0:e.status)!=="Cancelled"&&(null==e?void 0:e.status)!=="cancelled"):[e,...t])}function a(e){console.log("✅ Booking accepted from notification panel:",e),e.vendorId===parseInt(s)&&T(t=>(Array.isArray(t)||(t=[]),t.some(t=>(null==t?void 0:t.bookingId)===e.bookingId))?t:(console.log("\uD83D\uDCC5 ✅ Adding accepted booking to upcoming bookings immediately"),[e,...t]))}},[D,s,I,E]);let en=(0,n.useMemo)(()=>{if(!Array.isArray(S))return[];let e=S.filter(e=>e&&e.date);if(e=e.filter(e=>{try{let t=new Date(e.date),s=new Date(X);return t.toDateString()===s.toDateString()}catch(t){return console.warn("Date filtering error for booking:",e),!1}}),Y){let t=Y.trim().toLowerCase();e=e.filter(e=>(e.username||"").toLowerCase().includes(t)||(e.consoleType||"").toLowerCase().includes(t))}return"all"!==Q&&(e=e.filter(e=>{var t;return H(null===(t=e.time)||void 0===t?void 0:t.split(" ")[0])===Q})),e},[S,Y,X,Q]),ei=(0,n.useMemo)(()=>q(en),[en]);(0,n.useEffect)(()=>{ei.length>0&&(console.log("\uD83D\uDCCA Sample booking structure:",ei[0]),console.log("\uD83D\uDCCA All booking game_ids:",ei.map(e=>({bookingId:e.bookingId,game_id:e.game_id,consoleType:e.consoleType,hasMeals:e.hasMeals}))))},[ei]);let er=(e,t,a)=>{if(console.log("\uD83D\uDE80 Start clicked with params:",{system:e,gameId:t,bookingId:a,vendorId:s}),!e||!t||!a){console.error("❌ Missing required parameters:",{system:e,gameId:t,bookingId:a});return}if(!s){console.error("❌ VendorId is not available");return}B(e),J(t),W(a),A(!0),el(t,s)},el=async(e,t)=>{if(!t){console.error("❌ VendorId is missing for fetchAvailableConsoles");return}console.log("\uD83D\uDD0D Fetching consoles for gameId:",e,"vendorId:",t),L(!0);try{let s="".concat(w.m7,"/api/getAllDevice/consoleTypeId/").concat(e,"/vendor/").concat(t);console.log("\uD83D\uDCE1 API URL:",s);let a=await v.Z.get(s);if(console.log("\uD83D\uDCE6 Raw API Response:",a.data),console.log("\uD83D\uDCE6 Response type:",typeof a.data),console.log("\uD83D\uDCE6 Is array:",Array.isArray(a.data)),a.data&&Array.isArray(a.data)){console.log("\uD83C\uDFAE All consoles before filtering:",a.data.map(e=>({id:e.consoleId,brand:e.brand,model:e.consoleModelNumber,available:e.is_available,status:e.status,raw:e}))),console.log("\uD83D\uDD0D Checking is_available values:",a.data.map(e=>({id:e.consoleId,is_available:e.is_available,type:typeof e.is_available,stringValue:String(e.is_available)})));let e=a.data.filter(e=>(null==e?void 0:e.is_available)===!0),t=a.data.filter(e=>null==e?void 0:e.is_available),s=a.data.filter(e=>"true"===String(null==e?void 0:e.is_available).toLowerCase());console.log("✅ Strict filter (=== true):",e.length,"consoles"),console.log("✅ Loose filter (truthy):",t.length,"consoles"),console.log('✅ String filter ("true"):',s.length,"consoles");let o=e;0===o.length&&t.length>0&&(o=t,console.log("\uD83D\uDD04 Using loose filter instead")),0===o.length&&s.length>0&&(o=s,console.log("\uD83D\uDD04 Using string filter instead")),console.log("✅ Final available consoles:",o.length),console.log("✅ Available console details:",o.map(e=>({id:e.consoleId,brand:e.brand,model:e.consoleModelNumber,available:e.is_available}))),P(o)}else console.warn("⚠️ API response is not an array or is empty:",a.data),P([])}catch(e){if(console.error("❌ Error fetching available consoles:",e),v.Z.isAxiosError(e)){var s,a,o,n;console.error("\uD83D\uDCE1 API Error details:",{status:null===(s=e.response)||void 0===s?void 0:s.status,statusText:null===(a=e.response)||void 0===a?void 0:a.statusText,data:null===(o=e.response)||void 0===o?void 0:o.data,url:null===(n=e.config)||void 0===n?void 0:n.url})}P([])}finally{L(!1)}},ed=async()=>{if(F&&V&&G){L(!0);let e=ei.find(e=>{var t;return e.bookingId===G||(null===(t=e.merged_booking_ids)||void 0===t?void 0:t.includes(G))}),t=(null==e?void 0:e.merged_booking_ids)||[G],a=t.length>1?"".concat(w.m7,"/api/assignConsoleToMultipleBookings"):"".concat(w.m7,"/api/updateDeviceStatus/consoleTypeId/").concat(V,"/console/").concat(F,"/bookingId/").concat(G,"/vendor/").concat(s),n=t.length>1?{console_id:F,game_id:V,booking_ids:t,vendor_id:s}:null;try{t.length>1?await v.Z.post(a,n):await v.Z.post(a),A(!1),o(e=>!e),T(e=>Array.isArray(e)?e.filter(e=>!t.includes(null==e?void 0:e.bookingId)):[])}catch(e){console.error("Error updating console status:",e)}finally{window.dispatchEvent(new CustomEvent("refresh-dashboard")),L(!1)}}},ec=e=>{z(e)},em=(e,t,s)=>{console.log("\uD83C\uDF7D️ Food icon clicked:",{bookingId:e,customerName:t,hasMeals:s}),eo({isOpen:!0,bookingId:e,customerName:t,mode:"view",hasExistingMeals:s})},eu=(e,t)=>{console.log("➕ Add food clicked:",{bookingId:e,customerName:t}),eo({isOpen:!0,bookingId:e,customerName:t,mode:"add",hasExistingMeals:!1})};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"h-full flex flex-col overflow-hidden",children:[(0,a.jsx)(r.M,{children:_&&(0,a.jsx)(l.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 flex items-center justify-center z-[9999] bg-transparent backdrop-blur-sm p-2 sm:p-4",children:(0,a.jsx)(l.E.div,{initial:{scale:.95,y:20,opacity:0},animate:{scale:1,y:0,opacity:1},exit:{scale:.95,y:20,opacity:0},className:"w-full max-w-xs sm:max-w-md md:max-w-lg",children:(0,a.jsxs)(i.Zb,{className:"bg-gray-50 dark:bg-zinc-900 overflow-hidden border border-gray-200 dark:border-zinc-800",children:[(0,a.jsx)("div",{className:"p-2 sm:p-3 border-b border-gray-200 dark:border-zinc-800 bg-gray-50 dark:bg-zinc-800/50",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("h2",{className:"text-sm font-semibold",children:"Select Console"}),(0,a.jsx)("button",{onClick:()=>A(!1),className:"p-1 rounded-full hover:bg-gray-200 dark:hover:bg-zinc-700",children:(0,a.jsx)(m.Z,{className:"w-4 h-4"})})]})}),(0,a.jsxs)("div",{className:"p-2 sm:p-3",children:[O?(0,a.jsx)("div",{className:"flex items-center justify-center h-24 sm:h-32",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-6 w-6 border-2 border-emerald-500 border-t-transparent"})}):0===M.length?(0,a.jsxs)("div",{className:"text-center py-6",children:[(0,a.jsx)(u.Z,{className:"w-8 h-8 text-amber-500 mx-auto mb-2"}),(0,a.jsx)("h3",{className:"text-sm font-medium mb-1",children:"No Consoles Available"}),(0,a.jsx)("p",{className:"text-gray-500 text-xs",children:"All consoles are in use."}),(0,a.jsxs)("div",{className:"mt-4 p-2 bg-gray-100 dark:bg-zinc-800 rounded text-xs text-left",children:[(0,a.jsx)("p",{children:"Debug Info:"}),(0,a.jsxs)("p",{children:["GameId: ",V]}),(0,a.jsxs)("p",{children:["VendorId: ",s]}),(0,a.jsx)("p",{children:"Check console for API response details"})]})]}):(0,a.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:M.map(e=>(0,a.jsx)(l.E.div,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>ec(e.consoleId),className:"cursor-pointer rounded-lg border ".concat(F===e.consoleId?"border-emerald-500 bg-emerald-50 dark:bg-emerald-900/20":"border-gray-200 dark:border-zinc-800 hover:border-emerald-500/50"," p-2 sm:p-3 transition-all duration-200"),children:(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[function(e){let t=(e||"").toLowerCase();return t.includes("ps5")?(0,a.jsx)(d.Z,{className:"w-4 h-4 text-blue-500"}):t.includes("xbox")?(0,a.jsx)(d.Z,{className:"w-4 h-4 text-green-500"}):(0,a.jsx)(c.Z,{className:"w-4 h-4 text-purple-500"})}(Z),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-sm font-medium",children:e.brand}),(0,a.jsx)("p",{className:"text-xs text-gray-500",children:e.consoleModelNumber})]})]})},e.consoleId))}),(0,a.jsx)(l.E.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:ed,disabled:!F||O,className:"w-full mt-4 py-2 sm:py-3 rounded-lg text-xs sm:text-sm font-medium flex items-center justify-center space-x-2 ".concat(F&&!O?"bg-emerald-500 hover:bg-emerald-600 text-white":"bg-gray-100 text-gray-400 cursor-not-allowed"),children:O?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent"}),(0,a.jsx)("span",{children:"Processing..."})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(x.Z,{className:"w-4 h-4"}),(0,a.jsx)("span",{children:"Start Session"})]})})]})]})})})}),(0,a.jsx)("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between pb-2 sm:pb-3 gap-2 sm:gap-4 flex-shrink-0",children:(0,a.jsxs)("div",{className:"flex items-center gap-2 px-3 py-2",children:[(0,a.jsx)("div",{className:"w-2 mt-2 h-2 rounded-full ".concat(I?"bg-green-500":"bg-red-500")}),(0,a.jsx)("h3",{className:"text-xs sm:text-sm font-semibold text-foreground mt-2",children:"Upcoming Bookings"}),(0,a.jsx)("span",{className:"px-2 py-0.5 bg-emerald-100 mt-2 text-emerald-800 rounded-full text-xs",children:en.length})]})}),(0,a.jsx)("div",{className:"pb-2 sm:pb-3 flex-shrink-0",children:(0,a.jsx)(C,{searchTerm:Y,setSearchTerm:K,selectedDate:X,setSelectedDate:$,timeFilter:Q,setTimeFilter:ee})}),(0,a.jsx)("div",{className:"flex-1 overflow-y-auto min-h-0",children:0===ei.length?(0,a.jsxs)("div",{className:"h-full flex flex-col items-center justify-center py-6 px-3 text-gray-500",children:[(0,a.jsx)(g.Z,{className:"w-8 h-8 mb-2 opacity-50"}),(0,a.jsx)("p",{className:"text-sm font-medium",children:"No bookings found"}),(0,a.jsx)("p",{className:"text-xs mt-1 text-center",children:I?"Waiting for bookings...":"Check filters"})]}):(0,a.jsx)("div",{className:"h-full overflow-y-auto",children:(0,a.jsx)("div",{className:"space-y-2 sm:space-y-3 lg:space-y-4 p-2 sm:p-4",children:(0,a.jsx)(r.M,{mode:"popLayout",children:ei.map((e,t)=>(0,a.jsx)(l.E.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,x:-50},layout:!0,transition:{duration:.3,delay:.02*t},className:"bg-gray-50 dark:bg-card rounded-lg sm:rounded-xl border border-gray-200 dark:border-zinc-700 p-2 sm:p-4 hover:shadow-sm transition-shadow duration-200",children:(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 min-w-0 flex-1",children:[(0,a.jsx)(h.Z,{className:"w-3 h-3 shrink-0"}),(0,a.jsx)("span",{className:"truncate text-xs sm:text-sm font-medium",children:e.username||"Guest User"})]}),(0,a.jsx)("span",{className:"px-2 py-0.5 rounded-full text-xs font-medium bg-emerald-100 text-emerald-800 shrink-0",children:"Paid"})]}),(0,a.jsxs)("div",{className:"flex flex-wrap gap-3 text-xs text-gray-600 dark:text-gray-400",children:[(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)(p.Z,{className:"w-3 h-3 shrink-0"}),(0,a.jsx)("span",{children:e.time||"No time set"})]}),(0,a.jsx)("div",{className:"flex items-center gap-1"}),(0,a.jsx)("div",{className:"flex items-center gap-2 ml-auto",children:e.hasMeals?(0,a.jsxs)(l.E.button,{whileHover:{scale:1.1},whileTap:{scale:.9},onClick:t=>{t.stopPropagation(),em(e.bookingId,e.username||"Guest User",!0)},className:"flex items-center gap-1 hover:bg-emerald-50 dark:hover:bg-emerald-900/20 rounded-full p-1.5 transition-all duration-200 group",title:"View meals & add more",children:[(0,a.jsx)(f.Z,{className:"w-4 h-4 text-emerald-600 group-hover:text-emerald-700 transition-colors"}),(0,a.jsx)("span",{className:"text-xs text-emerald-600 group-hover:text-emerald-700 font-medium",children:"Meals"})]}):(0,a.jsxs)(l.E.button,{whileHover:{scale:1.1},whileTap:{scale:.9},onClick:t=>{t.stopPropagation(),eu(e.bookingId,e.username||"Guest User")},className:"flex items-center gap-1 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-full p-1.5 transition-all duration-200 group border border-dashed border-blue-300 dark:border-blue-600",title:"Add meals to this booking",children:[(0,a.jsx)(b.Z,{className:"w-3 h-3 text-blue-600 group-hover:text-blue-700 transition-colors"}),(0,a.jsx)(f.Z,{className:"w-3 h-3 text-blue-600 group-hover:text-blue-700 transition-colors"}),(0,a.jsx)("span",{className:"text-xs text-blue-600 group-hover:text-blue-700 font-medium",children:"Add"})]})})]}),(0,a.jsxs)(l.E.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>er(e.consoleType||"",e.game_id,e.bookingId),className:"w-full py-1.5 sm:py-2 text-xs sm:text-sm bg-emerald-500 hover:bg-emerald-600 text-white rounded-md font-medium transition-all flex items-center justify-center gap-2",children:[(0,a.jsx)(x.Z,{className:"w-3 h-3"}),"Start"]})]})},e.bookingId))})})})})]}),et&&(0,y.createPortal)((0,a.jsx)(R,{isOpen:ea.isOpen,onClose:()=>{eo({isOpen:!1,bookingId:"",customerName:"",mode:"view",hasExistingMeals:!1})},bookingId:ea.bookingId,customerName:ea.customerName,initialMode:ea.mode,hasExistingMeals:ea.hasExistingMeals,vendorId:s}),document.body)]})}var J=s(14474),G=s(49089);let W=e=>{if(!e||0===e.length)return[];let t=JSON.parse(JSON.stringify(e)),s={};for(let e of t){let t="".concat(e.username,"_").concat(e.consoleType,"_").concat(e.consoleNumber,"_").concat(e.date);s[t]||(s[t]=[]),s[t].push(e)}let a=[];for(let e in s){let t=s[e];t.sort((e,t)=>Y(e.startTime)-Y(t.startTime));let o={...t[0],bookings:t},n=t.reduce((e,t)=>{let s=Y(t.endTime);return s>e?s:e},Y(t[0].endTime)),i=t.find(e=>Y(e.endTime)===n);i&&(o.endTime=i.endTime),a.push(o)}return a};function Y(e){if(!e)return 0;let[t,s]=e.trim().split(" "),[a,o]=t.split(":").map(Number);return"PM"===s&&a<12&&(a+=12),"AM"===s&&12===a&&(a=0),60*a+o}var K=s(75956),X=s(88226),$=s(33388),Q=s(41671),ee=e=>{let{showOverlay:t,setShowOverlay:s,selectedSlot:o,vendorId:i,setRefreshSlots:d,setSelectedSlot:c,calculateExtraTime:u,calculateExtraAmount:x,formatTime:g,releaseSlot:h}=e,[p,f]=(0,n.useState)("cash"),[b,y]=(0,n.useState)(!1),[v,j]=(0,n.useState)(""),[N,k]=(0,n.useState)(""),D=(0,n.useRef)(null);(0,n.useEffect)(()=>{t&&D.current&&D.current.focus()},[t]);let C=async e=>{try{let t=await fetch("".concat(w.o8,"/api/extraBooking"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("jwtToken"))},body:JSON.stringify(e)});if(!t.ok)throw Error("Failed to create extra booking");return await t.json()}catch(e){throw console.error("Error creating extra booking:",e),e}},I=async()=>{if(!o||!i){k("Invalid slot or vendor information");return}y(!0);let e=x(u(o.endTime,o.date),o.slot_price||100),t=parseFloat(v)||0,a={consoleNumber:o.consoleNumber,consoleType:o.consoleType,date:new Date().toISOString().split("T")[0],slotId:o.slotId,userId:o.userId,username:o.username,amount:e,gameId:o.game_id,vendorId:i,modeOfPayment:p,waiveOffAmount:t};try{console.log("\uD83D\uDCB0 Starting settle process..."),await C(a),console.log("\uD83D\uDCB0 Extra booking created successfully");let e=await h(o.consoleType,o.game_id,o.consoleNumber,i,d);(console.log("\uD83D\uDCB0 Release slot result:",e),e)?(console.log("\uD83D\uDCB0 Settle successful - updating UI immediately"),d(e=>!e),window.dispatchEvent(new CustomEvent("refresh-dashboard")),s(!1),c(null),j(""),k(""),y(!1),console.log("\uD83D\uDCB0 UI updated immediately - settle complete")):(console.log("\uD83D\uDCB0 Release slot failed"),k("Failed to release slot. Please try again."),y(!1))}catch(e){console.error("\uD83D\uDCB0 Settle process failed:",e),k("Failed to process payment. Please try again."),y(!1)}},S=(e,t)=>{("Enter"===e.key||" "===e.key)&&(e.preventDefault(),f(t))};return(0,a.jsx)(r.M,{children:t&&o&&(0,a.jsx)(l.E.div,{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-md",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:()=>s(!1),children:(0,a.jsxs)(l.E.div,{ref:D,className:"bg-white dark:bg-zinc-800 rounded-2xl shadow-xl p-8 w-full max-w-lg sm:max-w-md mx-4",initial:{scale:.95,y:30,opacity:0},animate:{scale:1,y:0,opacity:1},exit:{scale:.95,y:30,opacity:0},transition:{type:"spring",damping:20,stiffness:300},onClick:e=>e.stopPropagation(),role:"dialog","aria-labelledby":"extra-payment-title",tabIndex:-1,children:[(0,a.jsxs)("div",{className:"text-center mb-6",children:[(0,a.jsx)("h2",{id:"extra-payment-title",className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:"Extra Payment Required"}),(0,a.jsxs)("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-2",children:["The session for ",o.username," on ",o.consoleType," #",o.consoleNumber," has exceeded the allotted time."]})]}),(0,a.jsxs)("div",{className:"flex justify-between items-center bg-red-50 dark:bg-red-900/30 p-4 rounded-lg mb-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Extra Time"}),(0,a.jsx)("p",{className:"text-lg font-semibold text-red-600 dark:text-red-400",children:g(u(o.endTime,o.date))})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Amount Due"}),(0,a.jsxs)("p",{className:"text-lg font-semibold text-red-600 dark:text-red-400",children:["₹",(x(u(o.endTime,o.date),o.slot_price||100)-(parseFloat(v)||0)).toFixed(2)]})]})]}),(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("label",{htmlFor:"waive-off-amount",className:"block text-sm font-medium text-gray-900 dark:text-gray-200 mb-2",children:"Waive-Off Amount (₹)"}),(0,a.jsx)(l.E.input,{id:"waive-off-amount",type:"text",value:v,onChange:e=>{if(!o)return;let t=e.target.value;if(""===t||/^[0-9]*\.?[0-9]*$/.test(t)){j(t);let e=parseFloat(t)||0,s=x(u(o.endTime,o.date),o.slot_price||100);e<0?(k("Waive-off amount cannot be negative"),j("")):e>s?(k("Waive-off amount cannot exceed ₹".concat(s.toFixed(2))),j(s.toString())):k("")}},pattern:"[0-9]*\\.?[0-9]*",className:"w-full p-3 border rounded-lg bg-gray-50 dark:bg-zinc-900 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition-all duration-200 ".concat(N?"border-red-500 focus:ring-red-500":"border-gray-300 dark:border-gray-600"),placeholder:"Enter waive-off amount (e.g., 50.00)","aria-invalid":N?"true":"false","aria-describedby":N?"waive-off-error":void 0,whileFocus:{scale:1.02}}),N&&(0,a.jsx)("p",{id:"waive-off-error",className:"text-sm text-red-500 mt-1",children:N})]}),(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-900 dark:text-gray-200 mb-2",children:"Select Payment Mode"}),(0,a.jsx)("div",{className:"grid grid-cols-3 gap-3",children:[{key:"cash",label:"Cash",Icon:Z.Z},{key:"card",label:"Card",Icon:X.Z},{key:"upi",label:"UPI",Icon:$.Z}].map(e=>{let{key:t,label:s,Icon:o}=e;return(0,a.jsxs)(l.E.button,{onClick:()=>f(t),onKeyDown:e=>S(e,t),className:"flex flex-col items-center justify-center p-4 rounded-lg border transition-all duration-200\n                      ".concat(p===t?"bg-emerald-100 dark:bg-emerald-900/50 border-emerald-500 ring-2 ring-emerald-500/30":"border-gray-300 dark:border-gray-600 hover:bg-gray-100 dark:hover:bg-zinc-700 bg-white dark:bg-zinc-900 text-gray-900 dark:text-gray-100"),whileHover:{scale:1.05},whileTap:{scale:.95},"aria-pressed":p===t,role:"radio",children:[(0,a.jsx)(o,{className:"w-6 h-6 mb-2 ".concat(p===t?"text-emerald-600":"text-gray-500 dark:text-gray-400")}),(0,a.jsx)("span",{className:"text-sm font-medium ".concat(p===t?"text-emerald-700 dark:text-emerald-300":"text-gray-700 dark:text-gray-300"),children:s})]},t)})})]}),(0,a.jsxs)("div",{className:"flex justify-end gap-4",children:[(0,a.jsx)(l.E.button,{onClick:()=>{s(!1),j(""),k("")},className:"px-5 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-zinc-900 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm hover:bg-gray-50 dark:hover:bg-zinc-800 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-400 transition-all duration-200 disabled:opacity-50",disabled:b,whileHover:{scale:1.05},whileTap:{scale:.95},"aria-label":"Cancel extra payment",children:(0,a.jsxs)("span",{className:"flex items-center gap-2",children:[(0,a.jsx)(m.Z,{className:"w-4 h-4"}),"Cancel"]})}),(0,a.jsx)(l.E.button,{onClick:I,className:"px-6 py-2 text-sm font-medium text-white bg-emerald-600 hover:bg-emerald-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-emerald-500 rounded-md shadow-sm transition-all duration-200 disabled:opacity-50",disabled:b||!!N||!i,whileHover:{scale:1.05},whileTap:{scale:.95},"aria-label":"Settle extra payment",children:(0,a.jsx)("span",{className:"flex items-center gap-2",children:b?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(E.Z,{className:"w-4 h-4 animate-spin"}),"Processing..."]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(Q.Z,{className:"w-4 h-4"}),"Settle"]})})})]})]})})})};let et=e=>isNaN(e)||e<0?"00:00:00":"".concat(Math.floor(e/3600).toString().padStart(2,"0"),":").concat(Math.floor(e%3600/60).toString().padStart(2,"0"),":").concat((e%60).toString().padStart(2,"0")),es=(e,t)=>{if(!e)return 0;let s=new Date,a=new Date(t),[o,n]=e.trim().split(" "),[i,r]=o.split(":").map(Number),l=i;return"PM"===n&&i<12&&(l+=12),"AM"===n&&12===i&&(l=0),a.setHours(l,r,0,0),Math.floor((s.getTime()-a.getTime())/1e3)},ea=(e,t)=>{if(!e)return 0;let s=new Date,a=new Date(t),[o,n]=e.trim().split(" "),[i,r]=o.split(":").map(Number),l=i;return"PM"===n&&i<12&&(l+=12),"AM"===n&&12===i&&(l=0),a.setHours(l,r,0,0),Math.max(Math.floor((s.getTime()-a.getTime())/1e3),0)},eo=(e,t)=>{if(!e||!t)return 0;let s=e=>{let[t,s]=e.trim().split(" "),[a,o]=t.split(":").map(Number);return"PM"===s&&a<12&&(a+=12),"AM"===s&&12===a&&(a=0),60*a+o},a=s(e);return(s(t)-a)*60},en=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return Math.ceil(e/3600*t)},ei=async(e,t,s,a,o)=>{try{if(console.log("\uD83D\uDD04 Client: Calling release API for console:",s),(await fetch("".concat(w.m7,"/api/releaseDevice/consoleTypeId/").concat(t,"/console/").concat(s,"/vendor/").concat(a),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({bookingStats:{}})})).ok)return console.log("✅ Client: Release API call successful"),o(e=>!e),window.dispatchEvent(new CustomEvent("refresh-dashboard")),!0;throw Error("Failed to release the slot.")}catch(e){return console.error("❌ Client: Error calling release API:",e),!1}};function er(e){let{currentSlots:t,refreshSlots:s,setRefreshSlots:o}=e,{socket:i,isConnected:c,joinVendor:m}=(0,U.s)(),[u,x]=(0,n.useState)(t||[]),[g,h]=(0,n.useState)(""),[p,y]=(0,n.useState)(u),[v,j]=(0,n.useState)({}),[N,w]=(0,n.useState)(!1),[D,C]=(0,n.useState)(null),[I,S]=(0,n.useState)(null),[T,_]=(0,n.useState)([]),[A,Z]=(0,n.useState)(""),B=(0,n.useRef)(null),[M,P]=(0,n.useState)({isOpen:!1,bookingId:"",customerName:"",mode:"view",hasExistingMeals:!1}),[F,z]=(0,n.useState)({});(0,n.useEffect)(()=>{let e=localStorage.getItem("jwtToken");if(e)try{let t=(0,J.o)(e);S(t.sub.id)}catch(e){console.error("Error decoding token:",e),Z("Failed to authenticate user.")}else Z("No authentication token found.")},[]),(0,n.useEffect)(()=>{if(t&&Array.isArray(t)){x(t);let e={};t.forEach(t=>{(t.bookingId||t.bookId)&&(e[String(t.bookingId||t.bookId)]=!!t.hasMeals)}),z(e)}},[t]),(0,n.useEffect)(()=>{let e=e=>{let{bookingId:t}=e.detail||{};t&&(console.log("\uD83C\uDF7D️ Meal added event received for booking:",t),z(e=>({...e,[String(t)]:!0})),x(e=>e.map(e=>String(e.bookingId||e.bookId||"")===String(t)?{...e,hasMeals:!0}:e)))};return window.addEventListener("meal-added",e),()=>{window.removeEventListener("meal-added",e)}},[]),(0,n.useEffect)(()=>{if(i&&I&&c)return m(I),i.off("current_slot"),i.off("console_availability"),i.on("current_slot",e),i.on("console_availability",t),()=>{i.off("current_slot",e),i.off("console_availability",t)};function e(e){if(parseInt(e.vendorId||e.vendor_id)===I||!e.vendorId){let t={slotId:e.slotId,bookingId:e.bookId,username:e.username,consoleType:e.consoleType,consoleNumber:e.consoleNumber,game_id:e.game_id,startTime:e.startTime,endTime:e.endTime,date:e.date,status:"active",slot_price:e.slot_price,userId:e.userId,hasMeals:e.hasMeals};x(e=>{if(e.some(e=>e.slotId===t.slotId||e.bookingId===t.bookingId||e.consoleNumber===t.consoleNumber&&"active"===e.status))return e;{let s=String(t.bookingId);return z(e=>({...e,[s]:!!t.hasMeals})),[t,...e]}})}}function t(e){parseInt(e.vendorId||e.vendor_id)===I&&(o(e=>!e),!0===e.is_available&&x(t=>t.filter(t=>t.consoleNumber!==e.console_id.toString())))}},[i,I,c,m,o]),(0,n.useEffect)(()=>{let e=W(u),t=g?e.filter(e=>(e.username||"").toLowerCase().includes(g.toLowerCase())||(e.consoleType||"").toLowerCase().includes(g.toLowerCase())):e;y(t),_(t.map(e=>({slotId:e.slotId,startTime:e.startTime,endTime:e.endTime,date:e.date,elapsedTime:es(e.startTime||"",e.date||""),extraTime:ea(e.endTime||"",e.date||""),duration:eo(e.startTime||"",e.endTime||"")})))},[u,g]),(0,n.useEffect)(()=>{if(p.length>0){let e=p[0];console.log("\uD83D\uDD0D CurrentSlots sample booking structure:",{bookingId:e.bookingId,bookId:e.bookId,hasMeals:e.hasMeals,username:e.username})}},[p.length]),(0,n.useEffect)(()=>{let e=setInterval(()=>{_(e=>e.map(e=>({...e,elapsedTime:es(e.startTime||"",e.date||""),extraTime:ea(e.endTime||"",e.date||"")})))},1e3);return()=>clearInterval(e)},[]);let O=async(e,t,s,a,o,n,i)=>{j(e=>({...e,[i]:!0}));try{await ei(e,t,s,a,o)?x(e=>e.filter(e=>e.slotId!==n)):Z("Failed to release slot. Please try again.")}catch(e){Z("Error releasing slot. Please try again.")}finally{j(e=>({...e,[i]:!1}))}},L=(e,t)=>{if(console.log("\uD83C\uDF7D️ CurrentSlots: Meal icon clicked",{originalBookingId:e,customerName:t,isValidId:!!(e&&"undefined"!==e)}),!e||"undefined"===e){console.error("❌ Invalid booking ID for meal details"),Z("Cannot load meal details - invalid booking ID");return}P({isOpen:!0,bookingId:e,customerName:t||"Guest User",mode:"view",hasExistingMeals:!0})},H=(e,t)=>{if(console.log("➕ CurrentSlots: Add food clicked",{bookingId:e,customerName:t,isValidId:!!(e&&"undefined"!==e)}),!e||"undefined"===e){console.error("❌ Invalid booking ID for adding food"),Z("Cannot add food - invalid booking ID");return}P({isOpen:!0,bookingId:e,customerName:t||"Guest User",mode:"add",hasExistingMeals:!1})},q={hidden:{opacity:0,y:20},show:{opacity:1,y:0}};return(0,a.jsx)("div",{className:"h-full flex flex-col min-h-0 overflow-hidden",children:(null==u?void 0:u.available)?(0,a.jsx)("div",{className:"flex justify-center items-center h-full",children:(0,a.jsx)(K.Z,{})}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between pb-2 sm:pb-3 gap-2 sm:gap-4 flex-shrink-0",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("div",{className:"w-2 h-2 rounded-full ".concat(c?"bg-green-500":"bg-red-500"),title:c?"Real-time connected":"Connecting..."}),(0,a.jsxs)("span",{className:"text-xs sm:text-sm md:text-base font-semibold text-white",children:["Current Slots (",p.length,")"]})]}),(0,a.jsxs)("div",{className:"relative w-full sm:w-auto",children:[(0,a.jsx)(k.Z,{className:"absolute left-2 top-1/2 transform -translate-y-1/2 text-gray-500 w-3 sm:w-4 h-3 sm:h-4"}),(0,a.jsx)("input",{type:"text",value:g,onChange:e=>{h(e.target.value),Z("")},placeholder:"Search by name or console...",className:"w-full sm:w-48 md:w-64 pl-7 sm:pl-8 pr-3 py-1.5 sm:py-2 text-xs sm:text-sm border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-zinc-800 text-gray-900 dark:text-gray-100 focus:ring-1 focus:ring-emerald-500"})]})]}),A&&(0,a.jsx)(l.E.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"bg-red-50 dark:bg-red-900/30 text-red-600 dark:text-red-400 p-2 rounded-md text-xs sm:text-sm mb-2 flex-shrink-0",children:A}),(0,a.jsx)(l.E.div,{variants:{hidden:{opacity:0},show:{opacity:1,transition:{staggerChildren:.05}}},initial:"hidden",animate:"show",className:"flex-1 min-h-0 rounded-md border border-gray-200 dark:border-gray-700 bg-white/50 dark:bg-zinc-800/50 backdrop-blur-sm shadow-sm overflow-hidden",children:(0,a.jsx)("div",{className:"h-full overflow-y-auto",children:(0,a.jsxs)("table",{ref:B,className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[(0,a.jsx)("thead",{className:"bg-gray-50 dark:bg-zinc-900/50 sticky top-0 z-10",children:(0,a.jsx)("tr",{children:["Name","System","Time","Progress","Extra","Action"].map(e=>(0,a.jsx)("th",{scope:"col",className:"px-2 sm:px-3 md:px-4 py-2 sm:py-3 text-left text-xs font-semibold text-gray-600 dark:text-gray-300 uppercase tracking-wider",children:e},e))})}),(0,a.jsx)("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:Array.isArray(p)&&p.length>0?(0,a.jsx)(r.M,{mode:"popLayout",children:p.map((e,t)=>{var s,n;let i=T.find(t=>t.slotId===e.slotId)||{elapsedTime:0,extraTime:0,duration:3600},r="".concat(e.slotId,"-").concat(e.bookingId||e.bookId,"-").concat(e.consoleNumber),c=v[r]||!1,m=Math.min(100,i.elapsedTime/i.duration*100),u=i.extraTime>0,x=String(e.bookingId||e.bookId||""),g=null!==(n=null!==(s=F[x])&&void 0!==s?s:e.hasMeals)&&void 0!==n&&n;return(0,a.jsxs)(l.E.tr,{variants:q,className:"hover:bg-gray-100 dark:hover:bg-zinc-700/50 transition-colors",initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,x:-20},transition:{duration:.3},children:[(0,a.jsx)("td",{className:"px-2 sm:px-3 md:px-4 py-2 sm:py-3",children:(0,a.jsxs)("div",{className:"flex items-center gap-1 sm:gap-2",children:[(0,a.jsx)("div",{className:"h-6 w-6 sm:h-8 sm:w-8 bg-emerald-100 dark:bg-emerald-900/50 rounded-full flex items-center justify-center text-xs font-medium text-emerald-700 dark:text-emerald-300 flex-shrink-0",children:(e.username||"Guest").slice(0,2).toUpperCase()}),(0,a.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,a.jsx)("div",{className:"font-medium text-gray-900 dark:text-white text-xs sm:text-sm truncate",children:e.username||"Guest"}),(0,a.jsxs)("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:["#",e.consoleNumber]})]}),g?(0,a.jsxs)(l.E.button,{initial:{scale:0},animate:{scale:1},whileHover:{scale:1.1},whileTap:{scale:.9},onClick:t=>{t.stopPropagation(),L(x,e.username||"Guest User")},className:"flex items-center gap-1 hover:bg-emerald-50 dark:hover:bg-emerald-900/20 rounded-full p-1.5 transition-all duration-200 group flex-shrink-0",title:"View meals & add more",children:[(0,a.jsx)(f.Z,{className:"w-3 h-3 sm:w-4 sm:h-4 text-emerald-600 group-hover:text-emerald-700 transition-colors"}),(0,a.jsx)("span",{className:"text-xs text-emerald-600 group-hover:text-emerald-700 font-medium hidden sm:inline",children:"Meals"})]}):(0,a.jsxs)(l.E.button,{initial:{scale:0},animate:{scale:1},whileHover:{scale:1.1},whileTap:{scale:.9},onClick:t=>{t.stopPropagation(),H(x,e.username||"Guest User")},className:"flex items-center gap-1 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-full p-1 sm:p-1.5 transition-all duration-200 group border border-dashed border-blue-300 dark:border-blue-600 flex-shrink-0",title:"Add meals to this booking",children:[(0,a.jsx)(b.Z,{className:"w-2.5 h-2.5 sm:w-3 sm:h-3 text-blue-600 group-hover:text-blue-700 transition-colors"}),(0,a.jsx)(f.Z,{className:"w-2.5 h-2.5 sm:w-3 sm:h-3 text-blue-600 group-hover:text-blue-700 transition-colors"}),(0,a.jsx)("span",{className:"text-xs text-blue-600 group-hover:text-blue-700 font-medium hidden sm:inline",children:"Add"})]})]})}),(0,a.jsx)("td",{className:"px-2 sm:px-3 md:px-4 py-2 sm:py-3",children:(0,a.jsxs)("div",{className:"flex items-center space-x-1 sm:space-x-2",children:[(0,a.jsx)(d.Z,{className:"w-3 h-3 sm:w-4 sm:h-4 flex-shrink-0 ".concat((e.consoleType||"").toLowerCase().includes("playstation")||(e.consoleType||"").toLowerCase().includes("ps")?"text-blue-600":(e.consoleType||"").toLowerCase().includes("xbox")?"text-green-600":"text-red-600")}),(0,a.jsx)("span",{className:"text-xs sm:text-sm text-gray-900 dark:text-gray-100 truncate",children:e.consoleType||"Gaming Console"})]})}),(0,a.jsx)("td",{className:"px-2 sm:px-3 md:px-4 py-2 sm:py-3",children:(0,a.jsxs)("div",{className:"text-xs space-y-0.5 sm:space-y-1",children:[(0,a.jsxs)("div",{className:"truncate",children:[(0,a.jsx)("span",{className:"text-gray-600 hidden sm:inline",children:"Start:"}),(0,a.jsx)("span",{className:"text-gray-600 sm:hidden",children:"S:"})," ",e.startTime||"N/A"]}),(0,a.jsxs)("div",{className:"truncate",children:[(0,a.jsx)("span",{className:"text-gray-600 hidden sm:inline",children:"End:"}),(0,a.jsx)("span",{className:"text-gray-600 sm:hidden",children:"E:"})," ",e.endTime||"N/A"]})]})}),(0,a.jsx)("td",{className:"px-2 sm:px-3 md:px-4 py-2 sm:py-3",children:(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)("div",{className:"text-xs sm:text-sm font-medium text-gray-900 dark:text-gray-100",children:et(i.elapsedTime)}),(0,a.jsx)("div",{className:"h-1.5 sm:h-1 w-16 sm:w-20 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden",children:(0,a.jsx)(l.E.div,{className:"h-full ".concat(m<75?"bg-emerald-500":m<90?"bg-yellow-500":"bg-red-500"),style:{width:"".concat(m,"%")},initial:{width:0},animate:{width:"".concat(m,"%")},transition:{duration:.5}})})]})}),(0,a.jsx)("td",{className:"px-2 sm:px-3 md:px-4 py-2 sm:py-3",children:u?(0,a.jsx)("div",{className:"text-red-600 dark:text-red-400 font-medium text-xs sm:text-sm",children:et(i.extraTime)}):(0,a.jsx)("span",{className:"text-emerald-600 dark:text-emerald-400 text-xs sm:text-sm",children:"00:00:00"})}),(0,a.jsx)("td",{className:"px-2 sm:px-3 md:px-4 py-2 sm:py-3",children:u?(0,a.jsx)("button",{onClick:()=>{C(e),w(!0),Z("")},className:"bg-yellow-500 hover:bg-yellow-600 text-white px-2 sm:px-3 py-1 rounded text-xs w-16 sm:w-20 transition-colors",children:(0,a.jsxs)("div",{className:"flex items-center justify-center gap-1",children:[(0,a.jsx)(G.l_A,{className:"w-2 h-2 sm:w-3 sm:h-3"}),(0,a.jsx)("span",{className:"hidden sm:inline",children:"Settle"}),(0,a.jsx)("span",{className:"sm:hidden",children:"Set"})]})}):(0,a.jsx)("button",{onClick:()=>O(e.consoleType||"",e.game_id||"",e.consoleNumber||"",I,o,e.slotId,r),disabled:c||!I,className:"bg-emerald-600 hover:bg-emerald-700 text-white px-2 sm:px-3 py-1 rounded text-xs w-16 sm:w-20 disabled:opacity-50 transition-colors",children:(0,a.jsxs)("div",{className:"flex items-center justify-center gap-1",children:[c?(0,a.jsx)(E.Z,{className:"animate-spin w-2 h-2 sm:w-3 sm:h-3"}):(0,a.jsx)(G.d7k,{className:"w-2 h-2 sm:w-3 sm:h-3"}),(0,a.jsx)("span",{className:"hidden sm:inline",children:c?"...":"Release"}),(0,a.jsx)("span",{className:"sm:hidden",children:c?"...":"Rel"})]})})})]},r)})}):(0,a.jsx)("tr",{children:(0,a.jsx)("td",{colSpan:6,className:"px-2 sm:px-3 md:px-4 py-6 sm:py-8 text-center text-gray-500 dark:text-gray-400",children:(0,a.jsxs)(l.E.div,{initial:{opacity:0},animate:{opacity:1},className:"flex flex-col items-center space-y-2",children:[(0,a.jsx)(k.Z,{className:"w-6 h-6 sm:w-8 sm:h-8 text-gray-300 dark:text-gray-600"}),(0,a.jsx)("p",{className:"text-xs sm:text-sm font-medium",children:"No active slots found"}),(0,a.jsx)("p",{className:"text-xs",children:c?"Waiting for new sessions...":"Check connection"})]})})})})]})})}),(0,a.jsx)(ee,{showOverlay:N,setShowOverlay:w,selectedSlot:D,vendorId:I,setRefreshSlots:o,setSelectedSlot:C,calculateExtraTime:ea,calculateExtraAmount:en,formatTime:et,releaseSlot:ei}),(0,a.jsx)(R,{isOpen:M.isOpen,onClose:()=>{P({isOpen:!1,bookingId:"",customerName:"",mode:"view",hasExistingMeals:!1}),window.dispatchEvent(new CustomEvent("refresh-dashboard"))},bookingId:M.bookingId,customerName:M.customerName,initialMode:M.mode,hasExistingMeals:M.hasExistingMeals,vendorId:String(I||"")})]})})}var el=s(32151),ed=s(35471),ec=s(66337),em=s(96215),eu=s(87769),ex=s(70525),eg=s(97411),eh=s(88944),ep=s(94766),ef=s(62869),eb=s(35974),ey=s(91804),ev=s(30401);function ej(e){let{vendorId:t,isOpen:s,onClose:o,notifications:i,onRemoveNotification:d,socket:c,onBookingAccepted:u}=e,[x,f]=(0,n.useState)({bookingId:null,action:null}),b=async e=>{if(!x.bookingId)try{f({bookingId:e.bookingId,action:"accept"}),console.log("\uD83D\uDD04 Processing accept for booking ".concat(e.bookingId));let s=await fetch("".concat(w.o8,"/api/pay-at-cafe/accept"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({booking_id:e.bookingId,vendor_id:t})}),a=await s.json();if(s.ok&&a.success){if(d(e.bookingId),c&&(console.log("\uD83D\uDCE1 Emitting booking_accepted event for real-time update"),c.emit("booking_accepted",{bookingId:e.bookingId,vendorId:t,userId:e.userId,username:e.username,game_id:e.game_id,consoleType:e.consoleType,date:e.date,time:e.time,status:"Confirmed",booking_status:"upcoming"})),u){let t={bookingId:e.bookingId,slotId:e.slotId,username:e.username,userId:e.userId,game:e.game.game_name,game_id:e.game_id,consoleType:e.consoleType,date:e.date,time:e.time,status:"Confirmed",statusLabel:"Confirmed"};console.log("\uD83D\uDCC5 Triggering upcoming bookings update with:",t),u(t)}j("✅ Booking accepted! Collect ₹"+e.game.single_slot_price+" when customer arrives.","success"),console.log("✅ Booking ".concat(e.bookingId," confirmed — payment to be collected at cafe"))}else throw Error(a.message||"Failed to accept booking")}catch(e){console.error("Error accepting booking:",e),j("❌ Error accepting booking. Please try again.","error")}finally{f({bookingId:null,action:null})}},y=async e=>{if(!x.bookingId)try{f({bookingId:e.bookingId,action:"reject"}),console.log("\uD83D\uDD04 Processing reject for booking ".concat(e.bookingId));let s=await fetch("".concat(w.o8,"/api/pay-at-cafe/reject"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({booking_id:e.bookingId,vendor_id:t,rejection_reason:"Rejected by vendor"})}),a=await s.json();if(s.ok&&a.success)d(e.bookingId),j("✅ Booking rejected and cancelled successfully!","success"),console.log("❌ Booking ".concat(e.bookingId," cancelled successfully"));else throw Error(a.message||"Failed to reject booking")}catch(e){console.error("Error rejecting booking:",e),j("❌ Error rejecting booking. Please try again.","error")}finally{f({bookingId:null,action:null})}},v=e=>{let t=new Date(e),s=Math.floor((new Date().getTime()-t.getTime())/1e3);return s<60?"Just now":s<3600?"".concat(Math.floor(s/60),"m ago"):s<86400?"".concat(Math.floor(s/3600),"h ago"):"".concat(Math.floor(s/86400),"d ago")},j=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"success",s=document.createElement("div");s.className="fixed top-4 right-4 px-6 py-3 rounded-lg shadow-xl z-[10000] text-white font-medium transform transition-all duration-300 ".concat("success"===t?"bg-green-500":"bg-red-500"),s.innerHTML='\n      <div class="flex items-center gap-2">\n        <div class="w-2 h-2 rounded-full bg-white animate-pulse"></div>\n        <span>'.concat(e,"</span>\n      </div>\n    "),document.body.appendChild(s),setTimeout(()=>document.body.removeChild(s),4e3)},N=e=>{let t=new Date(e),s=new Date,a=new Date(s);return(a.setDate(a.getDate()+1),t.toDateString()===s.toDateString())?"Today":t.toDateString()===a.toDateString()?"Tomorrow":t.toLocaleDateString("en-IN",{weekday:"short",month:"short",day:"numeric"})},k=i.length;return(0,a.jsx)(r.M,{children:s&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(l.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:o,className:"fixed inset-0 bg-black/30 backdrop-blur-sm z-40"}),(0,a.jsxs)(l.E.div,{initial:{y:-100,opacity:0,scale:.95},animate:{y:0,opacity:1,scale:1},exit:{y:-100,opacity:0,scale:.95},transition:{type:"spring",damping:25,stiffness:300},className:"fixed top-16 right-4 left-4 md:left-auto md:w-96 bg-card border border-border rounded-xl shadow-2xl z-50 max-h-[85vh] overflow-hidden",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-4 border-b border-border",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("h3",{className:"font-semibold text-foreground",children:"Pay at Cafe Requests"}),k>0&&(0,a.jsx)(eb.C,{variant:"destructive",className:"text-xs",children:k})]}),(0,a.jsx)(ef.z,{variant:"ghost",size:"sm",onClick:o,className:"h-8 w-8 p-0 rounded-full hover:bg-muted",children:(0,a.jsx)(m.Z,{className:"w-4 h-4"})})]}),(0,a.jsx)("div",{className:"max-h-[70vh] overflow-y-auto",children:0===i.length?(0,a.jsxs)("div",{className:"text-center py-12 px-6",children:[(0,a.jsx)("div",{className:"w-16 h-16 mx-auto mb-4 rounded-full bg-muted/50 flex items-center justify-center",children:(0,a.jsx)(ep.Z,{className:"w-8 h-8 text-muted-foreground opacity-50"})}),(0,a.jsx)("h4",{className:"font-medium text-foreground mb-2",children:"No payment requests"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground max-w-sm mx-auto leading-relaxed",children:'When customers choose "Pay at Cafe" for their bookings, you\'ll see their requests here for approval.'})]}):(0,a.jsx)("div",{children:i.map((e,t)=>{let s=x.bookingId===e.bookingId,o=s&&"accept"===x.action,n=s&&"reject"===x.action;return(0,a.jsx)(l.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,x:20},transition:{delay:.1*t},className:"p-4 ".concat(t!==i.length-1?"border-b border-border":""," ").concat(s?"opacity-75":""),children:(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-medium text-foreground",children:"Pay at Cafe Request"}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:v(e.emitted_at)})]}),(0,a.jsxs)(eb.C,{variant:"outline",className:"text-xs border-orange-400 text-orange-500 bg-orange-500/10 flex items-center gap-1",children:[(0,a.jsx)(ey.Z,{className:"w-3 h-3"}),"To Be Paid"]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(h.Z,{className:"w-4 h-4 text-muted-foreground"}),(0,a.jsx)("span",{className:"font-medium text-foreground",children:e.username}),(0,a.jsx)("span",{className:"text-xs text-muted-foreground",children:"wants to book"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-4 text-sm",children:[(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)(p.Z,{className:"w-3 h-3 text-muted-foreground"}),(0,a.jsx)("span",{className:"text-foreground",children:e.time})]}),(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)(g.Z,{className:"w-3 h-3 text-muted-foreground"}),(0,a.jsx)("span",{className:"text-foreground",children:N(e.date)})]})]}),(0,a.jsxs)("div",{className:"bg-orange-500/10 border border-orange-400/30 rounded-lg p-3",children:[(0,a.jsx)("p",{className:"text-xs text-orange-500 font-medium text-center mb-1",children:"To Be Paid at Cafe"}),(0,a.jsx)("div",{className:"text-center",children:(0,a.jsxs)("span",{className:"text-2xl font-bold text-orange-500",children:["₹",e.game.single_slot_price]})}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground text-center mt-1",children:"Collect cash when customer arrives"})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsxs)(ef.z,{onClick:()=>b(e),disabled:s,className:"flex-1 bg-green-600 hover:bg-green-700 text-white h-9 text-sm",children:[o?(0,a.jsx)("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"}):(0,a.jsx)(ev.Z,{className:"w-4 h-4 mr-2"}),o?"Accepting...":"Accept"]}),(0,a.jsxs)(ef.z,{onClick:()=>y(e),disabled:s,variant:"destructive",className:"flex-1 h-9 text-sm",children:[n?(0,a.jsx)("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"}):(0,a.jsx)(m.Z,{className:"w-4 h-4 mr-2"}),n?"Rejecting...":"Reject"]})]})]})},e.event_id)})})})]})]})})}function eN(e){let{vendorId:t,onBookingAccepted:s,latestBookingEvent:o}=e,[i,r]=(0,n.useState)(!1),[l,d]=(0,n.useState)(0),[c,m]=(0,n.useState)("disconnected"),[u,x]=(0,n.useState)([]),{socket:g,isConnected:h,joinVendor:p}=(0,U.s)(),f=async()=>{if(t)try{console.log("\uD83D\uDD0D NotificationButton: Fetching pending bookings for vendor ".concat(t,"..."));let e=await fetch("".concat(w.o8,"/api/pay-at-cafe/pending/").concat(t)),s=await e.json();s.success&&s.notifications?(console.log("\uD83D\uDCCB NotificationButton: Loaded ".concat(s.notifications.length," pending bookings from API")),x(s.notifications),d(s.notifications.length)):(console.log("\uD83D\uDCCB NotificationButton: No pending bookings found"),x([]),d(0))}catch(e){console.error("❌ NotificationButton: Error fetching pending bookings:",e)}},b=(0,n.useCallback)(e=>{console.log("\uD83C\uDFAF NotificationButton: Booking accepted from NotificationPanel:",e),s&&(console.log("\uD83D\uDCC5 NotificationButton: Triggering upstream callback for booking acceptance"),s(e))},[s]);(0,n.useEffect)(()=>{if(o){if(console.log("\uD83D\uDD14 NotificationButton: Received booking event from Dashboard:",o),o.vendorId===t&&"pending_acceptance"===o.status){if(console.log("\uD83D\uDD14 NotificationButton: Processing pay at cafe notification for vendor:",t),x(e=>{if(!e.some(e=>e.bookingId===o.bookingId)){console.log("\uD83D\uDCE5 NotificationButton: Adding new notification from Dashboard event");let t=[o,...e];return console.log("\uD83D\uDCC4 NotificationButton: New notification data:",JSON.stringify(o,null,2)),t}return console.log("⚠️ NotificationButton: Notification already exists, skipping"),e}),d(e=>{let t=e+1;return console.log("\uD83D\uDCCA NotificationButton: Updated unread count from",e,"to",t),t}),"granted"===Notification.permission)try{var e,s,a;let t=new Notification("New Pay at Cafe Request",{body:"".concat(o.username," wants to book ").concat((null===(e=o.game)||void 0===e?void 0:e.game_name)||"a game"," for ₹").concat((null===(s=o.game)||void 0===s?void 0:s.single_slot_price)||(null===(a=o.slot_price)||void 0===a?void 0:a.single_slot_price)),icon:"/favicon.ico",tag:"pay_at_cafe_".concat(o.bookingId),requireInteraction:!0});setTimeout(()=>t.close(),1e4)}catch(e){console.log("NotificationButton: Browser notification failed:",e)}}else console.log("\uD83D\uDEAB NotificationButton: Ignoring event - not a pay-at-cafe notification:",{eventVendorId:o.vendorId,ourVendorId:t,status:o.status,expectedStatus:"pending_acceptance"})}},[o,t]),(0,n.useEffect)(()=>{if(!g||!h||!t){m("disconnected");return}console.log("\uD83D\uDD0C NotificationButton: Setting up notification removal events for vendor ".concat(t,"...")),m("connected"),p(t),m("joined_room");let e=e=>{console.log("✅ NotificationButton: Booking accepted via socket event:",e),x(t=>{let s=t.filter(t=>t.bookingId!==e.bookingId);return console.log("\uD83D\uDCC9 NotificationButton: Removed accepted booking. Count:",t.length,"->",s.length),s}),d(e=>Math.max(0,e-1))},s=e=>{console.log("❌ NotificationButton: Booking rejected via socket event:",e),x(t=>{let s=t.filter(t=>t.bookingId!==e.bookingId);return console.log("\uD83D\uDCC9 NotificationButton: Removed rejected booking. Count:",t.length,"->",s.length),s}),d(e=>Math.max(0,e-1))};return g.on("pay_at_cafe_accepted",e),g.on("pay_at_cafe_rejected",s),"Notification"in window&&"default"===Notification.permission&&Notification.requestPermission().then(e=>{console.log("NotificationButton: Notification permission:",e)}),()=>{console.log("\uD83E\uDDF9 NotificationButton: Cleaning up socket event listeners"),g.off("pay_at_cafe_accepted",e),g.off("pay_at_cafe_rejected",s)}},[g,h,t,p]),(0,n.useEffect)(()=>{t&&f()},[t]);let y=(()=>{switch(c){case"joined_room":return{color:"bg-green-500",title:"Connected - Live notifications active"};case"connected":return{color:"bg-yellow-500",title:"Connected - Joining vendor room..."};case"disconnected":return{color:"bg-red-500",title:"Disconnected - Attempting to reconnect..."};default:return{color:"bg-gray-500",title:"Unknown status"}}})();return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsxs)(ef.z,{variant:"outline",size:"sm",onClick:()=>r(!i),className:"relative p-2 h-10 w-10 rounded-lg border-border hover:bg-muted transition-colors duration-200",children:[(0,a.jsx)(ep.Z,{className:"w-4 h-4 ".concat(l>0?"text-orange-500 animate-pulse":"joined_room"===c?"text-green-500":"text-muted-foreground")}),l>0&&(0,a.jsx)(eb.C,{variant:"destructive",className:"absolute -top-2 -right-2 h-5 w-5 p-0 flex items-center justify-center text-xs font-bold animate-bounce",children:l>9?"9+":l})]}),(0,a.jsx)("div",{className:"absolute -bottom-1 -right-1 w-3 h-3 rounded-full border-2 border-white ".concat(y.color," ").concat("disconnected"===c?"animate-pulse":""),title:y.title})]}),(0,a.jsx)(ej,{vendorId:t,isOpen:i,onClose:()=>{r(!1),d(0)},notifications:u,onRemoveNotification:e=>{console.log("\uD83D\uDDD1️ NotificationButton: Manually removing notification:",e),x(t=>{let s=t.filter(t=>t.bookingId!==e);return console.log("\uD83D\uDCC9 NotificationButton: Manual removal. Count:",t.length,"->",s.length),s}),d(e=>Math.max(0,e-1))},socket:g,onBookingAccepted:b})]})}var ew=s(56439),ek=s(99376);let eD={platforms:[{name:"PC",icon:c.Z,color:"#3b82f6",bgColor:"#dbeafe",type:"pc"},{name:"PS5",icon:d.Z,color:"#a855f7",bgColor:"#f3e8ff",type:"ps5"},{name:"Xbox",icon:el.Z,color:"#10b981",bgColor:"#d1fae5",type:"xbox"},{name:"VR",icon:ed.Z,color:"#f59e0b",bgColor:"#fef3c7",type:"vr"}]};function eC(){let e=(0,ek.useRouter)();return(0,a.jsx)("div",{className:"absolute inset-0 z-10 flex flex-col items-center justify-center gap-4 rounded-lg bg-background/70 backdrop-blur-sm",children:(0,a.jsxs)("div",{className:"flex flex-col items-center gap-3 text-center px-6",children:[(0,a.jsx)("div",{className:"p-4 bg-destructive/10 rounded-full",children:(0,a.jsx)(ec.Z,{className:"w-8 h-8 text-destructive"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"font-bold text-base text-foreground",children:"Subscription Required"}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Subscribe to view and manage live sessions"})]}),(0,a.jsx)("button",{onClick:()=>e.push("/subscription"),className:"mt-1 px-6 py-2 bg-primary text-primary-foreground text-sm font-semibold rounded-lg hover:bg-primary/90 transition-colors shadow-md",children:"Subscribe Now"})]})})}function eI(){var e,t,s,o,d,m,u,x,g,h,p,f;let[b,y]=(0,n.useState)(!0),[v,j]=(0,n.useState)(!1),[N,k]=(0,n.useState)(!1),[D,C]=(0,n.useState)(!1),[I,E]=(0,n.useState)(null),[S,_]=(0,n.useState)(null),[A,B]=(0,n.useState)(!1),[M,P]=(0,n.useState)(null),[F,z]=(0,n.useState)("analytics"),[O,L]=(0,n.useState)([]),[R,H]=(0,n.useState)({}),{socket:q,isConnected:G,joinVendor:W}=(0,U.s)(),{isLocked:Y}=(0,ew.m)();(0,ek.useRouter)(),(0,n.useEffect)(()=>{let e=localStorage.getItem("jwtToken");if(e)try{let t=(0,J.o)(e);console.log("\uD83D\uDD11 Decoded vendor ID:",t.sub.id),E(t.sub.id)}catch(e){console.error("❌ Error decoding JWT token:",e)}},[]),(0,n.useEffect)(()=>{(async()=>{if(I)try{console.log("\uD83D\uDCCA Loading initial dashboard data...");let e=await fetch("".concat(w.m7,"/api/getLandingPage/vendor/").concat(I)),t=await e.json();_(t),console.log("✅ Initial dashboard data loaded")}catch(e){console.error("❌ Error loading initial dashboard data:",e)}})()},[I]),(0,n.useEffect)(()=>{(async()=>{if(I)try{let e=await fetch("".concat(w.m7,"/api/getConsoles/vendor/").concat(I)),t=await e.json();L(t)}catch(e){console.error("Error fetching booking data:",e)}})()},[I,D]),(0,n.useEffect)(()=>{if(!q||!I||!G)return;console.log("\uD83D\uDCCA Dashboard: Setting up booking event listener for real-time stats updates"),W(I);let e=async()=>{try{console.log("\uD83D\uDD04 Fetching fresh dashboard stats...");let e=await fetch("".concat(w.m7,"/api/getLandingPage/vendor/").concat(I)),t=await e.json();t.stats&&(console.log("\uD83D\uDCB0 Updated stats received:",t.stats),H({todayEarnings:t.stats.todayEarnings,todayBookings:t.stats.todayBookings,pendingAmount:t.stats.pendingAmount,todayBookingsChange:t.stats.todayBookingsChange||0,lastUpdate:new Date().toLocaleTimeString()}),_(e=>({...e,stats:t.stats})))}catch(e){console.error("❌ Error fetching fresh stats:",e)}};function t(t){if(console.log("\uD83D\uDCC5 Booking event received:",t),t.vendorId===I){let s=(t.status||"").toLowerCase();"pending_acceptance"===t.status&&(console.log("\uD83D\uDD14 Dashboard: Passing pay-at-cafe event to NotificationButton"),P(t)),("confirmed"===s||"paid"===s||"completed"===s)&&(console.log("✅ Booking confirmed/paid/completed - updating dashboard stats"),H(e=>{var s,a;return{...e,todayBookings:(e.todayBookings||(null==S?void 0:null===(s=S.stats)||void 0===s?void 0:s.todayBookings)||0)+1,todayEarnings:(e.todayEarnings||(null==S?void 0:null===(a=S.stats)||void 0===a?void 0:a.todayEarnings)||0)+(t.amount||t.slot_price||0),lastUpdate:new Date().toLocaleTimeString()}}),setTimeout(()=>{e()},1e3)),("cancelled"===s||"rejected"===s)&&(console.log("❌ Booking cancelled/rejected - updating dashboard stats"),setTimeout(()=>{e()},500))}}function s(t){console.log("\uD83D\uDCC5 Upcoming booking event received:",t),t.vendorId===I&&"Confirmed"===t.status&&(console.log("✅ New confirmed booking - updating stats"),e())}function a(t){console.log("\uD83C\uDFAE Console availability event received:",t),t.vendorId===I&&!0===t.is_available&&(console.log("\uD83C\uDFAE Session ended - refreshing stats for potential earnings update"),setTimeout(()=>{e()},1e3))}return q.on("booking",t),q.on("upcoming_booking",s),q.on("console_availability",a),()=>{console.log("\uD83E\uDDF9 Cleaning up dashboard booking listeners"),q.off("booking",t),q.off("upcoming_booking",s),q.off("console_availability",a)}},[q,I,G,W,null==S?void 0:S.stats]),(0,n.useEffect)(()=>{let e=()=>C(e=>!e);return window.addEventListener("refresh-dashboard",e),()=>window.removeEventListener("refresh-dashboard",e)},[]);let X={todayEarnings:null!==(m=null!==(d=R.todayEarnings)&&void 0!==d?d:null==S?void 0:null===(e=S.stats)||void 0===e?void 0:e.todayEarnings)&&void 0!==m?m:0,todayBookings:null!==(x=null!==(u=R.todayBookings)&&void 0!==u?u:null==S?void 0:null===(t=S.stats)||void 0===t?void 0:t.todayBookings)&&void 0!==x?x:0,pendingAmount:null!==(h=null!==(g=R.pendingAmount)&&void 0!==g?g:null==S?void 0:null===(s=S.stats)||void 0===s?void 0:s.pendingAmount)&&void 0!==h?h:0,todayBookingsChange:null!==(f=null!==(p=R.todayBookingsChange)&&void 0!==p?p:null==S?void 0:null===(o=S.stats)||void 0===o?void 0:o.todayBookingsChange)&&void 0!==f?f:0},$=eD.platforms.map(e=>{let t=O.filter(t=>t.type===e.type),s=t.length,a=t.filter(e=>!1===e.status).length;return{...e,total:s,booked:a}});return S?(0,a.jsx)(a.Fragment,{children:(null==S?void 0:S.available)?(0,a.jsx)(K.Z,{className:"py-[50vh]"}):(0,a.jsxs)("div",{className:"h-full min-h-0 text-foreground flex flex-col gap-3 sm:gap-4",children:[(0,a.jsxs)(l.E.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"gaming-panel flex shrink-0 flex-col justify-between gap-3 rounded-xl p-3 md:flex-row md:items-center md:p-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 mb-1",children:[(0,a.jsx)("h1",{className:"premium-heading text-xl font-bold text-foreground sm:text-2xl md:text-3xl",children:"Gaming Cafe Command"}),(0,a.jsx)("div",{className:"w-2 h-2 rounded-full ".concat(G?"bg-green-500":"bg-red-500")}),G&&R.lastUpdate&&(0,a.jsx)(l.E.div,{animate:{scale:[1,1.1,1]},transition:{duration:2,repeat:1/0},className:"text-xs text-green-600 font-medium",title:"Last updated: ".concat(R.lastUpdate)})]}),(0,a.jsx)("p",{className:"premium-subtle text-xs sm:text-sm",children:"Monitor live slots, revenue, and upcoming sessions in real time."})]}),(0,a.jsx)("div",{className:"flex items-center gap-3 self-end md:self-auto",children:(0,a.jsx)(eN,{vendorId:I,onBookingAccepted:e=>{console.log("\uD83C\uDFAF Booking accepted - updating upcoming bookings:",e),B(e=>!e),window.dispatchEvent(new CustomEvent("booking-accepted",{detail:e}))},latestBookingEvent:M})})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 gap-3 sm:gap-4 lg:grid-cols-12 flex-1 min-h-0",children:[(0,a.jsxs)("div",{className:"space-y-3 sm:space-y-4 flex flex-col min-h-0 lg:col-span-8 xl:col-span-9",children:[(0,a.jsxs)(l.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"gaming-panel flex w-fit items-center gap-2 rounded-xl p-1.5",children:[(0,a.jsxs)("button",{onClick:()=>z("analytics"),className:"flex items-center gap-2 px-3 sm:px-4 py-2 rounded-md text-xs sm:text-sm font-medium transition-all duration-200 ".concat("analytics"===F?"bg-background text-foreground shadow-sm":"text-muted-foreground hover:text-foreground"),children:[(0,a.jsx)(em.Z,{className:"w-3 sm:w-4 h-3 sm:h-4"}),"Analytics"]}),(0,a.jsxs)("button",{onClick:()=>z("devices"),className:"flex items-center gap-2 px-3 sm:px-4 py-2 rounded-md text-xs sm:text-sm font-medium transition-all duration-200 ".concat("devices"===F?"bg-background text-foreground shadow-sm":"text-muted-foreground hover:text-foreground"),children:[(0,a.jsx)(c.Z,{className:"w-3 sm:w-4 h-3 sm:h-4"}),"Devices"]})]}),(0,a.jsxs)(r.M,{mode:"wait",children:["analytics"===F&&(0,a.jsxs)(l.E.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},transition:{duration:.3},className:"grid grid-cols-1 gap-2 sm:grid-cols-2 sm:gap-3 2xl:grid-cols-3",children:[(0,a.jsx)(l.E.div,{animate:{scale:R.lastUpdate?[1,1.05,1]:1},transition:{duration:.5},className:"flex-1",children:(0,a.jsx)(i.Zb,{className:"gaming-kpi-card h-full rounded-xl transition-all duration-200",children:(0,a.jsxs)(i.aY,{className:"p-2 sm:p-3",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-1 sm:mb-2",children:[(0,a.jsxs)("div",{className:"flex items-center gap-1 sm:gap-2",children:[(0,a.jsx)("div",{className:"p-1 sm:p-1.5 rounded-full bg-emerald-500/20",children:(0,a.jsx)(Z.Z,{className:"w-3 sm:w-4 h-3 sm:h-4 text-emerald-400"})}),(0,a.jsx)("span",{className:"text-xs sm:text-sm font-medium text-foreground",children:"Earnings"})]}),(0,a.jsx)("button",{onClick:()=>j(!v),className:"text-emerald-400 hover:text-emerald-300 transition-colors",children:v?(0,a.jsx)(eu.Z,{className:"w-3 sm:w-4 h-3 sm:h-4"}):(0,a.jsx)(T.Z,{className:"w-3 sm:w-4 h-3 sm:h-4"})})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)(l.E.p,{initial:{scale:.8,opacity:.5},animate:{scale:1,opacity:1},transition:{duration:.3},className:"gaming-kpi-value text-lg font-bold text-foreground sm:text-xl",children:v?"₹".concat(X.todayEarnings):"₹•••••"},X.todayEarnings),(0,a.jsxs)("div",{className:"flex items-center gap-1 text-xs text-emerald-400",children:[(0,a.jsx)(ex.Z,{className:"w-3 h-3"}),(0,a.jsx)("span",{children:"Today"})]})]})]})})}),(0,a.jsx)(l.E.div,{animate:{scale:R.lastUpdate?[1,1.05,1]:1},transition:{duration:.5},className:"flex-1",children:(0,a.jsx)(i.Zb,{className:"gaming-kpi-card h-full rounded-xl transition-all duration-200",children:(0,a.jsxs)(i.aY,{className:"p-2 sm:p-3",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-1 sm:mb-2",children:[(0,a.jsxs)("div",{className:"flex items-center gap-1 sm:gap-2",children:[(0,a.jsx)("div",{className:"p-1 sm:p-1.5 rounded-full bg-blue-500/20",children:(0,a.jsx)(eg.Z,{className:"w-3 sm:w-4 h-3 sm:h-4 text-blue-400"})}),(0,a.jsx)("span",{className:"text-xs sm:text-sm font-medium text-foreground",children:"Bookings"})]}),(0,a.jsxs)("span",{className:"text-xs font-bold text-green-400",children:["+",X.todayBookingsChange,"%"]})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)(l.E.p,{initial:{scale:.8,opacity:.5},animate:{scale:1,opacity:1},transition:{duration:.3},className:"gaming-kpi-value text-lg font-bold text-foreground sm:text-xl",children:X.todayBookings},X.todayBookings),(0,a.jsxs)("div",{className:"flex items-center gap-1 text-xs text-blue-400",children:[(0,a.jsx)(ex.Z,{className:"w-3 h-3"}),(0,a.jsx)("span",{children:"Today"})]})]})]})})}),(0,a.jsx)(l.E.div,{animate:{scale:R.lastUpdate?[1,1.05,1]:1},transition:{duration:.5},className:"flex-1",children:(0,a.jsx)(i.Zb,{className:"gaming-kpi-card h-full rounded-xl transition-all duration-200",children:(0,a.jsxs)(i.aY,{className:"p-2 sm:p-3",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-1 sm:mb-2",children:[(0,a.jsxs)("div",{className:"flex items-center gap-1 sm:gap-2",children:[(0,a.jsx)("div",{className:"p-1 sm:p-1.5 rounded-full bg-yellow-500/20",children:(0,a.jsx)(eh.Z,{className:"w-3 sm:w-4 h-3 sm:h-4 text-yellow-400"})}),(0,a.jsx)("span",{className:"text-xs sm:text-sm font-medium text-foreground",children:"Pending"})]}),(0,a.jsx)("button",{onClick:()=>k(!N),className:"text-yellow-400 hover:text-yellow-300 transition-colors",children:N?(0,a.jsx)(eu.Z,{className:"w-3 sm:w-4 h-3 sm:h-4"}):(0,a.jsx)(T.Z,{className:"w-3 sm:w-4 h-3 sm:h-4"})})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)(l.E.p,{initial:{scale:.8,opacity:.5},animate:{scale:1,opacity:1},transition:{duration:.3},className:"gaming-kpi-value text-lg font-bold text-foreground sm:text-xl",children:N?"₹".concat(X.pendingAmount):"₹•••••"},X.pendingAmount),(0,a.jsxs)("div",{className:"flex items-center gap-1 text-xs text-yellow-400",children:[(0,a.jsx)("div",{className:"w-2 h-2 bg-yellow-400 rounded-full animate-pulse"}),(0,a.jsx)("span",{children:"Today"})]})]})]})})})]},"analytics"),"devices"===F&&(0,a.jsx)(l.E.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},transition:{duration:.3},className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-2 sm:gap-3 flex-shrink-0",children:$.map(e=>{let t=e.total-e.booked,s=e.total?Math.round(e.booked/e.total*100):0,o=e.icon;return(0,a.jsxs)(l.E.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.3},className:"rounded-xl border border-border/80 bg-card/85 p-2 shadow-sm backdrop-blur-sm sm:p-3",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-1 sm:mb-2",children:[(0,a.jsxs)("div",{className:"flex items-center gap-1 sm:gap-2",children:[(0,a.jsx)("div",{className:"p-1 sm:p-1.5 rounded-full",style:{backgroundColor:e.bgColor},children:(0,a.jsx)(o,{className:"w-3 sm:w-4 h-3 sm:h-4",style:{color:e.color}})}),(0,a.jsx)("span",{className:"text-xs sm:text-sm font-medium text-zinc-700 dark:text-zinc-100",children:e.name})]}),(0,a.jsxs)("span",{className:"text-xs font-bold",style:{color:e.color},children:[s,"%"]})]}),(0,a.jsx)("div",{className:"w-full h-1 rounded-full bg-zinc-200 dark:bg-zinc-700",children:(0,a.jsx)("div",{className:"h-1 rounded-full",style:{width:"".concat(s,"%"),backgroundColor:e.color}})}),(0,a.jsxs)("div",{className:"mt-1 sm:mt-2 text-xs flex justify-between text-zinc-600 dark:text-zinc-400",children:[(0,a.jsxs)("span",{children:["Booked: ",e.booked]}),(0,a.jsxs)("span",{children:["Free: ",t]})]})]},e.name)})},"devices")]}),(0,a.jsx)(l.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},className:"flex-1 min-h-0",children:(0,a.jsx)(i.Zb,{className:"gaming-panel h-full rounded-xl",children:(0,a.jsxs)(i.aY,{className:"p-2 sm:p-4 h-full overflow-hidden relative",children:[(0,a.jsx)(er,{currentSlots:S.currentSlots,refreshSlots:D,setRefreshSlots:C}),Y&&(0,a.jsx)(eC,{})]})})})]}),(0,a.jsx)(l.E.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{delay:.4},className:"flex flex-col min-h-0 lg:col-span-4 xl:col-span-3",children:(0,a.jsxs)(i.Zb,{className:"gaming-panel relative flex-1 min-h-[320px] lg:min-h-0 rounded-xl",children:[(0,a.jsx)(i.aY,{className:"p-0 h-full overflow-hidden",children:(0,a.jsx)(V,{upcomingBookings:S.upcomingBookings||[],vendorId:null==I?void 0:I.toString(),setRefreshSlots:C,refreshTrigger:A})}),Y&&(0,a.jsx)(eC,{})]})})]})]})}):(0,a.jsx)(K.Z,{className:"py-[42vh]"})}function eE(){return(0,a.jsx)(o.DashboardLayout,{children:(0,a.jsx)("div",{className:"flex-1 min-h-screen bg-background",children:(0,a.jsx)(eI,{})})})}},75956:function(e,t,s){"use strict";var a=s(57437);s(2265),t.Z=e=>{let{size:t=48,className:s=""}=e;return(0,a.jsx)("div",{className:"flex justify-center items-center w-full h-full ".concat(s),children:(0,a.jsx)("div",{className:"animate-spin rounded-full border-t-2 border-b-2 border-emerald-500",style:{width:t,height:t}})})}},23579:function(e,t,s){"use strict";s.d(t,{SocketProvider:function(){return d},s:function(){return l}});var a=s(57437),o=s(38303),n=s(2265),i=s(68680);let r=(0,n.createContext)(void 0),l=()=>{let e=(0,n.useContext)(r);if(!e)throw Error("useSocket must be used within a SocketProvider");return e},d=e=>{let{children:t}=e,[s,l]=(0,n.useState)(null),[d,c]=(0,n.useState)(!1);return(0,n.useEffect)(()=>{console.log("\uD83D\uDD0C Creating single socket connection..."),console.log("Trying to connect ".concat(o.o5));let e=(0,i.io)("".concat(o.o5),{transports:["websocket","polling"],autoConnect:!0,reconnection:!0,reconnectionAttempts:5,reconnectionDelay:2e3,timeout:2e4});return e.on("connect",()=>{console.log("✅ Socket connected:",e.id),c(!0)}),e.on("disconnect",e=>{console.log("❌ Socket disconnected:",e),c(!1)}),e.on("connect_error",e=>{console.error("\uD83D\uDCA5 Connection error:",e),c(!1)}),l(e),()=>{console.log("\uD83E\uDDF9 Cleaning up socket..."),e.close()}},[]),(0,a.jsx)(r.Provider,{value:{socket:s,isConnected:d,joinVendor:e=>{(null==s?void 0:s.connected)?(console.log("\uD83C\uDFEA Joining vendor room: ".concat(e)),s.emit("dashboard_join_vendor",{vendor_id:e})):console.warn("⚠️ Cannot join vendor, socket not connected")}},children:t})}},35974:function(e,t,s){"use strict";s.d(t,{C:function(){return r}});var a=s(57437);s(2265);var o=s(90535),n=s(94508);let i=(0,o.j)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground",success:"border-transparent bg-green-500 text-white hover:bg-green-600",warning:"border-transparent bg-yellow-500 text-white hover:bg-yellow-600"}},defaultVariants:{variant:"default"}});function r(e){let{className:t,variant:s,...o}=e;return(0,a.jsx)("div",{className:(0,n.cn)(i({variant:s}),t),...o})}}},function(e){e.O(0,[7699,7861,5585,4076,2957,6890,8143,8680,8277,2707,1203,2971,2117,1744],function(){return e(e.s=71318)}),_N_E=e.O()}]);