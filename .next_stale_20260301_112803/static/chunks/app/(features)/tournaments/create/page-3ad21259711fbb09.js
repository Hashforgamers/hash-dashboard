(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1031],{91850:function(e,a,t){Promise.resolve().then(t.bind(t,65348))},65348:function(e,a,t){"use strict";t.r(a),t.d(a,{default:function(){return v}});var s=t(57437),l=t(2265),n=t(99376),r=t(92451),i=t(10407),c=t(17689),o=t(32489),d=t(53113),m=t(88501),u=t(9923),x=t(4827),p=t(14474),h=t(42357);function b(e){let{selected:a,onSelect:t,minDate:n}=e,[c,o]=(0,l.useState)(null!=a?a:new Date),d=c.getFullYear(),m=c.getMonth(),u=new Date(d,m,1).getDay(),x=new Date(d,m+1,0).getDate();return(0,s.jsxs)("div",{className:"bg-card border border-border rounded-xl p-4",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,s.jsx)("button",{className:"btn-icon",onClick:()=>o(new Date(d,m-1,1)),children:(0,s.jsx)(r.Z,{className:"icon-sm"})}),(0,s.jsx)("span",{className:"text-sm font-semibold text-foreground",children:c.toLocaleString("default",{month:"long",year:"numeric"})}),(0,s.jsx)("button",{className:"btn-icon",onClick:()=>o(new Date(d,m+1,1)),children:(0,s.jsx)(i.Z,{className:"icon-sm"})})]}),(0,s.jsx)("div",{className:"grid grid-cols-7 mb-1",children:["S","M","T","W","T","F","S"].map((e,a)=>(0,s.jsx)("div",{className:"text-center text-xs text-muted-foreground py-1",children:e},a))}),(0,s.jsxs)("div",{className:"grid grid-cols-7 gap-y-1",children:[Array.from({length:u}).map((e,a)=>(0,s.jsx)("div",{},"e".concat(a))),Array.from({length:x},(e,l)=>{let r=l+1,i=new Date(d,m,r),c=(null==a?void 0:a.toDateString())===i.toDateString(),o=!!n&&i<new Date(n.getFullYear(),n.getMonth(),n.getDate());return(0,s.jsx)("button",{disabled:o,onClick:()=>t(i),className:"w-8 h-8 mx-auto rounded-full text-sm transition-colors\n                ".concat(c?"bg-primary text-primary-foreground font-bold":"","\n                ").concat(c||o?"":"hover:bg-muted text-foreground","\n                ").concat(o?"text-muted-foreground/30 cursor-not-allowed":"","\n              "),children:r},r)})]})]})}function g(e){let{preview:a,uploading:t,onFileSelect:n,onRemove:r}=e,i=(0,l.useRef)(null);return(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("label",{className:"form-label block",children:"Event Banner"}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground mb-3",children:"Recommended: 1200\xd7630px — PNG, JPG or WEBP. Stored on Cloudinary."}),a?(0,s.jsxs)("div",{className:"relative w-full rounded-xl overflow-hidden border border-border group",style:{aspectRatio:"1200/630"},children:[(0,s.jsx)("img",{src:a,alt:"Banner preview",className:"w-full h-full object-cover"}),!t&&(0,s.jsxs)("div",{className:"absolute inset-0 bg-black/60 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center gap-3",children:[(0,s.jsxs)("button",{type:"button",className:"btn-secondary text-xs",onClick:()=>{var e;return null===(e=i.current)||void 0===e?void 0:e.click()},children:[(0,s.jsx)(c.Z,{className:"icon-xs"})," Change Image"]}),(0,s.jsxs)("button",{type:"button",className:"btn-danger text-xs",onClick:r,children:[(0,s.jsx)(o.Z,{className:"icon-xs"})," Remove"]})]}),t&&(0,s.jsxs)("div",{className:"absolute inset-0 bg-black/70 flex flex-col items-center justify-center gap-2",children:[(0,s.jsx)("div",{className:"w-8 h-8 border-2 border-primary border-t-transparent rounded-full animate-spin"}),(0,s.jsx)("p",{className:"text-white text-xs font-medium",children:"Uploading to Cloudinary..."})]})]}):(0,s.jsx)("div",{className:"w-full rounded-xl border-2 border-dashed transition-all cursor-pointer\n            flex flex-col items-center justify-center gap-3 py-16\n            ".concat(t?"border-primary/40 bg-primary/5 cursor-not-allowed":"border-border hover:border-primary/50 hover:bg-primary/5"),onClick:()=>{var e;return!t&&(null===(e=i.current)||void 0===e?void 0:e.click())},onDragOver:e=>e.preventDefault(),onDrop:e=>{var a;e.preventDefault();let t=null===(a=e.dataTransfer.files)||void 0===a?void 0:a[0];t&&t.type.startsWith("image/")&&n(t)},children:t?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"w-8 h-8 border-2 border-primary border-t-transparent rounded-full animate-spin"}),(0,s.jsx)("p",{className:"body-text-muted text-sm",children:"Uploading..."})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"icon-blue p-4 rounded-2xl",children:(0,s.jsx)(d.Z,{className:"w-8 h-8 text-blue-400"})}),(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("p",{className:"body-text font-medium",children:"Click to upload or drag & drop"}),(0,s.jsx)("p",{className:"body-text-muted text-xs mt-1",children:"PNG, JPG, WEBP — max 10MB"})]}),(0,s.jsxs)("button",{type:"button",className:"btn-secondary text-sm pointer-events-none",children:[(0,s.jsx)(c.Z,{className:"icon-sm"})," Browse Files"]})]})}),(0,s.jsx)("input",{ref:i,type:"file",accept:"image/png,image/jpeg,image/webp",className:"hidden",onChange:e=>{var a;let t=null===(a=e.target.files)||void 0===a?void 0:a[0];t&&n(t),e.target.value=""}})]})}let j={start:"Start Date",end:"End Date",deadline:"Reg. Deadline"};function v(){let e=(0,n.useRouter)(),[a,t]=(0,l.useState)(null),{token:r,loading:i}=(0,u.K)(a),[c,o]=(0,l.useState)({title:"",description:"",status:"draft",currency:"INR",registration_fee:"0",capacity_team:"",capacity_player:"",min_team_size:5,max_team_size:5,allow_solo:!1,allow_individual:!1,visibility:!0}),[d,v]=(0,l.useState)(null),[f,y]=(0,l.useState)(null),[N,w]=(0,l.useState)(null),[_,S]=(0,l.useState)("start"),[k,D]=(0,l.useState)(null),[C,R]=(0,l.useState)(null),[z,E]=(0,l.useState)(null),[I,P]=(0,l.useState)(!1),[T,F]=(0,l.useState)(!1),[M,U]=(0,l.useState)("");(0,l.useEffect)(()=>{let e=localStorage.getItem("jwtToken");if(e)try{let a=(0,p.o)(e);console.log("\uD83D\uDD11 Decoded vendor ID:",a.sub.id),t(a.sub.id)}catch(e){console.error("❌ Error decoding JWT token:",e)}},[]);let B=(e,a)=>o(t=>({...t,[e]:a})),Z=async()=>{z&&r&&await (0,x.p2)(r,z).catch(console.error),D(null),R(null),E(null)},O={start:d,end:f,deadline:N},A=async()=>{if(!r)return U("Session not ready. Please wait a moment.");if(!c.title.trim())return U("Tournament name is required.");if(!d)return U("Start date is required.");if(!f)return U("End date is required.");if(f<d)return U("End date must be after start date.");if(c.min_team_size>c.max_team_size)return U("Min team size cannot exceed max team size.");if(N&&N>=d)return U("Registration deadline must be before start date.");F(!0),U("");try{let a,t;if(k){P(!0);let e=await (0,x.ZK)(r,k,c.title.trim());P(!1),a=e.url,t=e.public_id,E(e.public_id)}let s=await (0,x.yM)(r,{title:c.title.trim(),description:c.description.trim()||void 0,start_at:d.toISOString(),end_at:f.toISOString(),registration_deadline:null==N?void 0:N.toISOString(),registration_fee:parseFloat(c.registration_fee)||0,currency:c.currency,capacity_team:c.capacity_team?parseInt(c.capacity_team):void 0,capacity_player:c.capacity_player?parseInt(c.capacity_player):void 0,min_team_size:c.min_team_size,max_team_size:c.max_team_size,allow_solo:c.allow_solo,allow_individual:c.allow_individual,visibility:c.visibility,status:c.status,banner_image_url:a,banner_public_id:t});e.push("/tournaments/".concat(s.id))}catch(e){P(!1),U(e instanceof Error?e.message:"Something went wrong.")}finally{F(!1)}},G=T||I;return(0,s.jsx)(h.DashboardLayout,{children:(0,s.jsx)("div",{className:"page-container overflow-y-auto",children:(0,s.jsxs)("div",{className:"max-w-2xl mx-auto w-full pb-10",children:[(0,s.jsx)("div",{className:"page-header",children:(0,s.jsxs)("div",{className:"page-title-section",children:[(0,s.jsx)("h1",{className:"page-title",children:"Create New Tournament"}),(0,s.jsx)("p",{className:"page-subtitle",children:"Fill in the details below to set up your new eSports event."})]})}),(0,s.jsxs)("div",{className:"space-y-10",children:[(0,s.jsxs)("section",{children:[(0,s.jsx)("h2",{className:"section-title mb-1",children:"Event Banner"}),(0,s.jsx)("div",{className:"h-px bg-border mb-5"}),(0,s.jsx)(g,{preview:C,uploading:I,onFileSelect:e=>{D(e),R(URL.createObjectURL(e)),E(null)},onRemove:Z})]}),(0,s.jsxs)("section",{children:[(0,s.jsx)("h2",{className:"section-title mb-1",children:"Basic Information"}),(0,s.jsx)("div",{className:"h-px bg-border mb-5"}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"form-label block",children:"Tournament Name *"}),(0,s.jsx)("input",{className:"input-field",placeholder:"e.g., Hash GTA Cup",value:c.title,onChange:e=>B("title",e.target.value)})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"form-label block",children:"Description"}),(0,s.jsx)("textarea",{className:"textarea-field",rows:3,placeholder:"e.g., 5v5 GTA single-elim tournament",value:c.description,onChange:e=>B("description",e.target.value)})]}),(0,s.jsxs)("div",{className:"two-col-grid",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"form-label block",children:"Publish Status"}),(0,s.jsxs)("select",{className:"select-field",value:c.status,onChange:e=>B("status",e.target.value),children:[(0,s.jsx)("option",{value:"draft",children:"Save as Draft"}),(0,s.jsx)("option",{value:"published",children:"Publish Immediately"})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"form-label block",children:"Currency"}),(0,s.jsxs)("select",{className:"select-field",value:c.currency,onChange:e=>B("currency",e.target.value),children:[(0,s.jsx)("option",{value:"INR",children:"INR — Indian Rupee"}),(0,s.jsx)("option",{value:"USD",children:"USD — US Dollar"}),(0,s.jsx)("option",{value:"EUR",children:"EUR — Euro"})]})]})]})]})]}),(0,s.jsxs)("section",{children:[(0,s.jsx)("h2",{className:"section-title mb-1",children:"Schedule & Logistics"}),(0,s.jsx)("div",{className:"h-px bg-border mb-5"}),(0,s.jsx)("label",{className:"form-label block mb-3",children:"Tournament Dates *"}),(0,s.jsx)("div",{className:"flex gap-2 mb-4 flex-wrap",children:["start","end","deadline"].map(e=>(0,s.jsxs)("button",{type:"button",onClick:()=>S(e),className:"flex items-center gap-2 btn-secondary text-xs py-2 px-3 transition-all\n                    ".concat(_===e?"ring-2 ring-primary":"","\n                  "),children:[(0,s.jsx)(m.Z,{className:"icon-xs"}),j[e],": ",O[e]?O[e].toLocaleDateString():"—"]},e))}),(0,s.jsxs)("div",{className:"two-col-grid items-start",children:[(0,s.jsx)(b,{selected:O[_],onSelect:e=>{"start"===_?(v(e),S("end")):"end"===_?(y(e),S("deadline")):w(e)},minDate:"end"===_&&null!=d?d:void 0}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"form-label block",children:"Max Teams"}),(0,s.jsx)("input",{className:"input-field",type:"number",min:1,placeholder:"e.g., 32",value:c.capacity_team,onChange:e=>B("capacity_team",e.target.value)})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"form-label block",children:"Max Players"}),(0,s.jsx)("input",{className:"input-field",type:"number",min:1,placeholder:"e.g., 160",value:c.capacity_player,onChange:e=>B("capacity_player",e.target.value)})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"form-label block",children:"Team Size Range"}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("input",{className:"input-field",type:"number",min:1,placeholder:"Min",value:c.min_team_size,onChange:e=>B("min_team_size",parseInt(e.target.value)||1)}),(0,s.jsx)("span",{className:"text-muted-foreground font-medium",children:"–"}),(0,s.jsx)("input",{className:"input-field",type:"number",min:1,placeholder:"Max",value:c.max_team_size,onChange:e=>B("max_team_size",parseInt(e.target.value)||1)})]})]}),(0,s.jsx)("div",{className:"space-y-2 pt-1",children:[{key:"allow_solo",label:"Allow Solo Players"},{key:"allow_individual",label:"Allow Individual Registration"},{key:"visibility",label:"Visible to Public"}].map(e=>{let{key:a,label:t}=e;return(0,s.jsxs)("label",{className:"flex items-center gap-3 cursor-pointer select-none",children:[(0,s.jsx)("input",{type:"checkbox",checked:c[a],onChange:e=>B(a,e.target.checked),className:"w-4 h-4 rounded accent-primary"}),(0,s.jsx)("span",{className:"body-text",children:t})]},a)})})]})]})]}),(0,s.jsxs)("section",{children:[(0,s.jsx)("h2",{className:"section-title mb-1",children:"Financials"}),(0,s.jsx)("div",{className:"h-px bg-border mb-5"}),(0,s.jsxs)("div",{className:"two-col-grid",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:"form-label block",children:["Entry / Registration Fee (",c.currency,")"]}),(0,s.jsx)("input",{className:"input-field",type:"number",min:0,step:"0.01",placeholder:"e.g., 10",value:c.registration_fee,onChange:e=>B("registration_fee",e.target.value)})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:"form-label block",children:["Prize Pool (",c.currency,")",(0,s.jsx)("span",{className:"text-muted-foreground font-normal text-xs ml-2",children:"(display only)"})]}),(0,s.jsx)("input",{className:"input-field opacity-50",type:"number",min:0,placeholder:"e.g., 1000",disabled:!0}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Prize pool is managed separately."})]})]})]}),M&&(0,s.jsx)("div",{className:"bg-red-500/10 border border-red-500/30 rounded-lg p-3",children:(0,s.jsx)("p",{className:"text-red-400 text-sm font-medium",children:M})}),(0,s.jsxs)("div",{className:"flex justify-end gap-3 pt-2",children:[(0,s.jsx)("button",{className:"btn-secondary",onClick:()=>e.push("/tournaments"),disabled:G,children:"Cancel"}),(0,s.jsx)("button",{className:"btn-primary min-w-[10rem] justify-center",onClick:A,disabled:G||i,children:I?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}),"Uploading banner..."]}):T?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}),"Creating..."]}):"published"===c.status?"Publish Tournament":"Save as Draft"})]})]})]})})})}}},function(e){e.O(0,[7861,5585,4445,6877,2971,2117,1744],function(){return e(e.s=91850)}),_N_E=e.O()}]);